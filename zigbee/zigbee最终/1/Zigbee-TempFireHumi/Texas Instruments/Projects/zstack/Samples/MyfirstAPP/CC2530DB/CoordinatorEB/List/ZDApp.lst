###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                25/Dec/2012  10:16:55 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2. #
#                          2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Components\sta #
#                          ck\zdo\ZDApp.c                                     #
#    Command line       =  -f "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC253 #
#                          0-2.2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\z #
#                          stack\Samples\MyfirstAPP\CC2530DB\..\..\..\Tools\C #
#                          C2530DB\f8wCoord.cfg" (-DCPU32MHZ                  #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f     #
#                          "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2 #
#                          .2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zsta #
#                          ck\Samples\MyfirstAPP\CC2530DB\..\..\..\Tools\CC25 #
#                          30DB\f8wConfig.cfg" (-DSECURE=0                    #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x02000000                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2 #
#                          .2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Components\st #
#                          ack\zdo\ZDApp.c" -D ZTOOL_P1 -D MT_TASK -D         #
#                          MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG  #
#                          -D HAL_UART=TRUE -D SERIAL_APP_PORT=0 -D           #
#                          HOLD_AUTO_START -D DH_AD_KEY_DEVICE -lC            #
#                          "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2 #
#                          .2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zsta #
#                          ck\Samples\MyfirstAPP\CC2530DB\CoordinatorEB\List\ #
#                          " -lA "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC #
#                          2530-2.2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Project #
#                          s\zstack\Samples\MyfirstAPP\CC2530DB\CoordinatorEB #
#                          \List\" --diag_suppress Pe001,Pa010 -o             #
#                          "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2 #
#                          .2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zsta #
#                          ck\Samples\MyfirstAPP\CC2530DB\CoordinatorEB\Obj\" #
#                           -e --require_prototypes --debug --core=plain      #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 8 -I "D:\个人重要资料(勿删)\yuan #
#                          wm\桌面\ZStack-CC2530-2.2.0-1.3.0\ZStack-CC2530-2. #
#                          2.0-1.3.0\Projects\zstack\Samples\MyfirstAPP\CC253 #
#                          0DB\" -I "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack #
#                          -CC2530-2.2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Proj #
#                          ects\zstack\Samples\MyfirstAPP\CC2530DB\..\SOURCE\ #
#                          " -I "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2 #
#                          530-2.2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects #
#                          \zstack\Samples\MyfirstAPP\CC2530DB\..\..\..\ZMAIN #
#                          \TI2530DB\" -I "D:\个人重要资料(勿删)\yuanwm\桌面\ #
#                          ZStack-CC2530-2.2.0-1.3.0\ZStack-CC2530-2.2.0-1.3. #
#                          0\Projects\zstack\Samples\MyfirstAPP\CC2530DB\..\. #
#                          .\..\..\..\COMPONENTS\MT\" -I                      #
#                          "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2 #
#                          .2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zsta #
#                          ck\Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMP #
#                          ONENTS\HAL\INCLUDE\" -I "D:\个人重要资料(勿删)\yua #
#                          nwm\桌面\ZStack-CC2530-2.2.0-1.3.0\ZStack-CC2530-2 #
#                          .2.0-1.3.0\Projects\zstack\Samples\MyfirstAPP\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\CC2530EB #
#                          \" -I "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC #
#                          2530-2.2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Project #
#                          s\zstack\Samples\MyfirstAPP\CC2530DB\..\..\..\..\. #
#                          .\COMPONENTS\OSAL\MCU\CCSOC\" -I                   #
#                          "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2 #
#                          .2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zsta #
#                          ck\Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMP #
#                          ONENTS\OSAL\INCLUDE\" -I                           #
#                          "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2 #
#                          .2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zsta #
#                          ck\Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMP #
#                          ONENTS\STACK\AF\" -I "D:\个人重要资料(勿删)\yuanwm #
#                          \桌面\ZStack-CC2530-2.2.0-1.3.0\ZStack-CC2530-2.2. #
#                          0-1.3.0\Projects\zstack\Samples\MyfirstAPP\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\STACK\NWK\" -I         #
#                          "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2 #
#                          .2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zsta #
#                          ck\Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMP #
#                          ONENTS\STACK\SEC\" -I "D:\个人重要资料(勿删)\yuanw #
#                          m\桌面\ZStack-CC2530-2.2.0-1.3.0\ZStack-CC2530-2.2 #
#                          .0-1.3.0\Projects\zstack\Samples\MyfirstAPP\CC2530 #
#                          DB\..\..\..\..\..\COMPONENTS\STACK\SAPI\" -I       #
#                          "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2 #
#                          .2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zsta #
#                          ck\Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMP #
#                          ONENTS\STACK\SYS\" -I "D:\个人重要资料(勿删)\yuanw #
#                          m\桌面\ZStack-CC2530-2.2.0-1.3.0\ZStack-CC2530-2.2 #
#                          .0-1.3.0\Projects\zstack\Samples\MyfirstAPP\CC2530 #
#                          DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\" -I        #
#                          "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2 #
#                          .2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zsta #
#                          ck\Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMP #
#                          ONENTS\ZMAC\F8W\" -I "D:\个人重要资料(勿删)\yuanwm #
#                          \桌面\ZStack-CC2530-2.2.0-1.3.0\ZStack-CC2530-2.2. #
#                          0-1.3.0\Projects\zstack\Samples\MyfirstAPP\CC2530D #
#                          B\..\..\..\..\..\COMPONENTS\ZMAC\" -I              #
#                          "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2 #
#                          .2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zsta #
#                          ck\Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMP #
#                          ONENTS\SERVICES\SADDR\" -I                         #
#                          "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2 #
#                          .2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zsta #
#                          ck\Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMP #
#                          ONENTS\SERVICES\SDATA\" -I                         #
#                          "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2 #
#                          .2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zsta #
#                          ck\Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMP #
#                          ONENTS\MAC\INCLUDE\" -I "D:\个人重要资料(勿删)\yua #
#                          nwm\桌面\ZStack-CC2530-2.2.0-1.3.0\ZStack-CC2530-2 #
#                          .2.0-1.3.0\Projects\zstack\Samples\MyfirstAPP\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_LEVEL\"    #
#                          -I "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC253 #
#                          0-2.2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\z #
#                          stack\Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\C #
#                          OMPONENTS\MAC\LOW_LEVEL\srf04\" -I                 #
#                          "D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2 #
#                          .2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zsta #
#                          ck\Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMP #
#                          ONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\" -I        #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          5.3 Evaluation version\8051\INC\" -I "C:\Program   #
#                          Files\IAR Systems\Embedded Workbench 5.3           #
#                          Evaluation version\8051\INC\CLIB\" -Ohz            #
#    List file          =  D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2. #
#                          2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zstac #
#                          k\Samples\MyfirstAPP\CC2530DB\CoordinatorEB\List\Z #
#                          DApp.lst                                           #
#    Object file        =  D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2. #
#                          2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Projects\zstac #
#                          k\Samples\MyfirstAPP\CC2530DB\CoordinatorEB\Obj\ZD #
#                          App.r51                                            #
#                                                                             #
#                                                                             #
###############################################################################

D:\个人重要资料(勿删)\yuanwm\桌面\ZStack-CC2530-2.2.0-1.3.0\ZStack-CC2530-2.2.0-1.3.0\Components\stack\zdo\ZDApp.c
      1          /**************************************************************************************************
      2            Filename:       ZDApp.c
      3            Revised:        $Date: 2009-03-12 16:25:22 -0700 (Thu, 12 Mar 2009) $
      4            Revision:       $Revision: 19404 $
      5          
      6            Description:    This file contains the interface to the Zigbee Device Application. This is the
      7                            Application part that the use can change. This also contains the Task functions.
      8          
      9          
     10            Copyright 2004-2007 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com. 
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          #include "ZComDef.h"
     45          #include "ZMac.h"
     46          #include "OSAL.h"
     47          #include "OSAL_Tasks.h"
     48          #include "OSAL_PwrMgr.h"
     49          #include "OSAL_Nv.h"
     50          #include "AF.h"
     51          #include "APSMEDE.h"
     52          #include "NLMEDE.h"
     53          #include "AddrMgr.h"
     54          #include "ZDProfile.h"
     55          #include "ZDObject.h"
     56          #include "ZDConfig.h"
     57          #include "ZDSecMgr.h"
     58          #include "ZDApp.h"
     59          #include "DebugTrace.h"
     60          #include "nwk_util.h"
     61          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc9
   \   unsigned char volatile __sfr WDCTL
   \                     WDCTL:
   \   000000                DS 1
     62          #include "ZGlobals.h"
     63          #include "ZDNwkMgr.h"
     64          #include "rtg.h"
     65          
     66          #include "ssp.h"
     67          
     68          #if defined( MT_ZDO_FUNC )
     69            #include "MT_ZDO.h"
     70          #endif
     71          
     72          /* HAL */
     73          #include "hal_led.h"
     74          #include "hal_lcd.h"
     75          #include "hal_key.h"
     76          
     77          #if defined( MT_MAC_FUNC ) || defined( MT_MAC_CB_FUNC )
     78            #error "ERROR! MT_MAC functionalities should be disabled on ZDO devices"
     79          #endif
     80          /*********************************************************************
     81           * MACROS
     82           */
     83          
     84          /*********************************************************************
     85           * CONSTANTS
     86           */
     87          #if !defined( NWK_START_DELAY )
     88            #define NWK_START_DELAY             100   // in milliseconds
     89          #endif
     90          
     91          #if !defined( EXTENDED_JOINING_RANDOM_MASK )
     92            #define EXTENDED_JOINING_RANDOM_MASK 0x007F
     93          #endif
     94          
     95          #if !defined( BEACON_REQUEST_DELAY )
     96            #define BEACON_REQUEST_DELAY        100   // in milliseconds
     97          #endif
     98          
     99          #if !defined( BEACON_REQ_DELAY_MASK )
    100            #define BEACON_REQ_DELAY_MASK       0x007F
    101          #endif
    102          
    103          #define MAX_RESUME_RETRY            3
    104          
    105          #define MAX_DEVICE_UNAUTH_TIMEOUT   5000  // 5 seconds
    106          
    107          // Beacon Order Settings (see NLMEDE.h)
    108          #define DEFAULT_BEACON_ORDER        BEACON_ORDER_NO_BEACONS
    109          #define DEFAULT_SUPERFRAME_ORDER    DEFAULT_BEACON_ORDER
    110          
    111          #if !defined( MAX_NWK_FRAMECOUNTER_CHANGES )
    112            // The number of times the frame counter can change before
    113            // saving to NV
    114            #define MAX_NWK_FRAMECOUNTER_CHANGES    1000
    115          #endif
    116          
    117          // Leave control bits
    118          #define ZDAPP_LEAVE_CTRL_INIT 0
    119          #define ZDAPP_LEAVE_CTRL_SET  1
    120          #define ZDAPP_LEAVE_CTRL_RA   2
    121          
    122          // Standard time to update NWK NV data
    123          #define ZDAPP_UPDATE_NWK_NV_TIME 700
    124          
    125          // Address Manager Stub Implementation
    126          #define ZDApp_NwkWriteNVRequest AddrMgrWriteNVRequest
    127          
    128          /*********************************************************************
    129           * TYPEDEFS
    130           */
    131          
    132          /*********************************************************************
    133           * GLOBAL VARIABLES
    134           */
    135          
    136          #if defined( LCD_SUPPORTED )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    137            uint8 MatchRsps = 0;
   \                     MatchRsps:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    138          #endif
    139          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    140          uint8 zdoDiscCounter = 1;
   \                     zdoDiscCounter:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zdoDiscCounter>`
   \   000001                REQUIRE __INIT_XDATA_I
    141          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    142          zAddrType_t ZDAppNwkAddr;
   \                     ZDAppNwkAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z
    143          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    144          uint8 zdappMgmtNwkDiscRspTransSeq;
   \                     zdappMgmtNwkDiscRspTransSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    145          uint8 zdappMgmtNwkDiscReqInProgress = FALSE;
   \                     zdappMgmtNwkDiscReqInProgress:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    146          zAddrType_t zdappMgmtNwkDiscRspAddr;
   \                     zdappMgmtNwkDiscRspAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    147          uint8 zdappMgmtNwkDiscStartIndex;
   \                     zdappMgmtNwkDiscStartIndex:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    148          uint8 zdappMgmtSavedNwkState;
   \                     zdappMgmtSavedNwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    149          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    150          uint16 nwkFrameCounterChanges = 0;
   \                     nwkFrameCounterChanges:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    151          uint8 continueJoining = TRUE;
   \                     continueJoining:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for continueJoining>`
   \   000001                REQUIRE __INIT_XDATA_I
    152          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    153          uint8  _tmpRejoinState;
   \                     _tmpRejoinState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    154          
    155          // The extended PanID used in ZDO layer for rejoin.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    156          uint8 ZDO_UseExtendedPANID[Z_EXTADDR_LEN];
   \                     ZDO_UseExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    157          
    158          /*********************************************************************
    159           * EXTERNAL VARIABLES
    160           */
    161          
    162          /*********************************************************************
    163           * EXTERNAL FUNCTIONS
    164           */
    165          
    166          /*********************************************************************
    167           * LOCAL FUNCTIONS
    168           */
    169          
    170          void ZDApp_NetworkStartEvt( void );
    171          void ZDApp_DeviceAuthEvt( void );
    172          void ZDApp_SaveNetworkStateEvt( void );
    173          
    174          uint8 ZDApp_ReadNetworkRestoreState( void );
    175          uint8 ZDApp_RestoreNetworkState( void );
    176          void ZDAppDetermineDeviceType( void );
    177          void ZDApp_InitUserDesc( void );
    178          void ZDAppCheckForHoldKey( void );
    179          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr );
    180          void ZDApp_ProcessNetworkJoin( void );
    181          void ZDApp_SetCoordAddress( uint8 endPoint, uint8 dstEP );
    182          void ZDApp_SaveNwkKey( void );
    183          uint8 ZDApp_RestoreNwkKey( void );
    184            
    185          void ZDApp_SecInit( uint8 state );
    186          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events );
    187          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr );
    188          
    189          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf );
    190          
    191          void ZDApp_ResetTimerStart( uint16 delay );
    192          void ZDApp_ResetTimerCancel( void );
    193          void ZDApp_LeaveCtrlInit( void );
    194          void ZDApp_LeaveCtrlSet( uint8 ra );
    195          uint8 ZDApp_LeaveCtrlBypass( void );
    196          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay );
    197          void ZDApp_LeaveReset( uint8 ra );
    198          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
    199                                  uint8 removeChildren );
    200          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm );
    201          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg );
    202          void ZDApp_RegisterCBs( void );
    203          
    204          /*********************************************************************
    205           * LOCAL VARIABLES
    206           */
    207          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    208          uint8 ZDAppTaskID;
   \                     ZDAppTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    209          uint8 nwkStatus;
   \                     nwkStatus:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    210          endPointDesc_t *ZDApp_AutoFindMode_epDesc = (endPointDesc_t *)NULL;
   \                     ZDApp_AutoFindMode_epDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    211          uint8 ZDApp_LeaveCtrl;
   \                     ZDApp_LeaveCtrl:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    212          
    213          #if defined( HOLD_AUTO_START )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    214            devStates_t devState = DEV_HOLD;
   \                     devState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    215          #else
    216            devStates_t devState = DEV_INIT;
    217          #endif
    218          
    219          #if ( ZG_BUILD_RTRONLY_TYPE ) || ( ZG_BUILD_ENDDEVICE_TYPE )
    220            devStartModes_t devStartMode = MODE_JOIN;     // Assume joining
    221            //devStartModes_t devStartMode = MODE_RESUME; // if already "directly joined"
    222                                  // to parent. Set to make the device do an Orphan scan.
    223          #else
    224            // Set the default to coodinator

   \                                 In  segment XDATA_I, align 1, keep-with-next
    225            devStartModes_t devStartMode = MODE_HARD;
   \                     devStartMode:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for devStartMode>`
   \   000001                REQUIRE __INIT_XDATA_I
    226          #endif
    227          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    228          uint8 retryCnt;
   \                     retryCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    229          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    230          endPointDesc_t ZDApp_epDesc =
   \                     ZDApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for ZDApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
    231          {
    232            ZDO_EP,
    233            &ZDAppTaskID,
    234            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for ZDO
    235            (afNetworkLatencyReq_t)0            // No Network Latency req
    236          };
    237          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    238          uint16 ZDApp_SavedPollRate = POLL_RATE;
   \                     ZDApp_SavedPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for ZDApp_SavedPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I
    239          
    240          /*********************************************************************
    241           * @fn      ZDApp_Init
    242           *
    243           * @brief   ZDApp Initialization function.
    244           *
    245           * @param   task_id - ZDApp Task ID
    246           *
    247           * @return  None
    248           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    249          void ZDApp_Init( uint8 task_id )
   \                     ZDApp_Init:
    250          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    251            // Save the task ID
    252            ZDAppTaskID = task_id;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#ZDAppTaskID
   \   000008   F0           MOVX    @DPTR,A
    253          
    254            // Initialize the ZDO global device short address storage
    255            ZDAppNwkAddr.addrMode = Addr16Bit;
   \   000009   7402         MOV     A,#0x2
   \   00000B   90....       MOV     DPTR,#(ZDAppNwkAddr + 8)
   \   00000E   F0           MOVX    @DPTR,A
    256            ZDAppNwkAddr.addr.shortAddr = INVALID_NODE_ADDR;  //0xfffe
   \   00000F   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000012   74FE         MOV     A,#-0x2
   \   000014   F0           MOVX    @DPTR,A
   \   000015   A3           INC     DPTR
   \   000016   74FF         MOV     A,#-0x1
   \   000018   F0           MOVX    @DPTR,A
    257            (void)NLME_GetExtAddr();  // Load the saveExtAddr pointer.
   \   000019                ; Setup parameters for call to function NLME_GetExtAddr
   \   000019   12....       LCALL   ??NLME_GetExtAddr?relay
    258          
    259            // Check for manual "Hold Auto Start"
    260            //检测到手工设置SW_1则会设置devState = DEV_HOLD,从而避开网络初始化
    261            ZDAppCheckForHoldKey();
   \   00001C                ; Setup parameters for call to function ZDAppCheckForHoldKey
   \   00001C   12....       LCALL   ??ZDAppCheckForHoldKey?relay
    262          
    263            // Initialize ZDO items and setup the device - type of device to create.
    264            ZDO_Init();   //通过判断预编译器来开启一些函数功能
   \   00001F                ; Setup parameters for call to function ZDO_Init
   \   00001F   12....       LCALL   ??ZDO_Init?relay
    265          
    266            // Register the endpoint description with the AF
    267            // This task doesn't have a Simple description, but we still need
    268            // to register the endpoint.
    269            afRegister( (endPointDesc_t *)&ZDApp_epDesc );
   \   000022                ; Setup parameters for call to function afRegister
   \   000022   7A..         MOV     R2,#(ZDApp_epDesc & 0xff)
   \   000024   7B..         MOV     R3,#((ZDApp_epDesc >> 8) & 0xff)
   \   000026   12....       LCALL   ??afRegister?relay
    270          
    271          #if defined( ZDO_USERDESC_RESPONSE )
    272            ZDApp_InitUserDesc();
   \   000029                ; Setup parameters for call to function ZDApp_InitUserDesc
   \   000029   12....       LCALL   ??ZDApp_InitUserDesc?relay
    273          #endif // ZDO_USERDESC_RESPONSE
    274          
    275            // Start the device?
    276            if ( devState != DEV_HOLD )
   \   00002C   90....       MOV     DPTR,#devState
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   6009         JZ      ??ZDApp_Init_0
    277            {
    278              ZDOInitDevice( 0 );
   \   000032                ; Setup parameters for call to function ZDOInitDevice
   \   000032   7A00         MOV     R2,#0x0
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??ZDOInitDevice?relay
   \   000039   800D         SJMP    ??ZDApp_Init_1
    279            }
    280            else
    281            {
    282              // Blink LED to indicate HOLD_START
    283              HalLedBlink ( HAL_LED_4, 0, 50, 500 );
   \                     ??ZDApp_Init_0:
   \   00003B                ; Setup parameters for call to function HalLedBlink
   \   00003B   7CF4         MOV     R4,#-0xc
   \   00003D   7D01         MOV     R5,#0x1
   \   00003F   7B32         MOV     R3,#0x32
   \   000041   7A00         MOV     R2,#0x0
   \   000043   7908         MOV     R1,#0x8
   \   000045   12....       LCALL   ??HalLedBlink?relay
    284            }
    285            
    286            ZDApp_RegisterCBs();
   \                     ??ZDApp_Init_1:
   \   000048                ; Setup parameters for call to function ZDApp_RegisterCBs
   \   000048   12....       LCALL   ??ZDApp_RegisterCBs?relay
    287          } /* ZDApp_Init() */
   \   00004B   02....       LJMP    ??Subroutine23_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine23_0:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    288          
    289          /*********************************************************************
    290           * @fn          ZDApp_SecInit
    291           *
    292           * @brief       ZDApp initialize security.
    293           *
    294           * @param       state - device initialization state
    295           *
    296           * @return      none
    297           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    298          void ZDApp_SecInit( uint8 state )
   \                     ZDApp_SecInit:
    299          {  
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    300            if ( ZG_SECURE_ENABLED && ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    301            {
    302              // Set the Trust Center bit
    303              ZDO_Config_Node_Descriptor.ServerMask |= PRIM_TRUST_CENTER;
    304            }
    305          
    306            if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
    307            {
    308              ZDO_Config_Node_Descriptor.CapabilityFlags |= CAPINFO_SECURITY_CAPABLE;
    309            }
    310              
    311            // Initialize ZigBee Device Security Manager
    312            ZDSecMgrInit();
   \   000004                ; Setup parameters for call to function ZDSecMgrInit
   \   000004   12....       LCALL   ??ZDSecMgrInit?relay
    313          
    314            if ( ZG_SECURE_ENABLED )
    315            {
    316              if ( state != ZDO_INITDEV_RESTORED_NETWORK_STATE )
    317              {
    318                nwkFrameCounter = 0;
    319            
    320                if( _NIB.nwkKeyLoaded == FALSE )
    321                {
    322                  if ( ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE          ) ||
    323                       ( ( zgSecurityMode == ZG_SECURITY_RESIDENTIAL ) && zgPreConfigKeys )    )
    324                  {
    325                      SSP_UpdateNwkKey( (byte*)zgPreConfigKey, 0);
    326                      SSP_SwitchNwkKey( 0 );
    327                  }
    328                }
    329              }
    330            }    
    331          }
   \   000007   02....       LJMP    ??Subroutine23_0 & 0xFFFF
    332          
    333          /*********************************************************************
    334           * @fn      ZDApp_event_loop()
    335           *
    336           * @brief   Main event loop for Zigbee device objects task. This function
    337           *          should be called at periodic intervals.
    338           *
    339           * @param   task_id - Task ID
    340           * @param   events  - Bitmap of events
    341           *
    342           * @return  none
    343           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    344          UINT16 ZDApp_event_loop( uint8 task_id, UINT16 events )
   \                     ZDApp_event_loop:
    345          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    346            uint8 *msg_ptr;
    347          
    348            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   5F           ANL     A,R7
   \   00000C   F9           MOV     R1,A
   \   00000D   E4           CLR     A
   \   00000E   7001         JNZ     ??ZDApp_event_loop_0
   \   000010   E9           MOV     A,R1
   \                     ??ZDApp_event_loop_0:
   \   000011   7031         JNZ     ??ZDApp_event_loop_1
    349            {
    350              while ( (msg_ptr = osal_msg_receive( ZDAppTaskID )) )
    351              {
    352                ZDApp_ProcessOSALMsg( (osal_event_hdr_t *)msg_ptr );
    353          
    354                // Release the memory
    355                osal_msg_deallocate( msg_ptr );
    356              }
    357          
    358              // Return unprocessed events
    359             return (events ^ SYS_EVENT_MSG);
    360            }
    361            
    362          
    363            if ( events & ZDO_NETWORK_INIT )
   \   000013   EE           MOV     A,R6
   \   000014   A2E0         MOV     C,0xE0 /* A   */.0
   \   000016   5045         JNC     ??ZDApp_event_loop_2
    364            {
    365              // Initialize apps and start the network
    366              devState = DEV_INIT;
   \   000018   7401         MOV     A,#0x1
   \   00001A   90....       MOV     DPTR,#devState
   \   00001D   F0           MOVX    @DPTR,A
    367              ZDO_StartDevice( (uint8)ZDO_Config_Node_Descriptor.LogicalType, devStartMode,
    368                               DEFAULT_BEACON_ORDER, DEFAULT_SUPERFRAME_ORDER );
   \   00001E                ; Setup parameters for call to function ZDO_StartDevice
   \   00001E   7C0F         MOV     R4,#0xf
   \   000020   7B0F         MOV     R3,#0xf
   \   000022   90....       MOV     DPTR,#devStartMode
   \   000025   E0           MOVX    A,@DPTR
   \   000026   FA           MOV     R2,A
   \   000027   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   5407         ANL     A,#0x7
   \   00002D   F9           MOV     R1,A
   \   00002E   12....       LCALL   ??ZDO_StartDevice?relay
    369              
    370              
    371             
    372               // HalLedSet( HAL_LED_2, HAL_LED_MODE_ON );
    373               // HalLedSet( HAL_LED_3, HAL_LED_MODE_ON );
    374                                                       
    375                               
    376              // Return unprocessed events
    377             return (events ^ ZDO_NETWORK_INIT);
   \   000031   7401         MOV     A,#0x1
   \                     ??ZDApp_event_loop_3:
   \   000033   6E           XRL     A,R6
   \   000034   FA           MOV     R2,A
   \   000035   EF           MOV     A,R7
   \                     ??ZDApp_event_loop_4:
   \   000036   FB           MOV     R3,A
   \   000037   02....       LJMP    ??ZDApp_event_loop_5 & 0xFFFF
    378            }
   \                     ??ZDApp_event_loop_6:
   \   00003A                ; Setup parameters for call to function ZDApp_ProcessOSALMsg
   \   00003A   12....       LCALL   ??ZDApp_ProcessOSALMsg?relay
   \   00003D                ; Setup parameters for call to function osal_msg_deallocate
   \   00003D   AA..         MOV     R2,?V0 + 0
   \   00003F   AB..         MOV     R3,?V0 + 1
   \   000041   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??ZDApp_event_loop_1:
   \   000044                ; Setup parameters for call to function osal_msg_receive
   \   000044   90....       MOV     DPTR,#ZDAppTaskID
   \   000047   E0           MOVX    A,@DPTR
   \   000048   F9           MOV     R1,A
   \   000049   12....       LCALL   ??osal_msg_receive?relay
   \   00004C   8A..         MOV     ?V0 + 0,R2
   \   00004E   8B..         MOV     ?V0 + 1,R3
   \   000050   EA           MOV     A,R2
   \   000051   7001         JNZ     ??ZDApp_event_loop_7
   \   000053   EB           MOV     A,R3
   \                     ??ZDApp_event_loop_7:
   \   000054   70E4         JNZ     ??ZDApp_event_loop_6
   \   000056   EE           MOV     A,R6
   \   000057   FA           MOV     R2,A
   \   000058   7480         MOV     A,#-0x80
   \                     ??ZDApp_event_loop_8:
   \   00005A   6F           XRL     A,R7
   \   00005B   80D9         SJMP    ??ZDApp_event_loop_4
    379          
    380            if ( ZSTACK_ROUTER_BUILD )
    381            {
    382              if ( events & ZDO_NETWORK_START )
   \                     ??ZDApp_event_loop_2:
   \   00005D   5402         ANL     A,#0x2
   \   00005F   6007         JZ      ??ZDApp_event_loop_9
    383              {
    384                ZDApp_NetworkStartEvt();
   \   000061                ; Setup parameters for call to function ZDApp_NetworkStartEvt
   \   000061   12....       LCALL   ??ZDApp_NetworkStartEvt?relay
    385            
    386                // Return unprocessed events
    387                return (events ^ ZDO_NETWORK_START);
   \   000064   7402         MOV     A,#0x2
   \   000066   80CB         SJMP    ??ZDApp_event_loop_3
    388              }
    389          
    390              if ( events & ZDO_ROUTER_START )
   \                     ??ZDApp_event_loop_9:
   \   000068   EE           MOV     A,R6
   \   000069   5420         ANL     A,#0x20
   \   00006B   601D         JZ      ??ZDApp_event_loop_10
    391              {
    392                if ( nwkStatus == ZSuccess )
   \   00006D   90....       MOV     DPTR,#nwkStatus
   \   000070   E0           MOVX    A,@DPTR
   \   000071   7010         JNZ     ??ZDApp_event_loop_11
    393                {
    394                  if ( devState == DEV_END_DEVICE )
   \   000073   90....       MOV     DPTR,#devState
   \   000076   E0           MOVX    A,@DPTR
   \   000077   6406         XRL     A,#0x6
   \   000079   7003         JNZ     ??ZDApp_event_loop_12
    395                    devState = DEV_ROUTER;
   \   00007B   7407         MOV     A,#0x7
   \   00007D   F0           MOVX    @DPTR,A
    396            
    397                  osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_event_loop_12:
   \   00007E                ; Setup parameters for call to function osal_pwrmgr_device
   \   00007E   7900         MOV     R1,#0x0
   \   000080   12....       LCALL   ??osal_pwrmgr_device?relay
    398                }
    399                else
    400                {
    401                  // remain as end device!!
    402                }
    403                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \                     ??ZDApp_event_loop_11:
   \   000083                ; Setup parameters for call to function osal_set_event
   \   000083   12....       LCALL   ?Subroutine2 & 0xFFFF
    404            
    405                // Return unprocessed events
    406                return (events ^ ZDO_ROUTER_START);
   \                     ??CrossCallReturnLabel_19:
   \   000086   7420         MOV     A,#0x20
   \   000088   80A9         SJMP    ??ZDApp_event_loop_3
    407              }
    408            }
    409            
    410            if ( events & ZDO_STATE_CHANGE_EVT )
   \                     ??ZDApp_event_loop_10:
   \   00008A   EE           MOV     A,R6
   \   00008B   5410         ANL     A,#0x10
   \   00008D   600C         JZ      ??ZDApp_event_loop_13
    411            {
    412              ZDO_UpdateNwkStatus( devState );
   \   00008F                ; Setup parameters for call to function ZDO_UpdateNwkStatus
   \   00008F   90....       MOV     DPTR,#devState
   \   000092   E0           MOVX    A,@DPTR
   \   000093   F9           MOV     R1,A
   \   000094   12....       LCALL   ??ZDO_UpdateNwkStatus?relay
    413          
    414              // Return unprocessed events
    415              return (events ^ ZDO_STATE_CHANGE_EVT);
   \   000097   7410         MOV     A,#0x10
   \   000099   8098         SJMP    ??ZDApp_event_loop_3
    416            }
    417          
    418            if ( events & ZDO_COMMAND_CNF )
   \                     ??ZDApp_event_loop_13:
   \   00009B   EE           MOV     A,R6
   \   00009C   5408         ANL     A,#0x8
   \   00009E   6006         JZ      ??ZDApp_event_loop_14
    419            {
    420              // User defined logic
    421          
    422              // Return unprocessed events
    423              return (events ^ ZDO_COMMAND_CNF);
   \   0000A0   7408         MOV     A,#0x8
   \   0000A2   6E           XRL     A,R6
   \   0000A3   FA           MOV     R2,A
   \   0000A4   8022         SJMP    ??ZDApp_event_loop_5
    424            }
    425            
    426            if ( events & ZDO_NWK_UPDATE_NV )
   \                     ??ZDApp_event_loop_14:
   \   0000A6   7402         MOV     A,#0x2
   \   0000A8   5F           ANL     A,R7
   \   0000A9   F9           MOV     R1,A
   \   0000AA   E4           CLR     A
   \   0000AB   7001         JNZ     ??ZDApp_event_loop_15
   \   0000AD   E9           MOV     A,R1
   \                     ??ZDApp_event_loop_15:
   \   0000AE   6004         JZ      ??ZDApp_event_loop_16
    427            {
    428              ZDApp_SaveNetworkStateEvt();
    429          
    430              // Return unprocessed events
    431              return (events ^ ZDO_NWK_UPDATE_NV);
   \   0000B0   7402         MOV     A,#0x2
   \   0000B2   80A6         SJMP    ??ZDApp_event_loop_8
    432            }
    433          
    434            if ( events & ZDO_DEVICE_RESET )
   \                     ??ZDApp_event_loop_16:
   \   0000B4   EE           MOV     A,R6
   \   0000B5   5404         ANL     A,#0x4
   \   0000B7   600B         JZ      ??ZDApp_event_loop_17
    435            {
    436              // The device has been in the UNAUTH state, so reset
    437              // Note: there will be no return from this call
    438              SystemReset();
   \   0000B9   C2AF         CLR     0xa8.7
   \   0000BB   75C9AB       MOV     0xc9,#-0x55
   \   0000BE   75C95B       MOV     0xc9,#0x5b
   \                     ??ZDApp_event_loop_18:
   \   0000C1   00           NOP
   \   0000C2   80FD         SJMP    ??ZDApp_event_loop_18
    439            }
    440          
    441            if ( ZG_SECURE_ENABLED )
    442            {
    443              return ( ZDApp_ProcessSecEvent( task_id, events ) );
    444            }
    445            else
    446            {
    447              // Discard or make more handlers
    448              return 0;
   \                     ??ZDApp_event_loop_17:
   \   0000C4   7A00         MOV     R2,#0x0
   \   0000C6   7B00         MOV     R3,#0x0
    449            }
   \                     ??ZDApp_event_loop_5:
   \   0000C8   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   \   0000CB                REQUIRE _A_IEN0
   \   0000CB                REQUIRE WDCTL
    450          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??osal_set_event?relay
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   7A10         MOV     R2,#0x10
   \   000002   02....       LJMP    ?Subroutine17 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine26_0:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    451          
    452          /*********************************************************************
    453           * @fn      ZDApp_ProcessSecEvent()
    454           *
    455           * @brief   Process incoming security events.
    456           *
    457           * @param   task_id - Task ID
    458           * @param   events  - Bitmap of events
    459           *
    460           * @return  none
    461           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    462          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events )
   \                     ZDApp_ProcessSecEvent:
    463          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    464            (void)task_id;  // Intentionally unreferenced parameter
    465            
    466            if ( ZSTACK_ROUTER_BUILD )
    467            {
    468              if ( events & ZDO_NEW_DEVICE )
   \   000009   EE           MOV     A,R6
   \   00000A   5440         ANL     A,#0x40
   \   00000C   6019         JZ      ??ZDApp_ProcessSecEvent_0
    469              {
    470                // process the new device event
    471                if ( ZDSecMgrNewDeviceEvent() == TRUE )
   \   00000E                ; Setup parameters for call to function ZDSecMgrNewDeviceEvent
   \   00000E   12....       LCALL   ??ZDSecMgrNewDeviceEvent?relay
   \   000011   E9           MOV     A,R1
   \   000012   6401         XRL     A,#0x1
   \   000014   7009         JNZ     ??CrossCallReturnLabel_7
    472                {
    473                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 1000 );
   \   000016                ; Setup parameters for call to function osal_start_timerEx
   \   000016   7CE8         MOV     R4,#-0x18
   \   000018   7D03         MOV     R5,#0x3
   \   00001A   7A40         MOV     R2,#0x40
   \   00001C   12....       LCALL   ?Subroutine6 & 0xFFFF
    474                }
    475          
    476                // Return unprocessed events
    477                return (events ^ ZDO_NEW_DEVICE);
   \                     ??CrossCallReturnLabel_7:
   \   00001F   7440         MOV     A,#0x40
   \                     ??ZDApp_ProcessSecEvent_1:
   \   000021   6E           XRL     A,R6
   \   000022   FA           MOV     R2,A
   \   000023   EF           MOV     A,R7
   \   000024   FB           MOV     R3,A
   \   000025   8045         SJMP    ??ZDApp_ProcessSecEvent_2
    478              }
    479            }
    480          
    481            if ( (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH) 
    482                || (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD) )
    483            {
    484              if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    485              { 
    486                if ( events & ZDO_SECMGR_EVENT )
    487                {
    488                  ZDSecMgrEvent();
    489          
    490                  // Return unprocessed events
    491                  return (events ^ ZDO_SECMGR_EVENT);
    492                }
    493              }
    494            }
    495            
    496            if ( events & ZDO_DEVICE_AUTH )
   \                     ??ZDApp_ProcessSecEvent_0:
   \   000027   EE           MOV     A,R6
   \   000028   5480         ANL     A,#0x80
   \   00002A   6007         JZ      ??ZDApp_ProcessSecEvent_3
    497            {
    498              ZDApp_DeviceAuthEvt();
   \   00002C                ; Setup parameters for call to function ZDApp_DeviceAuthEvt
   \   00002C   12....       LCALL   ??ZDApp_DeviceAuthEvt?relay
    499          
    500              // Return unprocessed events
    501              return (events ^ ZDO_DEVICE_AUTH);
   \   00002F   7480         MOV     A,#-0x80
   \   000031   80EE         SJMP    ??ZDApp_ProcessSecEvent_1
    502            }
    503          
    504            if ( events & ZDO_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_3:
   \   000033   7404         MOV     A,#0x4
   \   000035   5F           ANL     A,R7
   \   000036   F9           MOV     R1,A
   \   000037   E4           CLR     A
   \   000038   7001         JNZ     ??ZDApp_ProcessSecEvent_4
   \   00003A   E9           MOV     A,R1
   \                     ??ZDApp_ProcessSecEvent_4:
   \   00003B   602B         JZ      ??ZDApp_ProcessSecEvent_5
    505            {
    506              if ( nwkFrameCounterChanges++ > MAX_NWK_FRAMECOUNTER_CHANGES )
   \   00003D   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000040   E0           MOVX    A,@DPTR
   \   000041   F8           MOV     R0,A
   \   000042   A3           INC     DPTR
   \   000043   E0           MOVX    A,@DPTR
   \   000044   F9           MOV     R1,A
   \   000045   7401         MOV     A,#0x1
   \   000047   28           ADD     A,R0
   \   000048   FA           MOV     R2,A
   \   000049   E4           CLR     A
   \   00004A   39           ADDC    A,R1
   \   00004B   FB           MOV     R3,A
   \   00004C   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004F   EA           MOV     A,R2
   \   000050   F0           MOVX    @DPTR,A
   \   000051   A3           INC     DPTR
   \   000052   EB           MOV     A,R3
   \   000053   F0           MOVX    @DPTR,A
   \   000054   C3           CLR     C
   \   000055   E8           MOV     A,R0
   \   000056   94E9         SUBB    A,#-0x17
   \   000058   E9           MOV     A,R1
   \   000059   9403         SUBB    A,#0x3
   \   00005B   4003         JC      ??ZDApp_ProcessSecEvent_6
    507                ZDApp_SaveNwkKey();
   \   00005D                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   00005D   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    508          
    509              // Return unprocessed events
    510              return (events ^ ZDO_FRAMECOUNTER_CHANGE);
   \                     ??ZDApp_ProcessSecEvent_6:
   \   000060   EE           MOV     A,R6
   \   000061   FA           MOV     R2,A
   \   000062   7404         MOV     A,#0x4
   \   000064   6F           XRL     A,R7
   \   000065   FB           MOV     R3,A
   \   000066   8004         SJMP    ??ZDApp_ProcessSecEvent_2
    511            }
    512            
    513            // Discard or make more handlers
    514            return 0;
   \                     ??ZDApp_ProcessSecEvent_5:
   \   000068   7A00         MOV     R2,#0x0
   \   00006A   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessSecEvent_2:
   \   00006C                REQUIRE ?Subroutine16
   \   00006C                ; // Fall through to label ?Subroutine16
    515          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??osal_start_timerEx?relay
   \   00000A   22           RET
    516          
    517          /*********************************************************************
    518           * Application Functions
    519           */
    520          
    521          /*********************************************************************
    522           * @fn      ZDOInitDevice
    523           *
    524           * @brief   Start the device in the network.  This function will read
    525           *   ZCD_NV_STARTUP_OPTION (NV item) to determine whether or not to
    526           *   restore the network state of the device.
    527           *
    528           * @param   startDelay - timeDelay to start device (in milliseconds).
    529           *      There is a jitter added to this delay:
    530           *              ((NWK_START_DELAY + startDelay)
    531           *              + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK))
    532           *
    533           * NOTE:    If the application would like to force a "new" join, the
    534           *          application should set the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    535           *          bit in the ZCD_NV_STARTUP_OPTION NV item before calling
    536           *          this function. "new" join means to not restore the network
    537           *          state of the device. Use zgWriteStartupOptions() to set these
    538           *          options.
    539           *
    540           * @return
    541           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    542           *          restored.
    543           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was initialized.
    544           *          This could mean that ZCD_NV_STARTUP_OPTION said to not restore, or
    545           *          it could mean that there was no network state to restore.
    546           *    ZDO_INITDEV_LEAVE_NOT_STARTED - Before the reset, a network leave was issued
    547           *          with the rejoin option set to TRUE.  So, the device was not
    548           *          started in the network (one time only).  The next time this
    549           *          function is called it will start.
    550           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    551          uint8 ZDOInitDevice( uint16 startDelay )
   \                     ZDOInitDevice:
    552          {   //初始化设备网络状态为ZDO_INITDEV_NEW_NETWORK_STATE;新的网络状态
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
    553              //可能意味着ZC_NV_STARTUP_OPTION不能恢复，或没有任何网络状态恢复
    554            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    555            uint16 extendedDelay = 0;
    556             
    557            if ( devState == DEV_HOLD )
   \   000015   90....       MOV     DPTR,#devState
   \   000018   E0           MOVX    A,@DPTR
   \   000019   7005         JNZ     ??ZDOInitDevice_0
    558            { 
    559              // Initialize the RAM items table, in case an NV item has been updated.
    560              zgInitItems( FALSE );
   \   00001B                ; Setup parameters for call to function zgInitItems
   \   00001B   7900         MOV     R1,#0x0
   \   00001D   12....       LCALL   ??zgInitItems?relay
    561            }
    562          
    563            ZDConfig_InitDescriptors();
   \                     ??ZDOInitDevice_0:
   \   000020                ; Setup parameters for call to function ZDConfig_InitDescriptors
   \   000020   12....       LCALL   ??ZDConfig_InitDescriptors?relay
    564            //devtag.071807.todo - fix this temporary solution
    565            _NIB.CapabilityInfo = ZDO_Config_Node_Descriptor.CapabilityFlags;
   \   000023   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000026   E0           MOVX    A,@DPTR
   \   000027   90....       MOV     DPTR,#(_NIB + 14)
   \   00002A   F0           MOVX    @DPTR,A
    566            
    567            devState = DEV_INIT;    // Remove the Hold state
   \   00002B   7401         MOV     A,#0x1
   \   00002D   90....       MOV     DPTR,#devState
   \   000030   F0           MOVX    @DPTR,A
    568          
    569            // Initialize leave control logic
    570            ZDApp_LeaveCtrlInit();
   \   000031                ; Setup parameters for call to function ZDApp_LeaveCtrlInit
   \   000031   12....       LCALL   ??ZDApp_LeaveCtrlInit?relay
    571          
    572            // Check leave control reset settings
    573            ZDApp_LeaveCtrlStartup( &devState, &startDelay );
   \   000034                ; Setup parameters for call to function ZDApp_LeaveCtrlStartup
   \   000034   85..82       MOV     DPL,?XSP + 0
   \   000037   85..83       MOV     DPH,?XSP + 1
   \   00003A   AC82         MOV     R4,DPL
   \   00003C   AD83         MOV     R5,DPH
   \   00003E   7A..         MOV     R2,#(devState & 0xff)
   \   000040   7B..         MOV     R3,#((devState >> 8) & 0xff)
   \   000042   12....       LCALL   ??ZDApp_LeaveCtrlStartup?relay
    574          
    575            // Leave may make the hold state come back
    576            if ( devState == DEV_HOLD )
   \   000045   90....       MOV     DPTR,#devState
   \   000048   E0           MOVX    A,@DPTR
   \   000049   7004         JNZ     ??ZDOInitDevice_1
    577              return ( ZDO_INITDEV_LEAVE_NOT_STARTED );   // Don't join - (one time).
   \   00004B   7902         MOV     R1,#0x2
   \   00004D   8037         SJMP    ??ZDOInitDevice_2
    578          
    579          #if defined ( NV_RESTORE )
    580            // Get Keypad directly to see if a reset nv is needed.
    581            // Hold down the SW_BYPASS_NV key (defined in OnBoard.h)
    582            // while booting to skip past NV Restore.
    583            if ( HalKeyRead() == SW_BYPASS_NV )
    584              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    585            else
    586            {
    587              // Determine if NV should be restored
    588              networkStateNV = ZDApp_ReadNetworkRestoreState();
    589            }
    590          
    591            if ( networkStateNV == ZDO_INITDEV_RESTORED_NETWORK_STATE )
    592            {
    593              networkStateNV = ZDApp_RestoreNetworkState();
    594            }
    595            else
    596            {
    597              // Wipe out the network state in NV
    598              NLME_InitNV();
    599              NLME_SetDefaultNV();
    600            }
    601          #endif
    602          
    603            if ( networkStateNV == ZDO_INITDEV_NEW_NETWORK_STATE )
    604            {
    605              ZDAppDetermineDeviceType();
   \                     ??ZDOInitDevice_1:
   \   00004F                ; Setup parameters for call to function ZDAppDetermineDeviceType
   \   00004F   12....       LCALL   ??ZDAppDetermineDeviceType?relay
    606          
    607              // Only delay if joining network - not restoring network state
    608              extendedDelay = (uint16)((NWK_START_DELAY + startDelay)
    609                        + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK));
   \   000052                ; Setup parameters for call to function osal_rand
   \   000052   12....       LCALL   ??osal_rand?relay
   \   000055   8A..         MOV     ?V0 + 0,R2
   \   000057   A8..         MOV     R0,?V0 + 0
   \   000059   85..82       MOV     DPL,?XSP + 0
   \   00005C   85..83       MOV     DPH,?XSP + 1
   \   00005F   747F         MOV     A,#0x7f
   \   000061   58           ANL     A,R0
   \   000062   F8           MOV     R0,A
   \   000063   E0           MOVX    A,@DPTR
   \   000064   28           ADD     A,R0
   \   000065   F8           MOV     R0,A
   \   000066   A3           INC     DPTR
   \   000067   E0           MOVX    A,@DPTR
   \   000068   3400         ADDC    A,#0x0
   \   00006A   F9           MOV     R1,A
   \   00006B   7464         MOV     A,#0x64
   \   00006D   28           ADD     A,R0
   \   00006E   FE           MOV     R6,A
   \   00006F   E4           CLR     A
   \   000070   39           ADDC    A,R1
   \   000071   FF           MOV     R7,A
    610            }
    611          
    612            // Initialize the security for type of device
    613            ZDApp_SecInit( networkStateNV );
   \   000072                ; Setup parameters for call to function ZDSecMgrInit
   \   000072   12....       LCALL   ??ZDSecMgrInit?relay
    614            
    615            // Trigger the network start
    616            ZDApp_NetworkInit( extendedDelay );
   \   000075                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000075   EE           MOV     A,R6
   \   000076   FA           MOV     R2,A
   \   000077   EF           MOV     A,R7
   \   000078   FB           MOV     R3,A
   \   000079   12....       LCALL   ??ZDApp_NetworkInit?relay
    617          
    618            // set broadcast address mask to support broadcast filtering
    619            NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   00007C                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   00007C   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00007F   E0           MOVX    A,@DPTR
   \   000080   F9           MOV     R1,A
   \   000081   12....       LCALL   ??NLME_SetBroadcastFilter?relay
    620            
    621            return ( networkStateNV );
   \   000084   7901         MOV     R1,#0x1
   \                     ??ZDOInitDevice_2:
   \   000086   02....       LJMP    ?Subroutine15 & 0xFFFF
    622          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   7402         MOV     A,#0x2
   \   000002                REQUIRE ??Subroutine25_0
   \   000002                ; // Fall through to label ??Subroutine25_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine25_0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003                REQUIRE ??Subroutine26_0
   \   000003                ; // Fall through to label ??Subroutine26_0
    623          
    624          /*********************************************************************
    625           * @fn      ZDApp_ReadNetworkRestoreState
    626           *
    627           * @brief   Read the ZCD_NV_STARTUP_OPTION NV Item to state whether
    628           *          or not to restore the network state.
    629           *          If the read value has the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    630           *          bit set return the ZDO_INITDEV_NEW_NETWORK_STATE.
    631           *
    632           * @param   none
    633           *
    634           * @return  ZDO_INITDEV_NEW_NETWORK_STATE
    635           *          or ZDO_INITDEV_RESTORED_NETWORK_STATE based on whether or
    636           *          not ZCD_STARTOPT_DEFAULT_NETWORK_STATE bit is set in
    637           *          ZCD_NV_STARTUP_OPTION
    638           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    639          uint8 ZDApp_ReadNetworkRestoreState( void )
   \                     ZDApp_ReadNetworkRestoreState:
    640          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    641            uint8 networkStateNV = ZDO_INITDEV_RESTORED_NETWORK_STATE;
   \   000005   7E00         MOV     R6,#0x0
    642          
    643            // Look for the New Network State option.
    644            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_NETWORK_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   5001         JNC     ??ZDApp_ReadNetworkRestoreState_0
    645            {
    646              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   00000F   0E           INC     R6
    647            }
    648          
    649            return ( networkStateNV );
   \                     ??ZDApp_ReadNetworkRestoreState_0:
   \   000010   EE           MOV     A,R6
   \   000011   F9           MOV     R1,A
   \   000012   02....       LJMP    ?Subroutine16 & 0xFFFF
    650          }
    651          
    652          /*********************************************************************
    653           * @fn      ZDAppDetermineDeviceType()
    654           *
    655           * @brief   Determines the type of device to start. 
    656           *
    657           *          Looks at zgDeviceLogicalType and determines what type of
    658           *          device to start.  The types are:
    659           *            ZG_DEVICETYPE_COORDINATOR
    660           *            ZG_DEVICETYPE_ROUTER
    661           *            ZG_DEVICETYPE_ENDDEVICE
    662           *
    663           * @param   none
    664           *
    665           * @return  none
    666           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    667          void ZDAppDetermineDeviceType( void )
   \                     ZDAppDetermineDeviceType:
    668          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    669            if ( zgDeviceLogicalType == ZG_DEVICETYPE_COORDINATOR )
   \   000004   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000007   E0           MOVX    A,@DPTR
   \   000008   700E         JNZ     ??ZDAppDetermineDeviceType_0
    670            {
    671              devStartMode = MODE_HARD;     // Start as a coordinator
   \   00000A   7402         MOV     A,#0x2
   \   00000C   90....       MOV     DPTR,#devStartMode
   \   00000F   F0           MOVX    @DPTR,A
    672              ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000010   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000013   E0           MOVX    A,@DPTR
   \   000014   54F8         ANL     A,#0xf8
   \   000016   802E         SJMP    ??ZDAppDetermineDeviceType_1
    673            }
    674            else
    675            {
    676              if ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER  )
   \                     ??ZDAppDetermineDeviceType_0:
   \   000018   6401         XRL     A,#0x1
   \   00001A   700A         JNZ     ??ZDAppDetermineDeviceType_2
    677                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_ROUTER;
   \   00001C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   54F8         ANL     A,#0xf8
   \   000022   4401         ORL     A,#0x1
   \   000024   800D         SJMP    ??ZDAppDetermineDeviceType_3
    678              else if ( zgDeviceLogicalType == ZG_DEVICETYPE_ENDDEVICE )
   \                     ??ZDAppDetermineDeviceType_2:
   \   000026   E0           MOVX    A,@DPTR
   \   000027   6402         XRL     A,#0x2
   \   000029   7009         JNZ     ??ZDAppDetermineDeviceType_4
    679                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   00002B   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   54F8         ANL     A,#0xf8
   \   000031   4402         ORL     A,#0x2
   \                     ??ZDAppDetermineDeviceType_3:
   \   000033   F0           MOVX    @DPTR,A
    680              
    681              // If AIB_apsUseExtendedPANID is set to a non-zero value by commissioning
    682              // The device shall do rejoin the network. Otherwise, do normal join
    683              if ( nwk_ExtPANIDValid( AIB_apsUseExtendedPANID ) == false )
   \                     ??ZDAppDetermineDeviceType_4:
   \   000034                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000034   7A..         MOV     R2,#(AIB_apsUseExtendedPANID & 0xff)
   \   000036   7B..         MOV     R3,#((AIB_apsUseExtendedPANID >> 8) & 0xff)
   \   000038   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   00003B   E9           MOV     A,R1
   \   00003C   7003         JNZ     ??ZDAppDetermineDeviceType_5
    684              {
    685                devStartMode = MODE_JOIN;     // Assume joining
   \   00003E   E4           CLR     A
   \   00003F   8002         SJMP    ??ZDAppDetermineDeviceType_6
    686              }
    687              else
    688              {
    689                devStartMode = MODE_REJOIN;  
   \                     ??ZDAppDetermineDeviceType_5:
   \   000041   7403         MOV     A,#0x3
   \                     ??ZDAppDetermineDeviceType_6:
   \   000043   90....       MOV     DPTR,#devStartMode
   \                     ??ZDAppDetermineDeviceType_1:
   \   000046   F0           MOVX    @DPTR,A
    690              }
    691            }
    692          }
   \   000047   02....       LJMP    ??Subroutine23_0 & 0xFFFF
    693          
    694          /*********************************************************************
    695           * @fn      ZDApp_NetworkStartEvt()
    696           *
    697           * @brief   Process the Network Start Event
    698           *
    699           * @param   none
    700           *
    701           * @return  none
    702           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    703          void ZDApp_NetworkStartEvt( void )
   \                     ZDApp_NetworkStartEvt:
    704          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    705            if ( nwkStatus == ZSuccess )
   \   000004   90....       MOV     DPTR,#nwkStatus
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7012         JNZ     ??ZDApp_NetworkStartEvt_0
    706            {
    707              // Successfully started a ZigBee network
    708              if ( devState == DEV_COORD_STARTING )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6408         XRL     A,#0x8
   \   000010   7003         JNZ     ??ZDApp_NetworkStartEvt_1
    709              {
    710                devState = DEV_ZB_COORD;
   \   000012   7409         MOV     A,#0x9
   \   000014   F0           MOVX    @DPTR,A
    711              }
    712          
    713              osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_NetworkStartEvt_1:
   \   000015                ; Setup parameters for call to function osal_pwrmgr_device
   \   000015   7900         MOV     R1,#0x0
   \   000017   12....       LCALL   ??osal_pwrmgr_device?relay
    714              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00001A                ; Setup parameters for call to function osal_set_event
   \   00001A   802D         SJMP    ??ZDApp_NetworkStartEvt_2
    715            }
    716            else
    717            {
    718              // Try again with a higher energy threshold !!
    719              if ( ( NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT ) < 0xff )
   \                     ??ZDApp_NetworkStartEvt_0:
   \   00001C                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   00001C   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00001F   E9           MOV     A,R1
   \   000020   F8           MOV     R0,A
   \   000021   7410         MOV     A,#0x10
   \   000023   28           ADD     A,R0
   \   000024   F8           MOV     R0,A
   \   000025   E4           CLR     A
   \   000026   3400         ADDC    A,#0x0
   \   000028   F9           MOV     R1,A
   \   000029   E8           MOV     A,R0
   \   00002A   94FF         SUBB    A,#-0x1
   \   00002C   E9           MOV     A,R1
   \   00002D   9400         SUBB    A,#0x0
   \   00002F   C3           CLR     C
   \   000030   65D0         XRL     A,PSW
   \   000032   33           RLC     A
   \   000033   500E         JNC     ??ZDApp_NetworkStartEvt_3
    720              {
    721                NLME_SetEnergyThreshold( (uint8)(NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT) );
   \   000035                ; Setup parameters for call to function NLME_SetEnergyThreshold
   \   000035                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   000035   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   000038   E9           MOV     A,R1
   \   000039   2410         ADD     A,#0x10
   \   00003B   F9           MOV     R1,A
   \   00003C   12....       LCALL   ??NLME_SetEnergyThreshold?relay
    722                osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \   00003F                ; Setup parameters for call to function osal_set_event
   \   00003F   7A01         MOV     R2,#0x1
   \   000041   8008         SJMP    ??ZDApp_NetworkStartEvt_4
    723              }
    724              else
    725              {
    726                // Failed to start network. Enter a dormant state (until user intervenes)
    727                devState = DEV_INIT;
   \                     ??ZDApp_NetworkStartEvt_3:
   \   000043   7401         MOV     A,#0x1
   \   000045   90....       MOV     DPTR,#devState
   \   000048   F0           MOVX    @DPTR,A
    728                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000049                ; Setup parameters for call to function osal_set_event
   \                     ??ZDApp_NetworkStartEvt_2:
   \   000049   7A10         MOV     R2,#0x10
    729              }
    730            }
   \                     ??ZDApp_NetworkStartEvt_4:
   \   00004B   02....       LJMP    ?Subroutine13 & 0xFFFF
    731          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_22:
   \   000003                REQUIRE ??Subroutine23_0
   \   000003                ; // Fall through to label ??Subroutine23_0
    732          
    733          /*********************************************************************
    734           * @fn      ZDApp_DeviceAuthEvt()
    735           *
    736           * @brief   Process the Device Authentic Event
    737           *
    738           * @param   none
    739           *
    740           * @return  none
    741           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    742          void ZDApp_DeviceAuthEvt( void )
   \                     ZDApp_DeviceAuthEvt:
    743          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    744            // received authentication from trust center
    745            if ( devState == DEV_END_DEVICE_UNAUTH )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6405         XRL     A,#0x5
   \   00000A   702D         JNZ     ??ZDApp_DeviceAuthEvt_0
    746            {
    747              // Stop the reset timer so it doesn't reset
    748              ZDApp_ResetTimerCancel();
   \   00000C                ; Setup parameters for call to function ZDApp_ResetTimerCancel
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerCancel?relay
    749          
    750              devState = DEV_END_DEVICE;
   \   00000F   12....       LCALL   ?Subroutine0 & 0xFFFF
    751              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    752          
    753              // Set the Power Manager Device
    754          #if defined ( POWER_SAVING )
    755              osal_pwrmgr_device( PWRMGR_BATTERY );
    756          #endif
    757          
    758              if ( ZSTACK_ROUTER_BUILD )
    759              {
    760                if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??CrossCallReturnLabel_24:
   \   000012   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   000015   6009         JZ      ??ZDApp_DeviceAuthEvt_1
    761                {
    762                  // NOTE: first two parameters are not used, see NLMEDE.h for details
    763                  NLME_StartRouterRequest( 0, 0, false );
   \   000017                ; Setup parameters for call to function NLME_StartRouterRequest
   \   000017   7B00         MOV     R3,#0x0
   \   000019   7A00         MOV     R2,#0x0
   \   00001B   7900         MOV     R1,#0x0
   \   00001D   12....       LCALL   ??NLME_StartRouterRequest?relay
    764                }
    765              }
    766          
    767              // Notify to save info into NV
    768              ZDApp_NVUpdate();
    769          
    770              // Save off the security
    771              ZDApp_SaveNwkKey();
   \                     ??ZDApp_DeviceAuthEvt_1:
   \   000020                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000020   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    772          
    773              ZDApp_AnnounceNewAddress();
   \   000023                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000023   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
    774              
    775              if ( (ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE) == 0 )
   \   000026   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   A2E3         MOV     C,0xE0 /* A   */.3
   \   00002C   400B         JC      ??ZDApp_DeviceAuthEvt_0
    776              {
    777                NLME_SetPollRate( ZDApp_SavedPollRate );
   \   00002E                ; Setup parameters for call to function NLME_SetPollRate
   \   00002E   90....       MOV     DPTR,#ZDApp_SavedPollRate
   \   000031   E0           MOVX    A,@DPTR
   \   000032   FA           MOV     R2,A
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   FB           MOV     R3,A
   \   000036   12....       LCALL   ??NLME_SetPollRate?relay
    778              }
    779            }
    780            else
    781            {
    782              ZDApp_NVUpdate();
    783            }
    784          }
   \                     ??ZDApp_DeviceAuthEvt_0:
   \   000039   02....       LJMP    ??Subroutine23_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000003   E0           MOVX    A,@DPTR
   \   000004   5407         ANL     A,#0x7
   \   000006   6402         XRL     A,#0x2
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7406         MOV     A,#0x6
   \   000002   90....       MOV     DPTR,#devState
   \   000005   F0           MOVX    @DPTR,A
   \   000006                ; Setup parameters for call to function osal_set_event
   \   000006                ; Setup parameters for call to function osal_set_event
   \   000006   7A10         MOV     R2,#0x10
   \   000008                REQUIRE ?Subroutine17
   \   000008                ; // Fall through to label ?Subroutine17
    785          
    786          /*********************************************************************
    787           * @fn      ZDApp_SaveNetworkStateEvt()
    788           *
    789           * @brief   Process the Save the Network State Event
    790           *
    791           * @param   none
    792           *
    793           * @return  none
    794           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    795          void ZDApp_SaveNetworkStateEvt( void )
   \                     ZDApp_SaveNetworkStateEvt:
    796          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    797          #if defined ( NV_RESTORE )
    798           #if defined ( NV_TURN_OFF_RADIO )
    799            // Turn off the radio's receiver during an NV update
    800            uint8 RxOnIdle;
    801            uint8 x = false;
    802            ZMacGetReq( ZMacRxOnIdle, &RxOnIdle );
    803            ZMacSetReq( ZMacRxOnIdle, &x );
    804           #endif
    805          
    806            // Update the Network State in NV
    807            NLME_UpdateNV( NWK_NV_NIB_ENABLE        |
    808                           NWK_NV_DEVICELIST_ENABLE |
    809                           NWK_NV_BINDING_ENABLE    |
    810                           NWK_NV_ADDRMGR_ENABLE );
    811          
    812            // Reset the NV startup option to resume from NV by
    813            // clearing the "New" join option.
    814            zgWriteStartupOptions( FALSE, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
    815          
    816           #if defined ( NV_TURN_OFF_RADIO )
    817            ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
    818           #endif
    819          #endif  // NV_RESTORE
    820          }
   \   000000   02....       LJMP    ?BRET
    821          
    822          /*********************************************************************
    823           * @fn      ZDApp_RestoreNetworkState()
    824           *
    825           * @brief   This function will restore the network state of the
    826           *          device if the network state is stored in NV.
    827           *
    828           * @param   none
    829           *
    830           * @return
    831           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    832           *          restored.
    833           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was not used.
    834           *          This could mean that zgStartupOption said to not restore, or
    835           *          it could mean that there was no network state to restore.
    836           *
    837           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    838          uint8 ZDApp_RestoreNetworkState( void )
   \                     ZDApp_RestoreNetworkState:
    839          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    840            uint8 nvStat;
    841            nwkActiveKeyItems keyItems;
    842          
    843            // Initialize NWK NV items
    844            nvStat = NLME_InitNV();
   \   000005                ; Setup parameters for call to function NLME_InitNV
   \   000005   12....       LCALL   ??NLME_InitNV?relay
   \   000008   E9           MOV     A,R1
   \   000009   FE           MOV     R6,A
    845          
    846            if ( nvStat != NV_OPER_FAILED )
   \   00000A   740A         MOV     A,#0xa
   \   00000C   6E           XRL     A,R6
   \   00000D   603A         JZ      ??ZDApp_RestoreNetworkState_0
    847            {
    848              if ( NLME_RestoreFromNV() )
   \   00000F                ; Setup parameters for call to function NLME_RestoreFromNV
   \   00000F   12....       LCALL   ??NLME_RestoreFromNV?relay
   \   000012   E9           MOV     A,R1
   \   000013   6034         JZ      ??ZDApp_RestoreNetworkState_0
    849              {
    850                // Are we a coordinator
    851                ZDAppNwkAddr.addr.shortAddr = NLME_GetShortAddr();
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018   90....       MOV     DPTR,#ZDAppNwkAddr
   \   00001B   EA           MOV     A,R2
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   EB           MOV     A,R3
   \   00001F   F0           MOVX    @DPTR,A
    852                if ( ZDAppNwkAddr.addr.shortAddr == 0 )
   \   000020   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000023   E0           MOVX    A,@DPTR
   \   000024   7002         JNZ     ??ZDApp_RestoreNetworkState_1
   \   000026   A3           INC     DPTR
   \   000027   E0           MOVX    A,@DPTR
   \                     ??ZDApp_RestoreNetworkState_1:
   \   000028   7007         JNZ     ??ZDApp_RestoreNetworkState_2
    853                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   00002A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   54F8         ANL     A,#0xf8
   \   000030   F0           MOVX    @DPTR,A
    854                devStartMode = MODE_RESUME;
   \                     ??ZDApp_RestoreNetworkState_2:
   \   000031   7401         MOV     A,#0x1
   \   000033   90....       MOV     DPTR,#devStartMode
   \   000036   F0           MOVX    @DPTR,A
    855                osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   \   000037                ; Setup parameters for call to function sAddrExtCpy
   \   000037   7C..         MOV     R4,#((_NIB + 53) & 0xff)
   \   000039   7D..         MOV     R5,#(((_NIB + 53) >> 8) & 0xff)
   \   00003B   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   00003D   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   00003F   12....       LCALL   ??sAddrExtCpy?relay
    856              }
    857              else
    858                nvStat = NV_ITEM_UNINIT;
    859          
    860              if ( ZG_SECURE_ENABLED )
    861              {
    862                nwkFrameCounterChanges = 0;
    863                osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
    864                osal_nv_item_init( ZCD_NV_NWKKEY, sizeof(nwkActiveKeyItems), (void *)&keyItems );
    865          
    866                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    867                {
    868                  ZDApp_RestoreNwkKey();
    869                }
    870              }
    871          
    872              // The default for RxOnWhenIdle is true for Routers and false for end devices
    873              // [setup in the NLME_RestoreFromNV()].  Change it here if you want something
    874              // other than default.
    875            }
    876          
    877            if ( nvStat == ZSUCCESS )
   \   000042   EE           MOV     A,R6
   \   000043   7004         JNZ     ??ZDApp_RestoreNetworkState_0
    878              return ( ZDO_INITDEV_RESTORED_NETWORK_STATE );
   \   000045   7900         MOV     R1,#0x0
   \   000047   8002         SJMP    ??ZDApp_RestoreNetworkState_3
    879            else
    880              return ( ZDO_INITDEV_NEW_NETWORK_STATE );
   \                     ??ZDApp_RestoreNetworkState_0:
   \   000049   7901         MOV     R1,#0x1
   \                     ??ZDApp_RestoreNetworkState_3:
   \   00004B   02....       LJMP    ?Subroutine16 & 0xFFFF
    881          }
    882          
    883          /*********************************************************************
    884           * @fn      ZDApp_InitUserDesc()
    885           *
    886           * @brief   Initialize the User Descriptor, the descriptor is read from NV
    887           *          when needed.  If you want to initialize the User descriptor to
    888           *          something other than all zero, do it here.
    889           *
    890           * @param   none
    891           *
    892           * @return  none
    893           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    894          void ZDApp_InitUserDesc( void )
   \                     ZDApp_InitUserDesc:
    895          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    896            UserDescriptorFormat_t ZDO_DefaultUserDescriptor;
    897          
    898            // Initialize the User Descriptor, the descriptor is read from NV
    899            // when needed.  If you want to initialize the User descriptor to something
    900            // other than all zero, do it here.
    901            osal_memset( &ZDO_DefaultUserDescriptor, 0, sizeof( UserDescriptorFormat_t ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C11         MOV     R4,#0x11
   \   00000C   12....       LCALL   ?Subroutine10 & 0xFFFF
    902            if ( ZSUCCESS == osal_nv_item_init( ZCD_NV_USERDESC,
    903                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \                     ??CrossCallReturnLabel_14:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   7C11         MOV     R4,#0x11
   \   000014   7D00         MOV     R5,#0x0
   \   000016   7A81         MOV     R2,#-0x7f
   \   000018   7B00         MOV     R3,#0x0
   \   00001A   12....       LCALL   ??osal_nv_item_init?relay
   \   00001D   7402         MOV     A,#0x2
   \   00001F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000022   E9           MOV     A,R1
   \   000023   7033         JNZ     ??ZDApp_InitUserDesc_0
    904            {
    905              if ( ZSUCCESS == osal_nv_read( ZCD_NV_USERDESC, 0,
    906                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   000025                ; Setup parameters for call to function osal_nv_read
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002A   75..11       MOV     ?V0 + 0,#0x11
   \   00002D   75..00       MOV     ?V0 + 1,#0x0
   \   000030   78..         MOV     R0,#?V0 + 0
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000035   7C00         MOV     R4,#0x0
   \   000037   7D00         MOV     R5,#0x0
   \   000039   7A81         MOV     R2,#-0x7f
   \   00003B   7B00         MOV     R3,#0x0
   \   00003D   12....       LCALL   ??osal_nv_read?relay
   \   000040   7404         MOV     A,#0x4
   \   000042   12....       LCALL   ?DEALLOC_XSTACK8
   \   000045   E9           MOV     A,R1
   \   000046   7010         JNZ     ??ZDApp_InitUserDesc_0
    907              {
    908                if ( ZDO_DefaultUserDescriptor.len != 0 )
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6007         JZ      ??ZDApp_InitUserDesc_0
    909                {
    910                  ZDO_Config_Node_Descriptor.UserDescAvail = TRUE;
   \   000051   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000054   E0           MOVX    A,@DPTR
   \   000055   D2E4         SETB    0xE0 /* A   */.4
   \   000057   F0           MOVX    @DPTR,A
    911                }
    912              }
    913            }
    914          }
   \                     ??ZDApp_InitUserDesc_0:
   \   000058   7411         MOV     A,#0x11
   \   00005A   02....       LJMP    ??Subroutine25_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   7D00         MOV     R5,#0x0
   \   000002   7900         MOV     R1,#0x0
   \   000004   85..82       MOV     DPL,?XSP + 0
   \   000007   85..83       MOV     DPH,?XSP + 1
   \   00000A   AA82         MOV     R2,DPL
   \   00000C   AB83         MOV     R3,DPH
   \   00000E   12....       LCALL   ??osal_memset?relay
   \   000011                ; Setup parameters for call to function osal_nv_item_init
   \   000011                ; Setup parameters for call to function osal_nv_write
   \   000011   85..82       MOV     DPL,?XSP + 0
   \   000014   85..83       MOV     DPH,?XSP + 1
   \   000017   8582..       MOV     ?V0 + 0,DPL
   \   00001A   8583..       MOV     ?V0 + 1,DPH
   \   00001D   78..         MOV     R0,#?V0 + 0
   \   00001F   22           RET
    915          
    916          /*********************************************************************
    917           * @fn      ZDAppCheckForHoldKey()
    918           *
    919           * @brief   Check for key to set the device into Hold Auto Start
    920           *
    921           * @param   none
    922           *
    923           * @return  none
    924           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    925          void ZDAppCheckForHoldKey( void )
   \                     ZDAppCheckForHoldKey:
    926          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    927          #if (defined HAL_KEY) && (HAL_KEY == TRUE)
    928            // Get Keypad directly to see if a HOLD_START is needed.
    929            // Hold down the SW_BYPASS_START key (see OnBoard.h)
    930            // while booting to avoid starting up the device.
    931            if ( HalKeyRead () == SW_BYPASS_START)
   \   000004                ; Setup parameters for call to function HalKeyRead
   \   000004   12....       LCALL   ??HalKeyRead?relay
   \   000007   E9           MOV     A,R1
   \   000008   6408         XRL     A,#0x8
   \   00000A   7005         JNZ     ??ZDAppCheckForHoldKey_0
    932            {
    933              // Change the device state to HOLD on start up
    934              devState = DEV_HOLD;
   \   00000C   E4           CLR     A
   \   00000D   90....       MOV     DPTR,#devState
   \   000010   F0           MOVX    @DPTR,A
    935            }
    936          #endif // HAL_KEY
    937          }
   \                     ??ZDAppCheckForHoldKey_0:
   \   000011   02....       LJMP    ??Subroutine23_0 & 0xFFFF
    938          
    939          /*********************************************************************
    940           * @fn      ZDApp_ProcessOSALMsg()
    941           *
    942           * @brief   Process the incoming task message.
    943           *
    944           * @param   msgPtr - message to process
    945           *
    946           * @return  none
    947           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    948          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessOSALMsg:
    949          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    950            // Data Confirmation message fields
    951            uint8 sentEP;       // This should always be 0
    952            uint8 sentStatus;
    953            afDataConfirm_t *afDataConfirm;
    954            uint8 tmp;
    955          
    956            switch ( msgPtr->event )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessOSALMsg>_0`:
   \   00000C   00           DB        0
   \   00000D   02           DB        2
   \   00000E   1A           DB        26
   \   00000F   ....         DW        ??ZDApp_ProcessOSALMsg_0
   \   000011   D3           DB        211
   \   000012   ....         DW        ??ZDApp_ProcessOSALMsg_1
   \   000014   ....         DW        ??ZDApp_ProcessOSALMsg_2
    957            {
    958              // Incoming ZDO Message
    959              case AF_INCOMING_MSG_CMD:
    960                ZDP_IncomingData( (afIncomingMSGPacket_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_0:
   \   000016                ; Setup parameters for call to function ZDP_IncomingData
   \   000016   12....       LCALL   ??ZDP_IncomingData?relay
   \   000019   8003         SJMP    ??ZDApp_ProcessOSALMsg_2
    961                break;
    962                
    963              case ZDO_CB_MSG:
    964                ZDApp_ProcessMsgCBs( (zdoIncomingMsg_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_1:
   \   00001B                ; Setup parameters for call to function ZDApp_ProcessMsgCBs
   \   00001B   12....       LCALL   ??ZDApp_ProcessMsgCBs?relay
    965                break;
    966          
    967              case AF_DATA_CONFIRM_CMD:
    968                // This message is received as a confirmation of a data packet sent.
    969                // The status is of ZStatus_t type [defined in NLMEDE.h]
    970                // The message fields are defined in AF.h
    971                afDataConfirm = (afDataConfirm_t *)msgPtr;
    972                sentEP = afDataConfirm->endpoint;
    973                sentStatus = afDataConfirm->hdr.status;
    974          
    975                // Action taken when confirmation is received.
    976          #if defined ( ZIGBEE_FREQ_AGILITY )
    977                if ( pZDNwkMgr_ProcessDataConfirm )
    978                  pZDNwkMgr_ProcessDataConfirm( afDataConfirm );
    979          #endif
    980                (void)sentEP;
    981                (void)sentStatus;
    982                break;
    983          
    984              case ZDO_NWK_DISC_CNF:
    985                if (devState != DEV_NWK_DISC)
    986                  break;
    987                
    988                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
    989                {
    990                  if ( (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status == ZDO_SUCCESS) && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
    991                  {
    992                    if ( devStartMode == MODE_JOIN )
    993                    {
    994                      devState = DEV_NWK_JOINING;
    995            
    996                      ZDApp_NodeProfileSync((ZDO_NetworkDiscoveryCfm_t *)msgPtr);
    997            
    998                      if ( NLME_JoinRequest( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->extendedPANID,
    999                           BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB ),
   1000                           ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel,
   1001                           ZDO_Config_Node_Descriptor.CapabilityFlags ) != ZSuccess )
   1002                      {
   1003                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1004                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   1005                      }
   1006                    }
   1007                    else if ( devStartMode == MODE_REJOIN )
   1008                    {
   1009                      devState = DEV_NWK_REJOIN;
   1010          
   1011                      // Before trying to do rejoin, check if the device has a valid short address
   1012                      // If not, generate a random short address for itself
   1013                      if ( _NIB.nwkDevAddress == INVALID_NODE_ADDR )
   1014                      {
   1015                        _NIB.nwkDevAddress = osal_rand();
   1016                        ZMacSetReq( ZMacShortAddress, (byte*)&_NIB.nwkDevAddress );
   1017                      }
   1018          
   1019                      // Check if the device has a valid PanID, if not, set it to the discovered Pan
   1020                      if ( _NIB.nwkPanId == INVALID_PAN_ID )
   1021                      {
   1022                        _NIB.nwkPanId = BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB );
   1023                        ZMacSetReq( ZMacPanId, (byte*)&(_NIB.nwkPanId) );
   1024                      }
   1025          
   1026                      tmp = true;
   1027                      ZMacSetReq( ZMacRxOnIdle, &tmp ); // Set receiver always on during rejoin 
   1028                      if ( NLME_ReJoinRequest( ZDO_UseExtendedPANID, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel) != ZSuccess )
   1029                      {
   1030                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1031                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   1032                      }
   1033                    }
   1034            
   1035                    if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   1036                    {
   1037                      // The receiver is on, turn network layer polling off.
   1038                      NLME_SetPollRate( 0 );
   1039                      NLME_SetQueuedPollRate( 0 );
   1040                      NLME_SetResponseRate( 0 );
   1041                    }
   1042                    else
   1043                    {
   1044                      if ( (ZG_SECURE_ENABLED) && (devStartMode == MODE_JOIN) )
   1045                      {
   1046                        ZDApp_SavedPollRate = zgPollRate;
   1047                        NLME_SetPollRate( zgRejoinPollRate );
   1048                      }
   1049                    }
   1050                  }
   1051                  else
   1052                  {
   1053                    if ( continueJoining )
   1054                    {
   1055              #if defined ( MANAGED_SCAN )
   1056                      ZDApp_NetworkInit( MANAGEDSCAN_DELAY_BETWEEN_SCANS );
   1057              #else
   1058                      zdoDiscCounter++;
   1059                      ZDApp_NetworkInit( (uint16)(BEACON_REQUEST_DELAY
   1060                            + ((uint16)(osal_rand()& BEACON_REQ_DELAY_MASK))) );
   1061              #endif
   1062                    }
   1063                  }
   1064                }
   1065                break;
   1066          
   1067              case ZDO_NWK_JOIN_IND:
   1068                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1069                {
   1070                  ZDApp_ProcessNetworkJoin();
   1071                }
   1072                break;
   1073          
   1074              case ZDO_NWK_JOIN_REQ:
   1075                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1076                {
   1077                  retryCnt = 0;
   1078                  devStartMode = MODE_RESUME;
   1079                  _tmpRejoinState = true;
   1080                  osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   1081                  zgDefaultStartingScanDuration = BEACON_ORDER_60_MSEC;
   1082                  ZDApp_NetworkInit( 0 );
   1083                }
   1084                break;
   1085          
   1086              default:
   1087                if ( ZG_SECURE_ENABLED )
   1088                  ZDApp_ProcessSecMsg( msgPtr );
   1089                break;
   1090            }
   1091          
   1092          }
   \                     ??ZDApp_ProcessOSALMsg_2:
   \   00001E   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   1093          
   1094          /*********************************************************************
   1095           * @fn      ZDApp_ProcessMsgCBs()
   1096           *
   1097           * @brief   Process response messages
   1098           *
   1099           * @param   none
   1100           *
   1101           * @return  none
   1102           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1103          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_ProcessMsgCBs:
   1104          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 44
   \   000005   74D4         MOV     A,#-0x2c
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1105            switch ( inMsg->clusterID )
   \   00000E   EE           MOV     A,R6
   \   00000F   240C         ADD     A,#0xc
   \   000011   12....       LCALL   ??Subroutine24_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_40:
   \   000014   F5..         MOV     ?V0 + 0,A
   \   000016   A3           INC     DPTR
   \   000017   E0           MOVX    A,@DPTR
   \   000018   F5..         MOV     ?V0 + 1,A
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessMsgCBs>_0`:
   \   00001F   0300         DW        3
   \   000021   2100         DW        33
   \   000023   2200         DW        34
   \   000025   ....         DW        ??ZDApp_ProcessMsgCBs_0
   \   000027   0080         DW        32768
   \   000029   0180         DW        32769
   \   00002B   ....         DW        ??ZDApp_ProcessMsgCBs_1
   \   00002D   2180         DW        32801
   \   00002F   2280         DW        32802
   \   000031   ....         DW        ??ZDApp_ProcessMsgCBs_2
   \   000033   0100         DW        1
   \   000035   2000         DW        32
   \   000037   ....         DW        ??ZDApp_ProcessMsgCBs_3
   \   000039   ....         DW        ??ZDApp_ProcessMsgCBs_4
   1106            {
   1107          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1108              case NWK_addr_rsp:
   1109              case IEEE_addr_rsp:
   1110                {
   1111                  ZDO_NwkIEEEAddrResp_t *pAddrRsp;
   1112                  pAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \                     ??ZDApp_ProcessMsgCBs_1:
   \   00003B                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   00003B   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   00003E   8A..         MOV     ?V0 + 0,R2
   \   000040   8B..         MOV     ?V0 + 1,R3
   \   000042   AE..         MOV     R6,?V0 + 0
   \   000044   AF..         MOV     R7,?V0 + 1
   1113                  if ( pAddrRsp )
   \   000046   EE           MOV     A,R6
   \   000047   7001         JNZ     ??ZDApp_ProcessMsgCBs_5
   \   000049   EF           MOV     A,R7
   \                     ??ZDApp_ProcessMsgCBs_5:
   \   00004A   7003         JNZ     $+5
   \   00004C   02....       LJMP    ??ZDApp_ProcessMsgCBs_4 & 0xFFFF
   1114                  {
   1115                    if ( pAddrRsp->status == ZSuccess )
   \   00004F   8E82         MOV     DPL,R6
   \   000051   8F83         MOV     DPH,R7
   \   000053   E0           MOVX    A,@DPTR
   \   000054   7011         JNZ     ??ZDApp_ProcessMsgCBs_6
   1116                    {
   1117                      ZDO_UpdateAddrManager( pAddrRsp->nwkAddr, pAddrRsp->extAddr );
   \   000056                ; Setup parameters for call to function ZDO_UpdateAddrManager
   \   000056   EE           MOV     A,R6
   \   000057   2403         ADD     A,#0x3
   \   000059   FC           MOV     R4,A
   \   00005A   EF           MOV     A,R7
   \   00005B   3400         ADDC    A,#0x0
   \   00005D   FD           MOV     R5,A
   \   00005E   A3           INC     DPTR
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   FA           MOV     R2,A
   \   000061   A3           INC     DPTR
   \   000062   E0           MOVX    A,@DPTR
   \   000063   FB           MOV     R3,A
   \   000064   12....       LCALL   ??ZDO_UpdateAddrManager?relay
   1118                    }
   1119                    osal_mem_free( pAddrRsp );
   \                     ??ZDApp_ProcessMsgCBs_6:
   \   000067                ; Setup parameters for call to function osal_mem_free
   \   000067   EE           MOV     A,R6
   \   000068   FA           MOV     R2,A
   \   000069   EF           MOV     A,R7
   \   00006A   02....       LJMP    ??ZDApp_ProcessMsgCBs_7 & 0xFFFF
   1120                  }
   1121                }
   1122                break;
   1123          #endif
   1124                
   1125          #if defined ( REFLECTOR )
   1126              case Bind_req:
   1127              case Unbind_req:
   1128                {
   1129                  ZDO_BindUnbindReq_t bindReq;
   1130                  ZDO_ParseBindUnbindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_0:
   \   00006D                ; Setup parameters for call to function ZDO_ParseBindUnbindReq
   \   00006D   7417         MOV     A,#0x17
   \   00006F   12....       LCALL   ?XSTACK_DISP0_8
   \   000072   AC82         MOV     R4,DPL
   \   000074   AD83         MOV     R5,DPH
   \   000076   12....       LCALL   ??ZDO_ParseBindUnbindReq?relay
   1131                  ZDO_ProcessBindUnbindReq( inMsg, &bindReq );
   \   000079                ; Setup parameters for call to function ZDO_ProcessBindUnbindReq
   \   000079   7417         MOV     A,#0x17
   \   00007B   12....       LCALL   ?XSTACK_DISP0_8
   \   00007E   AC82         MOV     R4,DPL
   \   000080   AD83         MOV     R5,DPH
   \   000082   EE           MOV     A,R6
   \   000083   FA           MOV     R2,A
   \   000084   EF           MOV     A,R7
   \   000085   FB           MOV     R3,A
   \   000086   12....       LCALL   ??ZDO_ProcessBindUnbindReq?relay
   \   000089   8075         SJMP    ??ZDApp_ProcessMsgCBs_4
   1132                }
   1133                break;
   1134          #endif      
   1135                
   1136          #if defined ( ZDO_COORDINATOR )
   1137              case Bind_rsp:
   1138              case Unbind_rsp:
   1139                if ( matchED )
   \                     ??ZDApp_ProcessMsgCBs_2:
   \   00008B   90....       MOV     DPTR,#matchED
   \   00008E   E0           MOVX    A,@DPTR
   \   00008F   7002         JNZ     ??ZDApp_ProcessMsgCBs_8
   \   000091   A3           INC     DPTR
   \   000092   E0           MOVX    A,@DPTR
   \                     ??ZDApp_ProcessMsgCBs_8:
   \   000093   606B         JZ      ??ZDApp_ProcessMsgCBs_4
   1140                {
   1141                  ZDMatchSendState(
   1142                       (uint8)((inMsg->clusterID == Bind_rsp) ? ZDMATCH_REASON_BIND_RSP : ZDMATCH_REASON_UNBIND_RSP),
   1143                       ZDO_ParseBindRsp(inMsg), inMsg->TransSeq );
   \   000095   7421         MOV     A,#0x21
   \   000097   65..         XRL     A,?V0 + 0
   \   000099   7004         JNZ     ??ZDApp_ProcessMsgCBs_9
   \   00009B   7480         MOV     A,#-0x80
   \   00009D   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessMsgCBs_9:
   \   00009F   7004         JNZ     ??ZDApp_ProcessMsgCBs_10
   \   0000A1   7903         MOV     R1,#0x3
   \   0000A3   8002         SJMP    ??ZDApp_ProcessMsgCBs_11
   \                     ??ZDApp_ProcessMsgCBs_10:
   \   0000A5   7902         MOV     R1,#0x2
   \                     ??ZDApp_ProcessMsgCBs_11:
   \   0000A7                ; Setup parameters for call to function ZDMatchSendState
   \   0000A7   12....       LCALL   ?Subroutine9 & 0xFFFF
   1144                }
   \                     ??CrossCallReturnLabel_45:
   \   0000AA   FB           MOV     R3,A
   \   0000AB   EE           MOV     A,R6
   \   0000AC   2413         ADD     A,#0x13
   \   0000AE   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   0000B1   F583         MOV     DPH,A
   \   0000B3   8882         MOV     DPL,R0
   \   0000B5   E0           MOVX    A,@DPTR
   \   0000B6   FA           MOV     R2,A
   \   0000B7   12....       LCALL   ??ZDMatchSendState?relay
   \   0000BA   8044         SJMP    ??ZDApp_ProcessMsgCBs_4
   1145                break;
   1146                
   1147              case End_Device_Bind_req:
   1148                {
   1149                  ZDEndDeviceBind_t bindReq;
   1150                  ZDO_ParseEndDeviceBindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_3:
   \   0000BC                ; Setup parameters for call to function ZDO_ParseEndDeviceBindReq
   \   0000BC   85..82       MOV     DPL,?XSP + 0
   \   0000BF   85..83       MOV     DPH,?XSP + 1
   \   0000C2   AC82         MOV     R4,DPL
   \   0000C4   AD83         MOV     R5,DPH
   \   0000C6   12....       LCALL   ??ZDO_ParseEndDeviceBindReq?relay
   1151                  ZDO_MatchEndDeviceBind( &bindReq );
   \   0000C9                ; Setup parameters for call to function ZDO_MatchEndDeviceBind
   \   0000C9   85..82       MOV     DPL,?XSP + 0
   \   0000CC   85..83       MOV     DPH,?XSP + 1
   \   0000CF   AA82         MOV     R2,DPL
   \   0000D1   AB83         MOV     R3,DPH
   \   0000D3   12....       LCALL   ??ZDO_MatchEndDeviceBind?relay
   1152                  
   1153                  // Freeing the cluster lists - if allocated.
   1154                  if ( bindReq.numInClusters )
   \   0000D6   7411         MOV     A,#0x11
   \   0000D8   12....       LCALL   ?XSTACK_DISP0_8
   \   0000DB   E0           MOVX    A,@DPTR
   \   0000DC   600D         JZ      ??ZDApp_ProcessMsgCBs_12
   1155                    osal_mem_free( bindReq.inClusters );
   \   0000DE                ; Setup parameters for call to function osal_mem_free
   \   0000DE   7412         MOV     A,#0x12
   \   0000E0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E3   E0           MOVX    A,@DPTR
   \   0000E4   FA           MOV     R2,A
   \   0000E5   A3           INC     DPTR
   \   0000E6   E0           MOVX    A,@DPTR
   \   0000E7   FB           MOV     R3,A
   \   0000E8   12....       LCALL   ??osal_mem_free?relay
   1156                  if ( bindReq.numOutClusters )
   \                     ??ZDApp_ProcessMsgCBs_12:
   \   0000EB   7414         MOV     A,#0x14
   \   0000ED   12....       LCALL   ?XSTACK_DISP0_8
   \   0000F0   E0           MOVX    A,@DPTR
   \   0000F1   600D         JZ      ??ZDApp_ProcessMsgCBs_4
   1157                    osal_mem_free( bindReq.outClusters );
   \   0000F3                ; Setup parameters for call to function osal_mem_free
   \   0000F3   7415         MOV     A,#0x15
   \   0000F5   12....       LCALL   ?XSTACK_DISP0_8
   \   0000F8   E0           MOVX    A,@DPTR
   \   0000F9   FA           MOV     R2,A
   \   0000FA   A3           INC     DPTR
   \   0000FB   E0           MOVX    A,@DPTR
   \                     ??ZDApp_ProcessMsgCBs_7:
   \   0000FC   FB           MOV     R3,A
   \   0000FD   12....       LCALL   ??osal_mem_free?relay
   1158                }
   1159                break;
   1160          #endif      
   1161            }
   1162          }
   \                     ??ZDApp_ProcessMsgCBs_4:
   \   000100   742C         MOV     A,#0x2c
   \   000102   02....       LJMP    ??Subroutine25_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   EE           MOV     A,R6
   \   000001   240F         ADD     A,#0xf
   \   000003                REQUIRE ??Subroutine24_0
   \   000003                ; // Fall through to label ??Subroutine24_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine24_0:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   E0           MOVX    A,@DPTR
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   E0           MOVX    A,@DPTR
   \   000008   F8           MOV     R0,A
   \   000009   A3           INC     DPTR
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   22           RET
   1163          
   1164          /*********************************************************************
   1165           * @fn      ZDApp_RegisterCBs()
   1166           *
   1167           * @brief   Process response messages
   1168           *
   1169           * @param   none
   1170           *
   1171           * @return  none
   1172           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1173          void ZDApp_RegisterCBs( void )
   \                     ZDApp_RegisterCBs:
   1174          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1175          #if defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1176            ZDO_RegisterForZDOMsg( ZDAppTaskID, IEEE_addr_rsp );
   \   000004                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000004   7A01         MOV     R2,#0x1
   \   000006   12....       LCALL   ?Subroutine3 & 0xFFFF
   1177          #endif
   1178          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( REFLECTOR )
   1179            ZDO_RegisterForZDOMsg( ZDAppTaskID, NWK_addr_rsp );
   \                     ??CrossCallReturnLabel_29:
   \   000009                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000009   7A00         MOV     R2,#0x0
   \   00000B   12....       LCALL   ?Subroutine3 & 0xFFFF
   1180          #endif  
   1181          #if defined ( ZDO_COORDINATOR )
   1182            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_rsp );
   \                     ??CrossCallReturnLabel_30:
   \   00000E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00000E   7A21         MOV     R2,#0x21
   \   000010   12....       LCALL   ?Subroutine3 & 0xFFFF
   1183            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_rsp );
   \                     ??CrossCallReturnLabel_31:
   \   000013                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000013   7A22         MOV     R2,#0x22
   \   000015   12....       LCALL   ?Subroutine3 & 0xFFFF
   1184            ZDO_RegisterForZDOMsg( ZDAppTaskID, End_Device_Bind_req );
   \                     ??CrossCallReturnLabel_32:
   \   000018                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000018   7A20         MOV     R2,#0x20
   \   00001A   7B00         MOV     R3,#0x0
   \   00001C   12....       LCALL   ??Subroutine21_0 & 0xFFFF
   1185          #endif
   1186          #if defined ( REFLECTOR )
   1187            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_req );
   \                     ??CrossCallReturnLabel_33:
   \   00001F                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00001F   7A21         MOV     R2,#0x21
   \   000021   7B00         MOV     R3,#0x0
   \   000023   12....       LCALL   ??Subroutine21_0 & 0xFFFF
   1188            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_req );
   \                     ??CrossCallReturnLabel_34:
   \   000026                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000026   7A22         MOV     R2,#0x22
   \   000028   7B00         MOV     R3,#0x0
   \   00002A   12....       LCALL   ??Subroutine21_0 & 0xFFFF
   1189          #endif  
   1190          }
   \                     ??CrossCallReturnLabel_35:
   \   00002D   02....       LJMP    ??Subroutine23_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   7B80         MOV     R3,#-0x80
   \   000002                REQUIRE ??Subroutine21_0
   \   000002                ; // Fall through to label ??Subroutine21_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine21_0:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000008   22           RET
   1191          
   1192          /*********************************************************************
   1193           * @fn      ZDApp_ProcessSecMsg()
   1194           *
   1195           * @brief   Process the incoming security message.
   1196           *
   1197           * @param   msgPtr - message to process
   1198           *
   1199           * @return  none
   1200           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1201          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessSecMsg:
   1202          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1203            switch ( msgPtr->event )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   6407         XRL     A,#0x7
   \   00000B   7003         JNZ     ??ZDApp_ProcessSecMsg_0
   1204            {
   1205              case ZDO_ESTABLISH_KEY_CFM:
   1206                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1207                {
   1208                  ZDSecMgrEstablishKeyCfm( (ZDO_EstablishKeyCfm_t*)msgPtr );
   1209                }
   1210                break;
   1211          
   1212              case ZDO_ESTABLISH_KEY_IND:
   1213                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1214                {
   1215                  if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1216                  {
   1217                    ZDSecMgrEstablishKeyInd( (ZDO_EstablishKeyInd_t*)msgPtr );
   1218                  }
   1219                }
   1220                break;
   1221          
   1222              case ZDO_TRANSPORT_KEY_IND:
   1223                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1224                {
   1225                  ZDSecMgrTransportKeyInd( (ZDO_TransportKeyInd_t*)msgPtr );
   1226                }
   1227                break;
   1228          
   1229              case ZDO_UPDATE_DEVICE_IND:
   1230                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1231                {
   1232                  ZDSecMgrUpdateDeviceInd( (ZDO_UpdateDeviceInd_t*)msgPtr );
   \   00000D                ; Setup parameters for call to function ZDSecMgrUpdateDeviceInd
   \   00000D   12....       LCALL   ??ZDSecMgrUpdateDeviceInd?relay
   1233                }
   1234                break;
   1235          
   1236              case ZDO_REMOVE_DEVICE_IND:
   1237                if ( ZG_BUILD_RTRONLY_TYPE && ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER ) )
   1238                {
   1239                  ZDSecMgrRemoveDeviceInd( (ZDO_RemoveDeviceInd_t*)msgPtr );
   1240                }
   1241                break;
   1242          
   1243              case ZDO_REQUEST_KEY_IND:
   1244                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1245                {
   1246                  if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1247                  {
   1248                    ZDSecMgrRequestKeyInd( (ZDO_RequestKeyInd_t*)msgPtr );
   1249                  }
   1250                }
   1251                break;
   1252          
   1253              case ZDO_SWITCH_KEY_IND:
   1254                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1255                {
   1256                  ZDSecMgrSwitchKeyInd( (ZDO_SwitchKeyInd_t*)msgPtr );
   1257                }
   1258                break;
   1259              
   1260              case ZDO_AUTHENTICATE_IND:
   1261                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1262                {
   1263                  ZDSecMgrAuthenticateInd( (ZDO_AuthenticateInd_t*)msgPtr );
   1264                }
   1265                break;
   1266          
   1267              case ZDO_AUTHENTICATE_CFM:
   1268                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1269                {
   1270                  ZDSecMgrAuthenticateCfm( (ZDO_AuthenticateCfm_t*)msgPtr );
   1271                }
   1272                break;
   1273          
   1274              default:
   1275                // Unsupported messages
   1276                break;
   1277            }
   1278          }
   \                     ??ZDApp_ProcessSecMsg_0:
   \   000010   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   1279          
   1280          /*********************************************************************
   1281           * @fn      ZDApp_ProcessNetworkJoin()
   1282           *
   1283           * @brief
   1284           *
   1285           *   Save off the Network key information.
   1286           *
   1287           * @param   none
   1288           *
   1289           * @return  none
   1290           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1291          void ZDApp_ProcessNetworkJoin( void )
   \                     ZDApp_ProcessNetworkJoin:
   1292          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1293            if ( (devState == DEV_NWK_JOINING) ||
   1294                ((devState == DEV_NWK_ORPHAN)  &&
   1295                 (ZDO_Config_Node_Descriptor.LogicalType == NODETYPE_ROUTER)) )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6403         XRL     A,#0x3
   \   000010   6015         JZ      ??ZDApp_ProcessNetworkJoin_0
   \   000012   E0           MOVX    A,@DPTR
   \   000013   640A         XRL     A,#0xa
   \   000015   6003         JZ      $+5
   \   000017   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   \   00001A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   5407         ANL     A,#0x7
   \   000020   6401         XRL     A,#0x1
   \   000022   6003         JZ      $+5
   \   000024   02....       LJMP    ??ZDApp_ProcessNetworkJoin_2 & 0xFFFF
   1296            {
   1297              // Result of a Join attempt by this device.
   1298              if ( nwkStatus == ZSuccess )
   \                     ??ZDApp_ProcessNetworkJoin_0:
   \   000027   90....       MOV     DPTR,#nwkStatus
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   703A         JNZ     ??ZDApp_ProcessNetworkJoin_3
   1299              {
   1300                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00002D                ; Setup parameters for call to function osal_set_event
   \   00002D   12....       LCALL   ?Subroutine2 & 0xFFFF
   1301          
   1302          #if defined ( POWER_SAVING )
   1303                osal_pwrmgr_device( PWRMGR_BATTERY );
   1304          #endif
   1305          
   1306                if ( ZG_SECURE_ENABLED && ( ZDApp_RestoreNwkKey() == false ) )
   1307                {
   1308                  // wait for auth from trust center!!
   1309                  devState = DEV_END_DEVICE_UNAUTH;
   1310          
   1311                  // Start the reset timer for MAX UNAUTH time
   1312                  ZDApp_ResetTimerStart( 10000 );//MAX_DEVICE_UNAUTH_TIMEOUT );
   1313                }
   1314                else
   1315                {
   1316                  if ( ZSTACK_ROUTER_BUILD )
   1317                  {
   1318                    if ( devState == DEV_NWK_ORPHAN 
   1319                      && ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??CrossCallReturnLabel_20:
   \   000030   90....       MOV     DPTR,#devState
   \   000033   E0           MOVX    A,@DPTR
   \   000034   640A         XRL     A,#0xa
   \   000036   700D         JNZ     ??ZDApp_ProcessNetworkJoin_4
   \   000038   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   00003B   6010         JZ      ??ZDApp_ProcessNetworkJoin_5
   1320                    {
   1321                      // Change NIB state to router for restore
   1322                      _NIB.nwkState = NWK_ROUTER;
   \   00003D   7408         MOV     A,#0x8
   \   00003F   90....       MOV     DPTR,#(_NIB + 35)
   \   000042   F0           MOVX    @DPTR,A
   \   000043   8008         SJMP    ??ZDApp_ProcessNetworkJoin_5
   1323                    }
   1324                  }
   1325                          
   1326                  if ( devState == DEV_NWK_JOINING )
   \                     ??ZDApp_ProcessNetworkJoin_4:
   \   000045   E0           MOVX    A,@DPTR
   \   000046   6403         XRL     A,#0x3
   \   000048   7003         JNZ     ??ZDApp_ProcessNetworkJoin_5
   1327                  {
   1328                    ZDApp_AnnounceNewAddress();
   \   00004A                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00004A   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1329                  }
   1330                  
   1331                  devState = DEV_END_DEVICE;
   \                     ??ZDApp_ProcessNetworkJoin_5:
   \   00004D   7406         MOV     A,#0x6
   \   00004F   90....       MOV     DPTR,#devState
   \   000052   F0           MOVX    @DPTR,A
   1332                  if ( ZSTACK_ROUTER_BUILD )
   1333                  {
   1334                    // NOTE: first two parameters are not used, see NLMEDE.h for details
   1335                    if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \   000053   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000056   7003         JNZ     $+5
   \   000058   02....       LJMP    ??ZDApp_ProcessNetworkJoin_6 & 0xFFFF
   1336                    {
   1337                      NLME_StartRouterRequest( 0, 0, false );
   \   00005B                ; Setup parameters for call to function NLME_StartRouterRequest
   \   00005B   7B00         MOV     R3,#0x0
   \   00005D   7A00         MOV     R2,#0x0
   \   00005F   7900         MOV     R1,#0x0
   \   000061   12....       LCALL   ??NLME_StartRouterRequest?relay
   \   000064   02....       LJMP    ??ZDApp_ProcessNetworkJoin_6 & 0xFFFF
   1338                    }
   1339                  }
   1340                }
   1341              }
   1342              else
   1343              {
   1344                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_3:
   \   000067   90....       MOV     DPTR,#devStartMode
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   6401         XRL     A,#0x1
   \   00006D   7031         JNZ     ??ZDApp_ProcessNetworkJoin_7
   \   00006F   90....       MOV     DPTR,#retryCnt
   \   000072   E0           MOVX    A,@DPTR
   \   000073   04           INC     A
   \   000074   F0           MOVX    @DPTR,A
   \   000075   C3           CLR     C
   \   000076   9403         SUBB    A,#0x3
   \   000078   4026         JC      ??ZDApp_ProcessNetworkJoin_7
   1345                {
   1346                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   00007A   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   00007D   7003         JNZ     ??ZDApp_ProcessNetworkJoin_8
   \   00007F   74FF         MOV     A,#-0x1
   \   000081   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_8:
   \   000082   600A         JZ      ??ZDApp_ProcessNetworkJoin_9
   \   000084   74FE         MOV     A,#-0x2
   \   000086   68           XRL     A,R0
   \   000087   7003         JNZ     ??ZDApp_ProcessNetworkJoin_10
   \   000089   74FF         MOV     A,#-0x1
   \   00008B   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_10:
   \   00008C   7006         JNZ     ??ZDApp_ProcessNetworkJoin_11
   1347                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_9:
   \   00008E   E4           CLR     A
   \   00008F   90....       MOV     DPTR,#devStartMode
   \   000092   800B         SJMP    ??ZDApp_ProcessNetworkJoin_12
   1348                  else
   1349                  {
   1350                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_11:
   \   000094   7403         MOV     A,#0x3
   \   000096   90....       MOV     DPTR,#devStartMode
   \   000099   F0           MOVX    @DPTR,A
   1351                    _tmpRejoinState = true;
   \   00009A   7401         MOV     A,#0x1
   \   00009C   90....       MOV     DPTR,#_tmpRejoinState
   \                     ??ZDApp_ProcessNetworkJoin_12:
   \   00009F   F0           MOVX    @DPTR,A
   1352                  }
   1353                }
   1354          
   1355                if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   1356                     (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??ZDApp_ProcessNetworkJoin_7:
   \   0000A0                ; Setup parameters for call to function NLME_GetShortAddr
   \   0000A0   12....       LCALL   ??NLME_GetShortAddr?relay
   \   0000A3   8A..         MOV     ?V0 + 0,R2
   \   0000A5   8B..         MOV     ?V0 + 1,R3
   \   0000A7   74FE         MOV     A,#-0x2
   \   0000A9   65..         XRL     A,?V0 + 0
   \   0000AB   7004         JNZ     ??ZDApp_ProcessNetworkJoin_13
   \   0000AD   74FF         MOV     A,#-0x1
   \   0000AF   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessNetworkJoin_13:
   \   0000B1   700E         JNZ     ??ZDApp_ProcessNetworkJoin_14
   \   0000B3   90....       MOV     DPTR,#(_NIB + 20)
   \   0000B6   E0           MOVX    A,@DPTR
   \   0000B7   64FE         XRL     A,#0xfe
   \   0000B9   7004         JNZ     ??ZDApp_ProcessNetworkJoin_15
   \   0000BB   A3           INC     DPTR
   \   0000BC   E0           MOVX    A,@DPTR
   \   0000BD   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_15:
   \   0000BF   6026         JZ      ??ZDApp_ProcessNetworkJoin_16
   1357                {
   1358                  uint16 addr = INVALID_NODE_ADDR;
   \                     ??ZDApp_ProcessNetworkJoin_14:
   \   0000C1   85..82       MOV     DPL,?XSP + 0
   \   0000C4   85..83       MOV     DPH,?XSP + 1
   \   0000C7   74FE         MOV     A,#-0x2
   \   0000C9   F0           MOVX    @DPTR,A
   \   0000CA   A3           INC     DPTR
   \   0000CB   74FF         MOV     A,#-0x1
   \   0000CD   F0           MOVX    @DPTR,A
   1359                  // Invalidate nwk addr so end device does not use in its data reqs.
   1360                  _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   0000CE   90....       MOV     DPTR,#(_NIB + 20)
   \   0000D1   74FE         MOV     A,#-0x2
   \   0000D3   F0           MOVX    @DPTR,A
   \   0000D4   A3           INC     DPTR
   \   0000D5   74FF         MOV     A,#-0x1
   \   0000D7   F0           MOVX    @DPTR,A
   1361                  ZMacSetReq( ZMacShortAddress, (uint8 *)&addr );
   \   0000D8                ; Setup parameters for call to function ZMacSetReq
   \   0000D8   85..82       MOV     DPL,?XSP + 0
   \   0000DB   85..83       MOV     DPH,?XSP + 1
   \   0000DE   AA82         MOV     R2,DPL
   \   0000E0   AB83         MOV     R3,DPH
   \   0000E2   7953         MOV     R1,#0x53
   \   0000E4   12....       LCALL   ??ZMacSetReq?relay
   1362                }
   1363          
   1364                zdoDiscCounter = 1;
   \                     ??ZDApp_ProcessNetworkJoin_16:
   \   0000E7   7401         MOV     A,#0x1
   \   0000E9   90....       MOV     DPTR,#zdoDiscCounter
   \                     ??ZDApp_ProcessNetworkJoin_17:
   \   0000EC   F0           MOVX    @DPTR,A
   1365          
   1366          //      ZDApp_NetworkInit( (uint16)
   1367          //                         ((NWK_START_DELAY * (osal_rand() & 0x0F)) +
   1368          //                          (NWK_START_DELAY * 5)) );
   1369                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1370                     + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   0000ED                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000ED                ; Setup parameters for call to function osal_rand
   \   0000ED   02....       LJMP    ??ZDApp_ProcessNetworkJoin_18 & 0xFFFF
   1371              }
   1372            }
   1373            else if ( devState == DEV_NWK_ORPHAN || devState == DEV_NWK_REJOIN )
   \                     ??ZDApp_ProcessNetworkJoin_1:
   \   0000F0   E0           MOVX    A,@DPTR
   \   0000F1   6404         XRL     A,#0x4
   \   0000F3   6003         JZ      $+5
   \   0000F5   02....       LJMP    ??ZDApp_ProcessNetworkJoin_6 & 0xFFFF
   1374            {
   1375              // results of an orphaning attempt by this device
   1376              if (nwkStatus == ZSuccess)
   \                     ??ZDApp_ProcessNetworkJoin_2:
   \   0000F8   90....       MOV     DPTR,#nwkStatus
   \   0000FB   E0           MOVX    A,@DPTR
   \   0000FC   7033         JNZ     ??ZDApp_ProcessNetworkJoin_19
   1377              {
   1378                if ( ZG_SECURE_ENABLED )
   1379                {
   1380                  ZDApp_RestoreNwkKey();
   1381                }
   1382                
   1383                devState = DEV_END_DEVICE;
   \   0000FE   12....       LCALL   ?Subroutine0 & 0xFFFF
   1384                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1385                // setup Power Manager Device
   1386          #if defined ( POWER_SAVING )
   1387                osal_pwrmgr_device( PWRMGR_BATTERY );
   1388          #endif
   1389          
   1390                if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??CrossCallReturnLabel_25:
   \   000101   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000104   E0           MOVX    A,@DPTR
   \   000105   A2E3         MOV     C,0xE0 /* A   */.3
   \   000107   5015         JNC     ??ZDApp_ProcessNetworkJoin_20
   1391                {
   1392                  // The receiver is on, turn network layer polling off.
   1393                  NLME_SetPollRate( 0 );
   \   000109                ; Setup parameters for call to function NLME_SetPollRate
   \   000109   7A00         MOV     R2,#0x0
   \   00010B   7B00         MOV     R3,#0x0
   \   00010D   12....       LCALL   ??NLME_SetPollRate?relay
   1394                  NLME_SetQueuedPollRate( 0 );
   \   000110                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000110   7A00         MOV     R2,#0x0
   \   000112   7B00         MOV     R3,#0x0
   \   000114   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   1395                  NLME_SetResponseRate( 0 );
   \   000117                ; Setup parameters for call to function NLME_SetResponseRate
   \   000117   7A00         MOV     R2,#0x0
   \   000119   7B00         MOV     R3,#0x0
   \   00011B   12....       LCALL   ??NLME_SetResponseRate?relay
   1396                }
   1397          
   1398                if ( ZSTACK_ROUTER_BUILD )
   1399                {
   1400                  // NOTE: first two parameters are not used, see NLMEDE.h for details
   1401                  if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??ZDApp_ProcessNetworkJoin_20:
   \   00011E   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000121   6009         JZ      ??ZDApp_ProcessNetworkJoin_21
   1402                  {
   1403                    NLME_StartRouterRequest( 0, 0, false );
   \   000123                ; Setup parameters for call to function NLME_StartRouterRequest
   \   000123   7B00         MOV     R3,#0x0
   \   000125   7A00         MOV     R2,#0x0
   \   000127   7900         MOV     R1,#0x0
   \   000129   12....       LCALL   ??NLME_StartRouterRequest?relay
   1404                  }
   1405                }
   1406                
   1407                ZDApp_AnnounceNewAddress();
   \                     ??ZDApp_ProcessNetworkJoin_21:
   \   00012C                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00012C   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   \   00012F   8055         SJMP    ??ZDApp_ProcessNetworkJoin_6
   1408              }
   1409              else
   1410              {
   1411                if ( devStartMode == MODE_RESUME )
   \                     ??ZDApp_ProcessNetworkJoin_19:
   \   000131   90....       MOV     DPTR,#devStartMode
   \   000134   E0           MOVX    A,@DPTR
   \   000135   6401         XRL     A,#0x1
   \   000137   703A         JNZ     ??ZDApp_ProcessNetworkJoin_18
   1412                {
   1413                  if ( ++retryCnt <= MAX_RESUME_RETRY )
   \   000139   90....       MOV     DPTR,#retryCnt
   \   00013C   E0           MOVX    A,@DPTR
   \   00013D   04           INC     A
   \   00013E   F0           MOVX    @DPTR,A
   \   00013F   C3           CLR     C
   \   000140   9404         SUBB    A,#0x4
   \   000142   5027         JNC     ??ZDApp_ProcessNetworkJoin_22
   1414                  {
   1415                    if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   000144   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   000147   7003         JNZ     ??ZDApp_ProcessNetworkJoin_23
   \   000149   74FF         MOV     A,#-0x1
   \   00014B   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_23:
   \   00014C   600A         JZ      ??ZDApp_ProcessNetworkJoin_24
   \   00014E   74FE         MOV     A,#-0x2
   \   000150   68           XRL     A,R0
   \   000151   7003         JNZ     ??ZDApp_ProcessNetworkJoin_25
   \   000153   74FF         MOV     A,#-0x1
   \   000155   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_25:
   \   000156   7006         JNZ     ??ZDApp_ProcessNetworkJoin_26
   1416                      devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_24:
   \   000158   E4           CLR     A
   \   000159   90....       MOV     DPTR,#devStartMode
   \   00015C   808E         SJMP    ??ZDApp_ProcessNetworkJoin_17
   1417                    else
   1418                    {
   1419                      devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_26:
   \   00015E   7403         MOV     A,#0x3
   \   000160   90....       MOV     DPTR,#devStartMode
   \   000163   F0           MOVX    @DPTR,A
   1420                      _tmpRejoinState = true;
   \   000164   7401         MOV     A,#0x1
   \   000166   90....       MOV     DPTR,#_tmpRejoinState
   \   000169   8081         SJMP    ??ZDApp_ProcessNetworkJoin_17
   1421                    }
   1422                  }
   1423                  // Do a normal join to the network after certain times of rejoin retries
   1424                  else if( AIB_apsUseInsecureJoin == true )
   \                     ??ZDApp_ProcessNetworkJoin_22:
   \   00016B   90....       MOV     DPTR,#AIB_apsUseInsecureJoin
   \   00016E   E0           MOVX    A,@DPTR
   \   00016F   6401         XRL     A,#0x1
   \   000171   60E5         JZ      ??ZDApp_ProcessNetworkJoin_24
   1425                  {
   1426                    devStartMode = MODE_JOIN;
   1427                  }
   1428                }
   1429          
   1430          
   1431                // setup a retry for later...
   1432                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1433                     + (osal_rand()& EXTENDED_JOINING_RANDOM_MASK)) );
   \                     ??ZDApp_ProcessNetworkJoin_18:
   \   000173                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000173                ; Setup parameters for call to function osal_rand
   \   000173   12....       LCALL   ??osal_rand?relay
   \   000176   8A..         MOV     ?V0 + 0,R2
   \   000178   747F         MOV     A,#0x7f
   \   00017A   55..         ANL     A,?V0 + 0
   \   00017C   F8           MOV     R0,A
   \   00017D   7464         MOV     A,#0x64
   \   00017F   28           ADD     A,R0
   \   000180   FA           MOV     R2,A
   \   000181   7B00         MOV     R3,#0x0
   \   000183   12....       LCALL   ??ZDApp_NetworkInit?relay
   1434              }
   1435            }
   1436          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
   1437            else
   1438            {
   1439              // Assume from address conflict
   1440              if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   1441              {
   1442                // Notify the network
   1443                ZDApp_AnnounceNewAddress();
   1444                
   1445                // Notify apps
   1446                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1447              }
   1448            }
   1449          #endif
   1450          }
   \                     ??ZDApp_ProcessNetworkJoin_6:
   \   000186   02....       LJMP    ?Subroutine15 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   90....       MOV     DPTR,#(_NIB + 33)
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F8           MOV     R0,A
   \   000005   A3           INC     DPTR
   \   000006   E0           MOVX    A,@DPTR
   \   000007   F9           MOV     R1,A
   \   000008   74FF         MOV     A,#-0x1
   \   00000A   68           XRL     A,R0
   \   00000B   22           RET
   1451          
   1452          /*********************************************************************
   1453           * @fn      ZDApp_SaveNwkKey()
   1454           *
   1455           * @brief   Save off the Network key information.
   1456           *
   1457           * @param   none
   1458           *
   1459           * @return  none
   1460           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1461          void ZDApp_SaveNwkKey( void )
   \                     ZDApp_SaveNwkKey:
   1462          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1463            nwkActiveKeyItems keyItems;
   1464          
   1465            SSP_ReadNwkActiveKey( &keyItems );
   \   00000A                ; Setup parameters for call to function SSP_ReadNwkActiveKey
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AA82         MOV     R2,DPL
   \   000012   AB83         MOV     R3,DPH
   \   000014   12....       LCALL   ??SSP_ReadNwkActiveKey?relay
   1466            keyItems.frameCounter++;
   \   000017   90....       MOV     DPTR,#__Constant_1
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?L_MOV_X
   \   00001F   7411         MOV     A,#0x11
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?L_ADD_TO_X
   1467          
   1468            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1469                          (void *)&keyItems );
   \   000029                ; Setup parameters for call to function osal_nv_write
   \   000029   85..82       MOV     DPL,?XSP + 0
   \   00002C   85..83       MOV     DPH,?XSP + 1
   \   00002F   8582..       MOV     ?V0 + 0,DPL
   \   000032   8583..       MOV     ?V0 + 1,DPH
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003A   75..15       MOV     ?V0 + 0,#0x15
   \   00003D   75..00       MOV     ?V0 + 1,#0x0
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_36:
   \   000048   12....       LCALL   ?DEALLOC_XSTACK8
   1470          
   1471            nwkFrameCounterChanges = 0;
   \   00004B   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004E   E4           CLR     A
   \   00004F   F0           MOVX    @DPTR,A
   \   000050   A3           INC     DPTR
   \   000051   F0           MOVX    @DPTR,A
   1472          }
   \   000052                REQUIRE ?Subroutine18
   \   000052                ; // Fall through to label ?Subroutine18

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   7415         MOV     A,#0x15
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \   000005   7F04         MOV     R7,#0x4
   \   000007   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   7C00         MOV     R4,#0x0
   \   000002   7D00         MOV     R5,#0x0
   \   000004   7A82         MOV     R2,#-0x7e
   \   000006                REQUIRE ??Subroutine22_0
   \   000006                ; // Fall through to label ??Subroutine22_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine22_0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   12....       LCALL   ??osal_nv_write?relay
   \   000005   7404         MOV     A,#0x4
   \   000007   22           RET
   1473          
   1474          /*********************************************************************
   1475           * @fn      ZDApp_ResetNwkKey()
   1476           *
   1477           * @brief   Reset the Network key information in NV.
   1478           *
   1479           * @param   none
   1480           *
   1481           * @return  none
   1482           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1483          void ZDApp_ResetNwkKey( void )
   \                     ZDApp_ResetNwkKey:
   1484          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1485            nwkActiveKeyItems keyItems;
   1486          
   1487            osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C15         MOV     R4,#0x15
   \   00000C   12....       LCALL   ?Subroutine10 & 0xFFFF
   1488            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1489                          (void *)&keyItems );
   \                     ??CrossCallReturnLabel_15:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   75..15       MOV     ?V0 + 0,#0x15
   \   000015   75..00       MOV     ?V0 + 1,#0x0
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_37:
   \   000020   12....       LCALL   ?DEALLOC_XSTACK8
   1490          }
   \   000023   7415         MOV     A,#0x15
   \   000025   02....       LJMP    ??Subroutine25_0 & 0xFFFF
   1491          
   1492          /*********************************************************************
   1493           * @fn      ZDApp_RestoreNwkKey()
   1494           *
   1495           * @brief
   1496           *
   1497           *   Save off the Network key information.
   1498           *
   1499           * @param   none
   1500           *
   1501           * @return  true if restored from NV, false if not
   1502           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1503          uint8 ZDApp_RestoreNwkKey( void )
   \                     ZDApp_RestoreNwkKey:
   1504          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1505            nwkActiveKeyItems keyItems;
   1506            uint8 ret = false;
   \   00000A   7E00         MOV     R6,#0x0
   1507          
   1508            if ( osal_nv_read( ZCD_NV_NWKKEY, 0, sizeof(nwkActiveKeyItems), (void*)&keyItems )
   1509                == ZSUCCESS )
   \   00000C                ; Setup parameters for call to function osal_nv_read
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   8582..       MOV     ?V0 + 0,DPL
   \   000015   8583..       MOV     ?V0 + 1,DPH
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   75..15       MOV     ?V0 + 0,#0x15
   \   000020   8E..         MOV     ?V0 + 1,R6
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A82         MOV     R2,#-0x7e
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   12....       LCALL   ??osal_nv_read?relay
   \   000032   7404         MOV     A,#0x4
   \   000034   12....       LCALL   ?DEALLOC_XSTACK8
   \   000037   E9           MOV     A,R1
   \   000038   702F         JNZ     ??ZDApp_RestoreNwkKey_0
   1510            {
   1511              if ( keyItems.frameCounter > 0 )
   \   00003A   7411         MOV     A,#0x11
   \   00003C   12....       LCALL   ?XSTACK_DISP0_8
   \   00003F   78..         MOV     R0,#?V0 + 0
   \   000041   12....       LCALL   ?L_MOV_X
   \   000044   90....       MOV     DPTR,#__Constant_0
   \   000047   78..         MOV     R0,#?V0 + 0
   \   000049   12....       LCALL   ?L_EQ_X
   \   00004C   6011         JZ      ??ZDApp_RestoreNwkKey_1
   1512              {
   1513                // Restore the key information
   1514                keyItems.frameCounter += MAX_NWK_FRAMECOUNTER_CHANGES;
   1515                nwkFrameCounter = keyItems.frameCounter;
   \   00004E   90....       MOV     DPTR,#__Constant_3e8
   \   000051   78..         MOV     R0,#?V0 + 0
   \   000053   12....       LCALL   ?L_ADD_X
   \   000056   90....       MOV     DPTR,#nwkFrameCounter
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?L_MOV_TO_X
   1516                ret = true;
   \   00005E   0E           INC     R6
   1517              }
   1518          
   1519              // Force a save for the first frame counter increment
   1520              nwkFrameCounterChanges = MAX_NWK_FRAMECOUNTER_CHANGES + 1;
   \                     ??ZDApp_RestoreNwkKey_1:
   \   00005F   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000062   74E9         MOV     A,#-0x17
   \   000064   F0           MOVX    @DPTR,A
   \   000065   A3           INC     DPTR
   \   000066   7403         MOV     A,#0x3
   \   000068   F0           MOVX    @DPTR,A
   1521            }
   1522            return ( ret );
   \                     ??ZDApp_RestoreNwkKey_0:
   \   000069   EE           MOV     A,R6
   \   00006A   F9           MOV     R1,A
   \   00006B   02....       LJMP    ?Subroutine18 & 0xFFFF
   1523          }
   1524          
   1525          /*********************************************************************
   1526           * @fn      ZDApp_ResetTimerStart
   1527           *
   1528           * @brief   Start the reset timer.
   1529           *
   1530           * @param   delay - delay time(ms) before reset
   1531           *
   1532           * @return  none
   1533           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1534          void ZDApp_ResetTimerStart( uint16 delay )
   \                     ZDApp_ResetTimerStart:
   1535          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1536            // Start the rest timer
   1537            osal_start_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET, delay );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   EA           MOV     A,R2
   \   000005   FC           MOV     R4,A
   \   000006   EB           MOV     A,R3
   \   000007   FD           MOV     R5,A
   \   000008   7A04         MOV     R2,#0x4
   \   00000A   12....       LCALL   ?Subroutine6 & 0xFFFF
   1538          }
   \                     ??CrossCallReturnLabel_8:
   \   00000D   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   1539          
   1540          /*********************************************************************
   1541           * @fn      ZDApp_ResetTimerCancel
   1542           *
   1543           * @brief   Cancel the reset timer.
   1544           *
   1545           * @param   none
   1546           *
   1547           * @return  none
   1548           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1549          void ZDApp_ResetTimerCancel( void )
   \                     ZDApp_ResetTimerCancel:
   1550          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1551            // Cancel the reset timer
   1552            osal_stop_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A04         MOV     R2,#0x4
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_stop_timerEx?relay
   1553          }
   \   000010   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   1554          
   1555          /*********************************************************************
   1556           * @fn      ZDApp_LeaveCtrlInit
   1557           *
   1558           * @brief   Initialize the leave control logic.
   1559           *
   1560           * @param   none
   1561           *
   1562           * @return  none
   1563           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1564          void ZDApp_LeaveCtrlInit( void )
   \                     ZDApp_LeaveCtrlInit:
   1565          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1566            uint8 status;
   1567          
   1568          
   1569            // Initialize control state
   1570            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   12....       LCALL   ?Subroutine1 & 0xFFFF
   1571          
   1572            status = osal_nv_item_init( ZCD_NV_LEAVE_CTRL,
   1573                                        sizeof(ZDApp_LeaveCtrl),
   1574                                        &ZDApp_LeaveCtrl );
   1575          
   1576            if ( status == ZSUCCESS )
   \                     ??CrossCallReturnLabel_0:
   \   000008   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00000B   7C01         MOV     R4,#0x1
   \   00000D   7D00         MOV     R5,#0x0
   \   00000F   7A85         MOV     R2,#-0x7b
   \   000011   7B00         MOV     R3,#0x0
   \   000013   12....       LCALL   ??osal_nv_item_init?relay
   \   000016   7402         MOV     A,#0x2
   \   000018   12....       LCALL   ?DEALLOC_XSTACK8
   \   00001B   E9           MOV     A,R1
   \   00001C   7020         JNZ     ??ZDApp_LeaveCtrlInit_0
   1577            {
   1578              // Read saved control
   1579              osal_nv_read( ZCD_NV_LEAVE_CTRL,
   1580                            0,
   1581                            sizeof( uint8 ),
   1582                            &ZDApp_LeaveCtrl);
   \   00001E                ; Setup parameters for call to function osal_nv_read
   \   00001E   78..         MOV     R0,#?V0 + 0
   \   000020   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000023   75..01       MOV     ?V0 + 0,#0x1
   \   000026   75..00       MOV     ?V0 + 1,#0x0
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   7C00         MOV     R4,#0x0
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7A85         MOV     R2,#-0x7b
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??osal_nv_read?relay
   \   000039   7404         MOV     A,#0x4
   \   00003B   12....       LCALL   ?DEALLOC_XSTACK8
   1583            }
   1584          }
   \                     ??ZDApp_LeaveCtrlInit_0:
   \   00003E   02....       LJMP    ??Subroutine26_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   E4           CLR     A
   \   000001   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000004   F0           MOVX    @DPTR,A
   \   000005                ; Setup parameters for call to function osal_nv_item_init
   \   000005                ; Setup parameters for call to function osal_nv_write
   \   000005   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   000008   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   00000B   78..         MOV     R0,#?V0 + 0
   \   00000D   22           RET
   1585          
   1586          /*********************************************************************
   1587           * @fn      ZDApp_LeaveCtrlSet
   1588           *
   1589           * @brief   Set the leave control logic.
   1590           *
   1591           * @param   ra - reassociate flag
   1592           *
   1593           * @return  none
   1594           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1595          void ZDApp_LeaveCtrlSet( uint8 ra )
   \                     ZDApp_LeaveCtrlSet:
   1596          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1597            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_SET;
   \   000005   7401         MOV     A,#0x1
   \   000007   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000A   F0           MOVX    @DPTR,A
   1598          
   1599            if ( ra == TRUE )
   \   00000B   69           XRL     A,R1
   \   00000C   7003         JNZ     ??ZDApp_LeaveCtrlSet_0
   1600            {
   1601              ZDApp_LeaveCtrl |= ZDAPP_LEAVE_CTRL_RA;
   \   00000E   7403         MOV     A,#0x3
   \   000010   F0           MOVX    @DPTR,A
   1602            }
   1603          
   1604            // Write the leave control
   1605            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1606                           0,
   1607                           sizeof( uint8 ),
   1608                           &ZDApp_LeaveCtrl);
   \                     ??ZDApp_LeaveCtrlSet_0:
   \   000011                ; Setup parameters for call to function osal_nv_write
   \   000011   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   000014   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   000017   78..         MOV     R0,#?V0 + 0
   \   000019   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001C   75..01       MOV     ?V0 + 0,#0x1
   \   00001F   75..00       MOV     ?V0 + 1,#0x0
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A85         MOV     R2,#-0x7b
   \   00002D   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_38:
   \   000030   02....       LJMP    ??Subroutine25_0 & 0xFFFF
   1609          }
   1610          
   1611          /*********************************************************************
   1612           * @fn      ZDApp_LeaveCtrlBypass
   1613           *
   1614           * @brief   Check if NV restore should be skipped during a leave reset.
   1615           *
   1616           * @param   none
   1617           *
   1618           * @return  uint8 - (TRUE bypass:FALSE do not bypass)
   1619           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1620          uint8 ZDApp_LeaveCtrlBypass( void )
   \                     ZDApp_LeaveCtrlBypass:
   1621          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1622            uint8 bypass;
   1623          
   1624            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   1625            {
   1626              bypass = TRUE;
   1627            }
   1628            else
   1629            {
   1630              bypass = FALSE;
   1631            }
   1632          
   1633            return bypass;
   \   000004   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000A   E4           CLR     A
   \   00000B   92E0         MOV     0xE0 /* A   */.0,C
   \   00000D   F9           MOV     R1,A
   \   00000E   80..         SJMP    ??Subroutine23_0
   1634          }
   1635          
   1636          /*********************************************************************
   1637           * @fn      ZDApp_LeaveCtrlStartup
   1638           *
   1639           * @brief   Check for startup conditions during a leave reset.
   1640           *
   1641           * @param   state      - devState_t determined by leave control logic
   1642           * @param   startDelay - startup delay
   1643           *
   1644           * @return  none
   1645           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1646          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay )
   \                     ZDApp_LeaveCtrlStartup:
   1647          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1648            *startDelay = 0;
   \   000005   8C82         MOV     DPL,R4
   \   000007   8D83         MOV     DPH,R5
   \   000009   E4           CLR     A
   \   00000A   F0           MOVX    @DPTR,A
   \   00000B   A3           INC     DPTR
   \   00000C   F0           MOVX    @DPTR,A
   1649          
   1650            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   00000D   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000010   E0           MOVX    A,@DPTR
   \   000011   A2E0         MOV     C,0xE0 /* A   */.0
   \   000013   5033         JNC     ??ZDApp_LeaveCtrlStartup_0
   1651            {
   1652              if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_RA )
   \   000015   A2E1         MOV     C,0xE0 /* A   */.1
   \   000017   500C         JNC     ??ZDApp_LeaveCtrlStartup_1
   1653              {
   1654                *startDelay = 5000;
   \   000019   8C82         MOV     DPL,R4
   \   00001B   8D83         MOV     DPH,R5
   \   00001D   7488         MOV     A,#-0x78
   \   00001F   F0           MOVX    @DPTR,A
   \   000020   A3           INC     DPTR
   \   000021   7413         MOV     A,#0x13
   \   000023   8005         SJMP    ??ZDApp_LeaveCtrlStartup_2
   1655              }
   1656              else
   1657              {
   1658                *state = DEV_HOLD;
   \                     ??ZDApp_LeaveCtrlStartup_1:
   \   000025   E4           CLR     A
   \   000026   8A82         MOV     DPL,R2
   \   000028   8B83         MOV     DPH,R3
   \                     ??ZDApp_LeaveCtrlStartup_2:
   \   00002A   F0           MOVX    @DPTR,A
   1659              }
   1660          
   1661              // Set leave control to initialized state
   1662              ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   00002B   12....       LCALL   ?Subroutine1 & 0xFFFF
   1663          
   1664              // Write initialized control
   1665              osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1666                            0,
   1667                            sizeof( uint8 ),
   1668                            &ZDApp_LeaveCtrl);
   1669            }
   \                     ??CrossCallReturnLabel_1:
   \   00002E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000031   75..01       MOV     ?V0 + 0,#0x1
   \   000034   75..00       MOV     ?V0 + 1,#0x0
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003C   7C00         MOV     R4,#0x0
   \   00003E   7D00         MOV     R5,#0x0
   \   000040   7A85         MOV     R2,#-0x7b
   \   000042   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_39:
   \   000045   12....       LCALL   ?DEALLOC_XSTACK8
   1670          }
   \                     ??ZDApp_LeaveCtrlStartup_0:
   \   000048   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   1671          
   1672          /*********************************************************************
   1673           * @fn      ZDApp_LeaveReset
   1674           *
   1675           * @brief   Setup a device reset due to a leave indication/confirm.
   1676           *
   1677           * @param   ra - reassociate flag
   1678           *
   1679           * @return  none
   1680           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1681          void ZDApp_LeaveReset( uint8 ra )
   \                     ZDApp_LeaveReset:
   1682          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1683            ZDApp_LeaveCtrlSet( ra );
   \   000004                ; Setup parameters for call to function ZDApp_LeaveCtrlSet
   \   000004   12....       LCALL   ??ZDApp_LeaveCtrlSet?relay
   1684          
   1685            ZDApp_ResetTimerStart( 5000 );
   \   000007                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   000007   7A88         MOV     R2,#-0x78
   \   000009   7B13         MOV     R3,#0x13
   \   00000B   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   1686          }
   \   00000E   80..         SJMP    ??Subroutine23_0
   1687          
   1688          /*********************************************************************
   1689           * @fn      ZDApp_LeaveUpdate
   1690           *
   1691           * @brief   Update local device data related to leaving device.
   1692           *
   1693           * @param   nwkAddr        - NWK address of leaving device
   1694           * @param   extAddr        - EXT address of leaving device
   1695           * @param   removeChildren - remove children of leaving device
   1696           *
   1697           * @return  none
   1698           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1699          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
   \                     ZDApp_LeaveUpdate:
   1700                                  uint8 removeChildren )
   1701          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   EC           MOV     A,R4
   \   000005   FA           MOV     R2,A
   \   000006   ED           MOV     A,R5
   \   000007   FB           MOV     R3,A
   1702            /*
   1703            AddrMgrEntry_t entry;
   1704            */
   1705            (void)nwkAddr;  // Intentionally unreferenced parameter
   1706          
   1707            // Remove if child
   1708            if ( ZSTACK_ROUTER_BUILD )
   1709            {
   1710              NLME_RemoveChild( extAddr, removeChildren );
   \   000008                ; Setup parameters for call to function NLME_RemoveChild
   \   000008   12....       LCALL   ??NLME_RemoveChild?relay
   1711            }
   1712          
   1713            /*
   1714            // Set NWK address to invalid
   1715            entry.user    = ADDRMGR_USER_DEFAULT;
   1716            entry.nwkAddr = INVALID_NODE_ADDR;
   1717            AddrMgrExtAddrSet( entry.extAddr, extAddr );
   1718            AddrMgrEntryUpdate( &entry );
   1719          
   1720            // Check
   1721            if ( removeChildren == TRUE )
   1722            {
   1723              // Set index to INVALID_NODE_ADDR to start search
   1724              entry.index = INVALID_NODE_ADDR;
   1725          
   1726              // Get first entry
   1727              AddrMgrEntryGetNext( &entry );
   1728          
   1729              // Remove all descendents
   1730              while ( entry.index != INVALID_NODE_ADDR )
   1731              {
   1732                // Check NWK address allocation algorithm
   1733                if ( RTG_ANCESTOR( entry.nwkAddr, thisAddr ) != 0 )
   1734                {
   1735                  // Set NWK address to invalid
   1736                  entry.nwkAddr = INVALID_NODE_ADDR;
   1737                  AddrMgrEntryUpdate( &entry );
   1738                }
   1739          
   1740                // Get next entry
   1741                AddrMgrEntryGetNext( &entry );
   1742              }
   1743            }
   1744            */
   1745          }
   \   00000B   80..         SJMP    ??Subroutine23_0
   1746          
   1747          /*********************************************************************
   1748           * CALLBACK FUNCTIONS
   1749           */
   1750          
   1751          
   1752          /*********************************************************************
   1753           * @fn      ZDApp_SendEventMsg()
   1754           *
   1755           * @brief
   1756           *
   1757           *   Sends a Network Join message
   1758           *
   1759           * @param  cmd - command ID
   1760           * @param  len - length (in bytes) of the buf field
   1761           * @param  buf - buffer for the rest of the message.
   1762           *
   1763           * @return  none
   1764           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1765          void ZDApp_SendEventMsg( uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendEventMsg:
   1766          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1767            ZDApp_SendMsg( ZDAppTaskID, cmd, len, buf );
   \   000004                ; Setup parameters for call to function ZDApp_SendMsg
   \   000004   EA           MOV     A,R2
   \   000005   FB           MOV     R3,A
   \   000006   E9           MOV     A,R1
   \   000007   FA           MOV     R2,A
   \   000008                REQUIRE ?Subroutine20
   \   000008                ; // Fall through to label ?Subroutine20
   1768          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine20:
   \   000000   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_26:
   \   000003   02....       LJMP    ??Subroutine23_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDApp_SendMsg?relay
   \   000008   22           RET
   1769          
   1770          /*********************************************************************
   1771           * @fn      ZDApp_SendMsg()
   1772           *
   1773           * @brief   Sends a OSAL message
   1774           *
   1775           * @param  taskID - Where to send the message
   1776           * @param  cmd - command ID
   1777           * @param  len - length (in bytes) of the buf field
   1778           * @param  buf - buffer for the rest of the message.
   1779           *
   1780           * @return  none
   1781           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1782          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendMsg:
   1783          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 3
   \   000005   74FD         MOV     A,#-0x3
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   85..82       MOV     DPL,?XSP + 0
   \   00000E   85..83       MOV     DPH,?XSP + 1
   \   000011   F0           MOVX    @DPTR,A
   \   000012   7401         MOV     A,#0x1
   \   000014   12....       LCALL   ?XSTACK_DISP0_8
   \   000017   EC           MOV     A,R4
   \   000018   F0           MOVX    @DPTR,A
   \   000019   A3           INC     DPTR
   \   00001A   ED           MOV     A,R5
   \   00001B   F0           MOVX    @DPTR,A
   \   00001C   89..         MOV     ?V0 + 3,R1
   1784            osal_event_hdr_t *msgPtr;
   1785          
   1786            // Send the address to the task
   1787            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( len );
   \   00001E   8B82         MOV     DPL,R3
   \   000020   AE82         MOV     R6,DPL
   \   000022                ; Setup parameters for call to function osal_msg_allocate
   \   000022   EE           MOV     A,R6
   \   000023   FA           MOV     R2,A
   \   000024   7B00         MOV     R3,#0x0
   \   000026   12....       LCALL   ??osal_msg_allocate?relay
   \   000029   8A..         MOV     ?V0 + 4,R2
   \   00002B   8B..         MOV     ?V0 + 5,R3
   1788            if ( msgPtr )
   \   00002D   EA           MOV     A,R2
   \   00002E   7001         JNZ     ??ZDApp_SendMsg_0
   \   000030   EB           MOV     A,R3
   \                     ??ZDApp_SendMsg_0:
   \   000031   6046         JZ      ??ZDApp_SendMsg_1
   1789            {
   1790              if ( (len > 0) && (buf != NULL) )
   \   000033   EE           MOV     A,R6
   \   000034   602C         JZ      ??ZDApp_SendMsg_2
   \   000036   7401         MOV     A,#0x1
   \   000038   12....       LCALL   ?XSTACK_DISP0_8
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   7002         JNZ     ??ZDApp_SendMsg_3
   \   00003E   A3           INC     DPTR
   \   00003F   E0           MOVX    A,@DPTR
   \                     ??ZDApp_SendMsg_3:
   \   000040   6020         JZ      ??ZDApp_SendMsg_2
   1791                osal_memcpy( msgPtr, buf, len );
   \   000042                ; Setup parameters for call to function osal_memcpy
   \   000042   7401         MOV     A,#0x1
   \   000044   12....       LCALL   ?XSTACK_DISP0_8
   \   000047   E0           MOVX    A,@DPTR
   \   000048   F5..         MOV     ?V0 + 0,A
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   F5..         MOV     ?V0 + 1,A
   \   00004E   75..00       MOV     ?V0 + 2,#0x0
   \   000051   78..         MOV     R0,#?V0 + 0
   \   000053   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000056   EE           MOV     A,R6
   \   000057   FC           MOV     R4,A
   \   000058   7D00         MOV     R5,#0x0
   \   00005A   12....       LCALL   ??osal_memcpy?relay
   \   00005D   7403         MOV     A,#0x3
   \   00005F   12....       LCALL   ?DEALLOC_XSTACK8
   1792          
   1793              msgPtr->event = cmd;
   \                     ??ZDApp_SendMsg_2:
   \   000062   85..82       MOV     DPL,?XSP + 0
   \   000065   85..83       MOV     DPH,?XSP + 1
   \   000068   E0           MOVX    A,@DPTR
   \   000069   85..82       MOV     DPL,?V0 + 4
   \   00006C   85..83       MOV     DPH,?V0 + 5
   \   00006F   F0           MOVX    @DPTR,A
   1794              osal_msg_send( taskID, (uint8 *)msgPtr );
   \   000070                ; Setup parameters for call to function osal_msg_send
   \   000070   AA..         MOV     R2,?V0 + 4
   \   000072   AB..         MOV     R3,?V0 + 5
   \   000074   A9..         MOV     R1,?V0 + 3
   \   000076   12....       LCALL   ??osal_msg_send?relay
   1795            }
   1796          }
   \                     ??ZDApp_SendMsg_1:
   \   000079   7403         MOV     A,#0x3
   \   00007B                REQUIRE ?Subroutine19
   \   00007B                ; // Fall through to label ?Subroutine19

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine19:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003   7F06         MOV     R7,#0x6
   \   000005   02....       LJMP    ?BANKED_LEAVE_XDATA
   1797          
   1798          /*********************************************************************
   1799           * Call Back Functions from NWK  - API
   1800           */
   1801          
   1802          /*********************************************************************
   1803           * @fn          ZDO_NetworkDiscoveryConfirmCB
   1804           *
   1805           * @brief       This function returns a choice of PAN to join.
   1806           *
   1807           * @param       ResultCount - Number of routers discovered
   1808           * @param               NetworkList - Pointer to list of network descriptors
   1809           *
   1810           * @return      ZStatus_t
   1811           */
   1812          #define STACK_PROFILE_MAX 2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1813          ZStatus_t ZDO_NetworkDiscoveryConfirmCB( uint8 ResultCount,
   \                     ZDO_NetworkDiscoveryConfirmCB:
   1814                                                   networkDesc_t *NetworkList )
   1815          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 16
   \   000005   74F0         MOV     A,#-0x10
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
   \   000015   89..         MOV     ?V0 + 3,R1
   1816            networkDesc_t *pNwkDesc;
   1817            ZDO_NetworkDiscoveryCfm_t msg;
   1818            uint8  i;
   1819            uint8 stackProfile;
   1820            uint8 stackProfilePro;
   1821            uint8 selected;
   1822          
   1823          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   1824            if ( zdappMgmtNwkDiscReqInProgress )
   1825            {
   1826              zdappMgmtNwkDiscReqInProgress = false;
   1827              ZDO_FinishProcessingMgmtNwkDiscReq( ResultCount, NetworkList );
   1828              return ( ZSuccess );
   1829            }
   1830          #endif
   1831          
   1832            // process discovery results
   1833            stackProfilePro = FALSE;
   \   000017   75..00       MOV     ?V0 + 1,#0x0
   1834            selected = FALSE;
   1835          
   1836            for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   \   00001A   75..00       MOV     ?V0 + 2,#0x0
   1837            {
   1838              pNwkDesc = NetworkList;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_0:
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   E0           MOVX    A,@DPTR
   \   000024   FE           MOV     R6,A
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FF           MOV     R7,A
   1839              for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   \   000028   75..00       MOV     ?V0 + 0,#0x0
   \   00002B   8020         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_1
   1840              {
   1841                if ( zgConfigPANID != 0xFFFF )
   1842                {
   1843                  // PAN Id is preconfigured. check if it matches
   1844                  if ( pNwkDesc->panId != zgConfigPANID )
   1845                    continue;
   1846                }
   1847                
   1848          
   1849                if ( nwk_ExtPANIDValid( ZDO_UseExtendedPANID) == true ) 
   1850                {
   1851                  // If the extended Pan ID is commissioned to a non zero value
   1852                  // Only join the Pan that has match EPID
   1853                  if ( osal_ExtAddrEqual( ZDO_UseExtendedPANID, pNwkDesc->extendedPANID) == false )
   1854                    continue;
   1855                  
   1856                }
   1857          
   1858          
   1859                  // check that network is allowing joining
   1860                  if ( ZSTACK_ROUTER_BUILD )
   1861                  {
   1862                    if ( stackProfilePro == FALSE )
   1863                    {
   1864                      if ( !pNwkDesc->routerCapacity )
   1865                      {
   1866                        continue;
   1867                      }
   1868                    }
   1869                    else
   1870                    {
   1871                      if ( !pNwkDesc->deviceCapacity )
   1872                      {
   1873                        continue;
   1874                      }
   1875                    }
   1876                  }
   1877                  else if ( ZSTACK_END_DEVICE_BUILD )
   1878                  {
   1879                    if ( !pNwkDesc->deviceCapacity )
   1880                    {
   1881                      continue;
   1882                    }
   1883                  }
   1884          
   1885                  // check version of zigbee protocol
   1886                  if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   1887                    continue;
   1888          
   1889                  // check version of stack profile
   1890                  if ( pNwkDesc->stackProfile != zgStackProfile  )
   1891                  {
   1892                    if ( ((zgStackProfile == HOME_CONTROLS) && (pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE)) 
   1893                        || ((zgStackProfile == ZIGBEEPRO_PROFILE) && (pNwkDesc->stackProfile == HOME_CONTROLS))  )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_2:
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   6402         XRL     A,#0x2
   \   000030   7008         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   \   000032   7401         MOV     A,#0x1
   \   000034   6A           XRL     A,R2
   \   000035   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_3
   1894                      stackProfilePro = TRUE;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_4:
   \   000037   75..01       MOV     ?V0 + 1,#0x1
   1895                    
   1896                    if ( stackProfile == 0 )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_3:
   \   00003A   E5..         MOV     A,?V0 + 2
   \   00003C   6003         JZ      $+5
   \   00003E   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_5 & 0xFFFF
   \                     ??ZDO_NetworkDiscoveryConfirmCB_6:
   \   000041   05..         INC     ?V0 + 0
   \   000043   EE           MOV     A,R6
   \   000044   2416         ADD     A,#0x16
   \   000046   12....       LCALL   ??Subroutine24_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_41:
   \   000049   FE           MOV     R6,A
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   FF           MOV     R7,A
   \                     ??ZDO_NetworkDiscoveryConfirmCB_1:
   \   00004D   EE           MOV     A,R6
   \   00004E   2407         ADD     A,#0x7
   \   000050   F5..         MOV     ?V0 + 6,A
   \   000052   EF           MOV     A,R7
   \   000053   3400         ADDC    A,#0x0
   \   000055   F5..         MOV     ?V0 + 7,A
   \   000057   EE           MOV     A,R6
   \   000058   240D         ADD     A,#0xd
   \   00005A   F5..         MOV     ?V0 + 4,A
   \   00005C   EF           MOV     A,R7
   \   00005D   3400         ADDC    A,#0x0
   \   00005F   F5..         MOV     ?V0 + 5,A
   \   000061   E5..         MOV     A,?V0 + 0
   \   000063   C3           CLR     C
   \   000064   95..         SUBB    A,?V0 + 3
   \   000066   4003         JC      $+5
   \   000068   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_7 & 0xFFFF
   \   00006B   90....       MOV     DPTR,#zgConfigPANID
   \   00006E   E0           MOVX    A,@DPTR
   \   00006F   64FF         XRL     A,#0xff
   \   000071   7004         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_8
   \   000073   A3           INC     DPTR
   \   000074   E0           MOVX    A,@DPTR
   \   000075   64FF         XRL     A,#0xff
   \                     ??ZDO_NetworkDiscoveryConfirmCB_8:
   \   000077   6015         JZ      ??ZDO_NetworkDiscoveryConfirmCB_9
   \   000079   8E82         MOV     DPL,R6
   \   00007B   8F83         MOV     DPH,R7
   \   00007D   E0           MOVX    A,@DPTR
   \   00007E   F8           MOV     R0,A
   \   00007F   A3           INC     DPTR
   \   000080   E0           MOVX    A,@DPTR
   \   000081   F9           MOV     R1,A
   \   000082   90....       MOV     DPTR,#zgConfigPANID
   \   000085   E0           MOVX    A,@DPTR
   \   000086   68           XRL     A,R0
   \   000087   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_10
   \   000089   A3           INC     DPTR
   \   00008A   E0           MOVX    A,@DPTR
   \   00008B   69           XRL     A,R1
   \                     ??ZDO_NetworkDiscoveryConfirmCB_10:
   \   00008C   70B3         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_9:
   \   00008E                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   00008E   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000090   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000092   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   000095   E9           MOV     A,R1
   \   000096   6401         XRL     A,#0x1
   \   000098   700E         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_11
   \   00009A                ; Setup parameters for call to function sAddrExtCmp
   \   00009A   AC..         MOV     R4,?V0 + 4
   \   00009C   AD..         MOV     R5,?V0 + 5
   \   00009E   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   0000A0   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   0000A2   12....       LCALL   ??sAddrExtCmp?relay
   \   0000A5   E9           MOV     A,R1
   \   0000A6   6099         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_11:
   \   0000A8   E5..         MOV     A,?V0 + 1
   \   0000AA   8E82         MOV     DPL,R6
   \   0000AC   8F83         MOV     DPH,R7
   \   0000AE   A3           INC     DPTR
   \   0000AF   A3           INC     DPTR
   \   0000B0   A3           INC     DPTR
   \   0000B1   A3           INC     DPTR
   \   0000B2   A3           INC     DPTR
   \   0000B3   7005         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_12
   \   0000B5   E0           MOVX    A,@DPTR
   \   0000B6   7006         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_13
   \   0000B8   8087         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_12:
   \   0000BA   A3           INC     DPTR
   \   0000BB   E0           MOVX    A,@DPTR
   \   0000BC   6083         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_13:
   \   0000BE   85..82       MOV     DPL,?V0 + 6
   \   0000C1   85..83       MOV     DPH,?V0 + 7
   \   0000C4   E0           MOVX    A,@DPTR
   \   0000C5   FA           MOV     R2,A
   \   0000C6   90....       MOV     DPTR,#(_NIB + 17)
   \   0000C9   E0           MOVX    A,@DPTR
   \   0000CA   6A           XRL     A,R2
   \   0000CB   6003         JZ      $+5
   \   0000CD   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_6 & 0xFFFF
   \   0000D0   8E82         MOV     DPL,R6
   \   0000D2   8F83         MOV     DPH,R7
   \   0000D4   A3           INC     DPTR
   \   0000D5   A3           INC     DPTR
   \   0000D6   A3           INC     DPTR
   \   0000D7   A3           INC     DPTR
   \   0000D8   A3           INC     DPTR
   \   0000D9   A3           INC     DPTR
   \   0000DA   A3           INC     DPTR
   \   0000DB   A3           INC     DPTR
   \   0000DC   E0           MOVX    A,@DPTR
   \   0000DD   FA           MOV     R2,A
   \   0000DE   90....       MOV     DPTR,#zgStackProfile
   \   0000E1   E0           MOVX    A,@DPTR
   \   0000E2   6A           XRL     A,R2
   \   0000E3   6033         JZ      ??ZDO_NetworkDiscoveryConfirmCB_5
   \   0000E5   E0           MOVX    A,@DPTR
   \   0000E6   6401         XRL     A,#0x1
   \   0000E8   6003         JZ      $+5
   \   0000EA   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_2 & 0xFFFF
   \   0000ED   7402         MOV     A,#0x2
   \   0000EF   6A           XRL     A,R2
   \   0000F0   6003         JZ      $+5
   \   0000F2   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_3 & 0xFFFF
   \   0000F5   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_4 & 0xFFFF
   1897                    {
   1898                      continue;
   1899                    }
   1900                  }
   1901          
   1902                // check if beacon order is the right value..
   1903                //  if ( pNwkDesc->beaconOrder < ZDO_CONFIG_MAX_BO )
   1904                //    continue;
   1905          
   1906                // choose this pan for joining
   1907                break;
   1908              } 
   1909              if (i < ResultCount)
   1910              {
   1911               selected = TRUE;
   1912                break;
   1913              }
   1914             
   1915              // break if selected or stack profile pro wasn't found
   1916              if ( (selected == TRUE) || (stackProfilePro == FALSE) )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_7:
   \   0000F8   E5..         MOV     A,?V0 + 1
   \   0000FA   600C         JZ      ??ZDO_NetworkDiscoveryConfirmCB_14
   1917              {
   1918                break;
   1919              }
   1920            }
   \   0000FC   05..         INC     ?V0 + 2
   \   0000FE   E5..         MOV     A,?V0 + 2
   \   000100   C3           CLR     C
   \   000101   9402         SUBB    A,#0x2
   \   000103   5003         JNC     $+5
   \   000105   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_0 & 0xFFFF
   1921          
   1922            if ( i == ResultCount )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_14:
   \   000108   E5..         MOV     A,?V0 + 3
   \   00010A   65..         XRL     A,?V0 + 0
   \   00010C   700A         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_5
   1923            {
   1924              msg.hdr.status = ZDO_FAIL;   // couldn't find appropriate PAN to join !
   \   00010E   7403         MOV     A,#0x3
   \   000110   12....       LCALL   ?XSTACK_DISP0_8
   \   000113   7401         MOV     A,#0x1
   \   000115   F0           MOVX    @DPTR,A
   \   000116   8058         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_15
   1925            }
   1926            else
   1927            {
   1928              msg.hdr.status = ZDO_SUCCESS;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_5:
   \   000118   7403         MOV     A,#0x3
   \   00011A   12....       LCALL   ?XSTACK_DISP0_8
   \   00011D   E4           CLR     A
   \   00011E   F0           MOVX    @DPTR,A
   1929              msg.panIdLSB = LO_UINT16( pNwkDesc->panId );
   \   00011F   8E82         MOV     DPL,R6
   \   000121   8F83         MOV     DPH,R7
   \   000123   E0           MOVX    A,@DPTR
   \   000124   C0E0         PUSH    A
   \   000126   7404         MOV     A,#0x4
   \   000128   12....       LCALL   ?XSTACK_DISP0_8
   \   00012B   D0E0         POP     A
   \   00012D   F0           MOVX    @DPTR,A
   1930              msg.panIdMSB = HI_UINT16( pNwkDesc->panId );
   \   00012E   8E82         MOV     DPL,R6
   \   000130   8F83         MOV     DPH,R7
   \   000132   A3           INC     DPTR
   \   000133   E0           MOVX    A,@DPTR
   \   000134   C0E0         PUSH    A
   \   000136   7405         MOV     A,#0x5
   \   000138   12....       LCALL   ?XSTACK_DISP0_8
   \   00013B   D0E0         POP     A
   \   00013D   F0           MOVX    @DPTR,A
   1931              msg.logicalChannel = pNwkDesc->logicalChannel;
   \   00013E   8E82         MOV     DPL,R6
   \   000140   8F83         MOV     DPH,R7
   \   000142   A3           INC     DPTR
   \   000143   A3           INC     DPTR
   \   000144   E0           MOVX    A,@DPTR
   \   000145   C0E0         PUSH    A
   \   000147   7406         MOV     A,#0x6
   \   000149   12....       LCALL   ?XSTACK_DISP0_8
   \   00014C   D0E0         POP     A
   \   00014E   F0           MOVX    @DPTR,A
   1932              msg.version = pNwkDesc->version;
   \   00014F   85..82       MOV     DPL,?V0 + 6
   \   000152   85..83       MOV     DPH,?V0 + 7
   \   000155   E0           MOVX    A,@DPTR
   \   000156   C0E0         PUSH    A
   \   000158   7407         MOV     A,#0x7
   \   00015A   12....       LCALL   ?XSTACK_DISP0_8
   \   00015D   D0E0         POP     A
   \   00015F   F0           MOVX    @DPTR,A
   1933              osal_cpyExtAddr( msg.extendedPANID, pNwkDesc->extendedPANID );
   \   000160                ; Setup parameters for call to function sAddrExtCpy
   \   000160   AC..         MOV     R4,?V0 + 4
   \   000162   AD..         MOV     R5,?V0 + 5
   \   000164   7408         MOV     A,#0x8
   \   000166   12....       LCALL   ?XSTACK_DISP0_8
   \   000169   AA82         MOV     R2,DPL
   \   00016B   AB83         MOV     R3,DPH
   \   00016D   12....       LCALL   ??sAddrExtCpy?relay
   1934            }
   1935          
   1936            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_DISC_CNF, sizeof(ZDO_NetworkDiscoveryCfm_t), (uint8 *)&msg );
   \                     ??ZDO_NetworkDiscoveryConfirmCB_15:
   \   000170                ; Setup parameters for call to function ZDApp_SendMsg
   \   000170   7402         MOV     A,#0x2
   \   000172   12....       LCALL   ?XSTACK_DISP0_8
   \   000175   AC82         MOV     R4,DPL
   \   000177   AD83         MOV     R5,DPH
   \   000179   7B0E         MOV     R3,#0xe
   \   00017B   7A01         MOV     R2,#0x1
   \   00017D   12....       LCALL   ?Subroutine5 & 0xFFFF
   1937          
   1938            return (ZSuccess);
   \                     ??CrossCallReturnLabel_27:
   \   000180   7900         MOV     R1,#0x0
   \   000182   7410         MOV     A,#0x10
   \   000184   12....       LCALL   ?DEALLOC_XSTACK8
   \   000187   7F08         MOV     R7,#0x8
   \   000189   02....       LJMP    ?BANKED_LEAVE_XDATA
   1939          }  // ZDO_NetworkDiscoveryConfirmCB
   1940          
   1941          /*********************************************************************
   1942           * @fn          ZDO_NetworkFormationConfirmCB
   1943           *
   1944           * @brief       This function reports the results of the request to
   1945           *              initialize a coordinator in a network.
   1946           *
   1947           * @param       Status - Result of NLME_NetworkFormationRequest()
   1948           *
   1949           * @return      none
   1950           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1951          void ZDO_NetworkFormationConfirmCB( ZStatus_t Status )
   \                     ZDO_NetworkFormationConfirmCB:
   1952          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1953            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   1954          
   1955            if ( Status == ZSUCCESS )
   \   000009   7015         JNZ     ??ZDO_NetworkFormationConfirmCB_0
   1956            {
   1957              // LED on shows Coordinator started
   1958              HalLedSet ( HAL_LED_1, HAL_LED_MODE_ON );
   \   00000B                ; Setup parameters for call to function HalLedSet
   \   00000B   7A01         MOV     R2,#0x1
   \   00000D   7901         MOV     R1,#0x1
   \   00000F   12....       LCALL   ??HalLedSet?relay
   1959          
   1960              // LED off forgets HOLD_AUTO_START
   1961              HalLedSet (HAL_LED_2, HAL_LED_MODE_OFF);
   \   000012                ; Setup parameters for call to function HalLedSet
   \   000012   7A00         MOV     R2,#0x0
   \   000014   7902         MOV     R1,#0x2
   \   000016   12....       LCALL   ?Subroutine12 & 0xFFFF
   1962          
   1963          #if defined ( ZBIT )
   1964              SIM_SetColor(0xd0ffd0);
   1965          #endif
   1966          
   1967              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_16:
   \   000019   700C         JNZ     ??ZDO_NetworkFormationConfirmCB_1
   1968              {
   1969                // Began with HOLD_AUTO_START
   1970                devState = DEV_COORD_STARTING;
   \   00001B   7408         MOV     A,#0x8
   \   00001D   F0           MOVX    @DPTR,A
   \   00001E   8007         SJMP    ??ZDO_NetworkFormationConfirmCB_1
   1971              }
   1972            }
   1973          #if defined(BLINK_LEDS)
   1974            else
   1975              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_NetworkFormationConfirmCB_0:
   \   000020                ; Setup parameters for call to function HalLedSet
   \   000020   7A04         MOV     R2,#0x4
   \   000022   7904         MOV     R1,#0x4
   \   000024   12....       LCALL   ??HalLedSet?relay
   1976          #endif
   1977          
   1978            osal_set_event( ZDAppTaskID, ZDO_NETWORK_START );
   \                     ??ZDO_NetworkFormationConfirmCB_1:
   \   000027                ; Setup parameters for call to function osal_set_event
   \   000027   7A02         MOV     R2,#0x2
   \   000029   02....       LJMP    ?Subroutine13 & 0xFFFF
   1979          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   12....       LCALL   ??HalLedSet?relay
   \   000003   90....       MOV     DPTR,#devState
   \   000006   E0           MOVX    A,@DPTR
   \   000007   22           RET
   1980          
   1981          /*********************************************************************
   1982           * @fn          ZDO_StartRouterConfirmCB
   1983           *
   1984           * @brief       This function reports the results of the request to
   1985           *              start functioning as a router in a network.
   1986           *
   1987           * @param       Status - Result of NLME_StartRouterRequest()
   1988           *
   1989           * @return      none
   1990           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1991          void ZDO_StartRouterConfirmCB( ZStatus_t Status )
   \                     ZDO_StartRouterConfirmCB:
   1992          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1993            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   1994          
   1995            if ( Status == ZSUCCESS )
   \   000009   700E         JNZ     ??ZDO_StartRouterConfirmCB_0
   1996            {
   1997              // LED on shows Router started
   1998              HalLedSet ( HAL_LED_1, HAL_LED_MODE_ON );
   \   00000B                ; Setup parameters for call to function HalLedSet
   \   00000B   7A01         MOV     R2,#0x1
   \   00000D   7901         MOV     R1,#0x1
   \   00000F   12....       LCALL   ?Subroutine12 & 0xFFFF
   1999              // LED off forgets HOLD_AUTO_START
   2000              //HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   2001              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_17:
   \   000012   700C         JNZ     ??ZDO_StartRouterConfirmCB_1
   2002              {
   2003                // Began with HOLD_AUTO_START
   2004                devState = DEV_END_DEVICE;
   \   000014   7406         MOV     A,#0x6
   \   000016   F0           MOVX    @DPTR,A
   \   000017   8007         SJMP    ??ZDO_StartRouterConfirmCB_1
   2005              }
   2006            }
   2007          #if defined(BLINK_LEDS)
   2008            else
   2009              HalLedSet( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_StartRouterConfirmCB_0:
   \   000019                ; Setup parameters for call to function HalLedSet
   \   000019   7A04         MOV     R2,#0x4
   \   00001B   7904         MOV     R1,#0x4
   \   00001D   12....       LCALL   ??HalLedSet?relay
   2010          #endif
   2011          
   2012            osal_set_event( ZDAppTaskID, ZDO_ROUTER_START );
   \                     ??ZDO_StartRouterConfirmCB_1:
   \   000020                ; Setup parameters for call to function osal_set_event
   \   000020   7A20         MOV     R2,#0x20
   \   000022   02....       LJMP    ?Subroutine13 & 0xFFFF
   2013          }
   2014          
   2015          /*********************************************************************
   2016           * @fn          ZDO_JoinConfirmCB
   2017           *
   2018           * @brief       This function allows the next hight layer to be notified
   2019           *              of the results of its request to join itself or another
   2020           *              device to a network.
   2021           *
   2022           * @param       Status - Result of NLME_JoinRequest()
   2023           *
   2024           * @return      none
   2025           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2026          void ZDO_JoinConfirmCB( uint16 PanId, ZStatus_t Status )
   \                     ZDO_JoinConfirmCB:
   2027          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2028            (void)PanId;  // remove if this parameter is used.
   2029            
   2030            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   2031          
   2032            if ( Status == ZSUCCESS )
   \   000009   7015         JNZ     ??ZDO_JoinConfirmCB_0
   2033            {
   2034              // LED on shows device joined
   2035              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000B                ; Setup parameters for call to function HalLedSet
   \   00000B   7A01         MOV     R2,#0x1
   \   00000D   7904         MOV     R1,#0x4
   \   00000F   12....       LCALL   ??HalLedSet?relay
   2036              // LED off forgets HOLD_AUTO_START
   2037              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   \   000012                ; Setup parameters for call to function HalLedSet
   \   000012   7A00         MOV     R2,#0x0
   \   000014   7908         MOV     R1,#0x8
   \   000016   12....       LCALL   ?Subroutine12 & 0xFFFF
   2038              if ( (devState == DEV_HOLD) )
   \                     ??CrossCallReturnLabel_18:
   \   000019   700C         JNZ     ??ZDO_JoinConfirmCB_1
   2039              {
   2040                // Began with HOLD_AUTO_START
   2041                devState = DEV_NWK_JOINING;
   \   00001B   7403         MOV     A,#0x3
   \   00001D   F0           MOVX    @DPTR,A
   \   00001E   8007         SJMP    ??ZDO_JoinConfirmCB_1
   2042              }
   2043          
   2044              if ( !ZG_SECURE_ENABLED )
   2045              {
   2046                // Notify to save info into NV
   2047                ZDApp_NVUpdate();
   2048              }
   2049            }
   2050          #if defined(BLINK_LEDS)
   2051            else
   2052              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_JoinConfirmCB_0:
   \   000020                ; Setup parameters for call to function HalLedSet
   \   000020   7A04         MOV     R2,#0x4
   \   000022   7904         MOV     R1,#0x4
   \   000024   12....       LCALL   ??HalLedSet?relay
   2053          #endif
   2054          
   2055            // Notify ZDApp
   2056            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_IND, sizeof(osal_event_hdr_t), (byte*)NULL );
   \                     ??ZDO_JoinConfirmCB_1:
   \   000027                ; Setup parameters for call to function ZDApp_SendMsg
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7B02         MOV     R3,#0x2
   \   00002D   7A02         MOV     R2,#0x2
   \   00002F   02....       LJMP    ?Subroutine20 & 0xFFFF
   2057          }
   2058          
   2059          /*********************************************************************
   2060           * @fn          ZDO_AddrChangeIndicationCB
   2061           *
   2062           * @brief       This function notifies the application that this
   2063           *              device's address has changed.  Could happen in 
   2064           *              a network with stochastic addressing (PRO).
   2065           *
   2066           * @param       newAddr - the new address
   2067           *
   2068           * @return      none
   2069           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2070          void ZDO_AddrChangeIndicationCB( uint16 newAddr )
   \                     ZDO_AddrChangeIndicationCB:
   2071          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2072            (void)newAddr;  // remove if this parameter is used
   2073            
   2074            // Notify to save info into NV
   2075            ZDApp_NVUpdate();
   2076          
   2077            // Notify the applications   
   2078            osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000004                ; Setup parameters for call to function osal_set_event
   \   000004   12....       LCALL   ?Subroutine2 & 0xFFFF
   2079          
   2080            // Send out a device announce
   2081            ZDApp_AnnounceNewAddress();
   \                     ??CrossCallReturnLabel_21:
   \   000007                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000007   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   2082          }
   \   00000A   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2083          
   2084          /*********************************************************************
   2085           * @fn          ZDO_JoinIndicationCB
   2086           *
   2087           * @brief       This function allows the next higher layer of a
   2088           *              coordinator to be notified of a remote join request.
   2089           *
   2090           * @param       ShortAddress - 16-bit address
   2091           * @param       ExtendedAddress - IEEE (64-bit) address
   2092           * @param       CapabilityInformation - Association Capability Information
   2093           * @param       type - of joining - 
   2094           *                          NWK_ASSOC_JOIN
   2095           *                          NWK_ASSOC_REJOIN_UNSECURE
   2096           *                          NWK_ASSOC_REJOIN_SECURE
   2097           *
   2098           * @return      ZStatus_t
   2099           */
   2100          ZStatus_t ZDO_JoinIndicationCB( uint16 ShortAddress, uint8 *ExtendedAddress,
   \                     ZDO_JoinIndicationCB:
   2101                                          uint8 CapabilityInformation, uint8 type )
   2102          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2103            (void)ShortAddress;
   2104            (void)ExtendedAddress;
   2105            (void)CapabilityInformation;
   2106            
   2107              // Notify to save info into NV
   2108              ZDApp_NVUpdate();
   2109            
   2110              // send notification to TC of new device..
   2111              if ( ZG_SECURE_ENABLED )
   2112              {
   2113                if ( type == NWK_ASSOC_JOIN || type == NWK_ASSOC_REJOIN_UNSECURE )
   2114                {
   2115                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 600 );
   2116                }
   2117              }
   2118            
   2119              return ( ZSuccess );
   \   000000                REQUIRE ?Subroutine14
   \   000000                ; // Fall through to label ?Subroutine14

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   7900         MOV     R1,#0x0
   \   000002   02....       LJMP    ?BRET
   2120          }
   2121          
   2122          /*********************************************************************
   2123           * @fn          ZDO_ConcentratorIndicationCB
   2124           *
   2125           * @brief       This function allows the next higher layer of a
   2126           *              device to be notified of existence of the concentrator.
   2127           *
   2128           * @param       nwkAddr - 16-bit NWK address of the concentrator
   2129           *
   2130           * @return      void 
   2131           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2132          void ZDO_ConcentratorIndicationCB( uint16 nwkAddr )
   \                     ZDO_ConcentratorIndicationCB:
   2133          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2134            // Write your code here to do something with the concentrator's
   2135            // address.
   2136            (void)nwkAddr;
   2137          }
   \   000000   02....       LJMP    ?BRET
   2138          
   2139          /*********************************************************************
   2140           * @fn          ZDO_LeaveCnf
   2141           *
   2142           * @brief       This function allows the next higher layer to be
   2143           *              notified of the results of its request for this or
   2144           *              a child device to leave the network.
   2145           *
   2146           * @param       cnf - NLME_LeaveCnf_t
   2147           *
   2148           * @return      none
   2149           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2150          void ZDO_LeaveCnf( NLME_LeaveCnf_t* cnf )
   \                     ZDO_LeaveCnf:
   2151          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2152            // Check for this device
   2153            if ( osal_ExtAddrEqual( cnf->extAddr,
   2154                                    NLME_GetExtAddr() ) == TRUE )
   \   000009   EE           MOV     A,R6
   \   00000A   2402         ADD     A,#0x2
   \   00000C   F5..         MOV     ?V0 + 0,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F5..         MOV     ?V0 + 1,A
   \   000013                ; Setup parameters for call to function sAddrExtCmp
   \   000013                ; Setup parameters for call to function NLME_GetExtAddr
   \   000013   12....       LCALL   ??NLME_GetExtAddr?relay
   \   000016   EA           MOV     A,R2
   \   000017   FC           MOV     R4,A
   \   000018   EB           MOV     A,R3
   \   000019   FD           MOV     R5,A
   \   00001A   AA..         MOV     R2,?V0 + 0
   \   00001C   AB..         MOV     R3,?V0 + 1
   \   00001E   12....       LCALL   ??sAddrExtCmp?relay
   \   000021   E9           MOV     A,R1
   \   000022   6401         XRL     A,#0x1
   \   000024   700C         JNZ     ??ZDO_LeaveCnf_0
   2155            {
   2156              // Prepare to leave with reset
   2157              ZDApp_LeaveReset( cnf->rejoin );
   \   000026                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000026   EE           MOV     A,R6
   \   000027   240B         ADD     A,#0xb
   \   000029   12....       LCALL   ??Subroutine24_0 & 0xFFFF
   2158            }
   \                     ??CrossCallReturnLabel_42:
   \   00002C   F9           MOV     R1,A
   \   00002D   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   000030   8017         SJMP    ??ZDO_LeaveCnf_1
   2159            else if ( ZSTACK_ROUTER_BUILD )
   2160            {
   2161              // Remove device address(optionally descendents) from data
   2162              ZDApp_LeaveUpdate( cnf->dstAddr,
   2163                                 cnf->extAddr,
   2164                                 cnf->removeChildren );
   \                     ??ZDO_LeaveCnf_0:
   \   000032                ; Setup parameters for call to function NLME_RemoveChild
   \   000032   8E82         MOV     DPL,R6
   \   000034   8F83         MOV     DPH,R7
   \   000036   A3           INC     DPTR
   \   000037   A3           INC     DPTR
   \   000038   A3           INC     DPTR
   \   000039   A3           INC     DPTR
   \   00003A   A3           INC     DPTR
   \   00003B   A3           INC     DPTR
   \   00003C   A3           INC     DPTR
   \   00003D   A3           INC     DPTR
   \   00003E   A3           INC     DPTR
   \   00003F   A3           INC     DPTR
   \   000040   E0           MOVX    A,@DPTR
   \   000041   F9           MOV     R1,A
   \   000042   AA..         MOV     R2,?V0 + 0
   \   000044   AB..         MOV     R3,?V0 + 1
   \   000046   12....       LCALL   ??NLME_RemoveChild?relay
   2165            }
   2166          }
   \                     ??ZDO_LeaveCnf_1:
   \   000049   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   2167          
   2168          /*********************************************************************
   2169           * @fn          ZDO_LeaveInd
   2170           *
   2171           * @brief       This function allows the next higher layer of a
   2172           *              device to be notified of a remote leave request or
   2173           *              indication.
   2174           *
   2175           * @param       ind - NLME_LeaveInd_t
   2176           *
   2177           * @return      none
   2178           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2179          void ZDO_LeaveInd( NLME_LeaveInd_t* ind )
   \                     ZDO_LeaveInd:
   2180          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   2181            uint8 leave;
   2182          
   2183          
   2184            // Parent is requesting the leave - NWK layer filters out illegal
   2185            // requests
   2186            if ( ind->request == TRUE )
   \   00000E   EE           MOV     A,R6
   \   00000F   240C         ADD     A,#0xc
   \   000011   F5..         MOV     ?V0 + 0,A
   \   000013   EF           MOV     A,R7
   \   000014   3400         ADDC    A,#0x0
   \   000016   F5..         MOV     ?V0 + 1,A
   \   000018   EE           MOV     A,R6
   \   000019   240B         ADD     A,#0xb
   \   00001B   F5..         MOV     ?V0 + 2,A
   \   00001D   EF           MOV     A,R7
   \   00001E   3400         ADDC    A,#0x0
   \   000020   F5..         MOV     ?V0 + 3,A
   \   000022   8E82         MOV     DPL,R6
   \   000024   8F83         MOV     DPH,R7
   \   000026   A3           INC     DPTR
   \   000027   A3           INC     DPTR
   \   000028   A3           INC     DPTR
   \   000029   A3           INC     DPTR
   \   00002A   A3           INC     DPTR
   \   00002B   A3           INC     DPTR
   \   00002C   A3           INC     DPTR
   \   00002D   A3           INC     DPTR
   \   00002E   A3           INC     DPTR
   \   00002F   A3           INC     DPTR
   \   000030   E0           MOVX    A,@DPTR
   \   000031   6401         XRL     A,#0x1
   \   000033   7033         JNZ     ??ZDO_LeaveInd_0
   2187            {
   2188              // Notify network of leave
   2189              if ( ZSTACK_ROUTER_BUILD )
   2190              {
   2191                NLME_LeaveRsp_t rsp;
   2192                rsp.rejoin         = ind->rejoin;
   \   000035   85..82       MOV     DPL,?V0 + 0
   \   000038   85..83       MOV     DPH,?V0 + 1
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   C0E0         PUSH    A
   \   00003E   7401         MOV     A,#0x1
   \   000040   12....       LCALL   ?XSTACK_DISP0_8
   \   000043   D0E0         POP     A
   \   000045   F0           MOVX    @DPTR,A
   2193                rsp.removeChildren = ind->removeChildren;
   \   000046   85..82       MOV     DPL,?V0 + 2
   \   000049   85..83       MOV     DPH,?V0 + 3
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   85..82       MOV     DPL,?XSP + 0
   \   000050   85..83       MOV     DPH,?XSP + 1
   \   000053   F0           MOVX    @DPTR,A
   2194                NLME_LeaveRsp( &rsp );
   \   000054                ; Setup parameters for call to function NLME_LeaveRsp
   \   000054   AA82         MOV     R2,DPL
   \   000056   AB83         MOV     R3,DPH
   \   000058   12....       LCALL   ??NLME_LeaveRsp?relay
   2195              }
   2196          
   2197              // Prepare to leave with reset
   2198              ZDApp_LeaveReset( ind->rejoin );
   \   00005B                ; Setup parameters for call to function ZDApp_LeaveReset
   \                     ??ZDO_LeaveInd_1:
   \   00005B   85..82       MOV     DPL,?V0 + 0
   \   00005E   85..83       MOV     DPH,?V0 + 1
   \   000061   E0           MOVX    A,@DPTR
   \   000062   F9           MOV     R1,A
   \   000063   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   000066   802D         SJMP    ??ZDO_LeaveInd_2
   2199            }
   2200            else
   2201            {
   2202              leave = FALSE;
   2203          
   2204              // Check if this device needs to leave as a child or descendent
   2205              if ( ind->srcAddr == NLME_GetCoordShortAddr() )
   \                     ??ZDO_LeaveInd_0:
   \   000068                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   000068   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   00006B   85..82       MOV     DPL,?V0 + 2
   \   00006E   85..83       MOV     DPH,?V0 + 3
   \   000071   E0           MOVX    A,@DPTR
   \   000072   F9           MOV     R1,A
   \   000073   8E82         MOV     DPL,R6
   \   000075   8F83         MOV     DPH,R7
   \   000077   E0           MOVX    A,@DPTR
   \   000078   6A           XRL     A,R2
   \   000079   7003         JNZ     ??ZDO_LeaveInd_3
   \   00007B   A3           INC     DPTR
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   6B           XRL     A,R3
   \                     ??ZDO_LeaveInd_3:
   \   00007E   700A         JNZ     ??ZDO_LeaveInd_4
   2206              {
   2207                if ( ( ind->removeChildren == TRUE               ) ||
   2208                     ( ZDO_Config_Node_Descriptor.LogicalType ==
   2209                       NODETYPE_DEVICE                           )    )
   \   000080   7401         MOV     A,#0x1
   \   000082   69           XRL     A,R1
   \   000083   60D6         JZ      ??ZDO_LeaveInd_1
   \   000085   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000088   60D1         JZ      ??ZDO_LeaveInd_1
   2210                {
   2211                  leave = TRUE;
   2212                }
   2213              }
   2214              else if ( ind->removeChildren == TRUE )
   2215              {
   2216                // Check NWK address allocation algorithm
   2217                //leave = RTG_ANCESTOR(nwkAddr,thisAddr);
   2218              }
   2219          
   2220              if ( leave == TRUE )
   2221              {
   2222                // Prepare to leave with reset
   2223                ZDApp_LeaveReset( ind->rejoin );
   \   00008A                ; Setup parameters for call to function ZDApp_LeaveReset
   2224              }
   2225              else
   2226              {
   2227                // Remove device address(optionally descendents) from data
   2228                ZDApp_LeaveUpdate( ind->srcAddr,
   2229                                   ind->extAddr,
   2230                                   ind->removeChildren );
   \                     ??ZDO_LeaveInd_4:
   \   00008A                ; Setup parameters for call to function NLME_RemoveChild
   \   00008A   EE           MOV     A,R6
   \   00008B   2402         ADD     A,#0x2
   \   00008D   FA           MOV     R2,A
   \   00008E   EF           MOV     A,R7
   \   00008F   3400         ADDC    A,#0x0
   \   000091   FB           MOV     R3,A
   \   000092   12....       LCALL   ??NLME_RemoveChild?relay
   2231              }
   2232            }
   2233          }
   \                     ??ZDO_LeaveInd_2:
   \   000095   7402         MOV     A,#0x2
   \   000097   02....       LJMP    ?Subroutine19 & 0xFFFF
   2234          
   2235          /*********************************************************************
   2236           * @fn          ZDO_SyncIndicationCB
   2237           *
   2238           * @brief       This function allows the next higher layer of a
   2239           *              coordinator to be notified of a loss of synchronization
   2240           *                          with the parent/child device.
   2241           *
   2242           * @param       type: 0 - child; 1 - parent
   2243           *
   2244           *
   2245           * @return      none
   2246           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2247          void ZDO_SyncIndicationCB( uint8 type, uint16 shortAddr )
   \                     ZDO_SyncIndicationCB:
   2248          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2249            (void)shortAddr;  // Remove this line if this parameter is used.
   2250            
   2251            if ( ZSTACK_END_DEVICE_BUILD
   2252              || (ZSTACK_ROUTER_BUILD && ((_NIB.CapabilityInfo & ZMAC_ASSOC_CAPINFO_FFD_TYPE) == 0)))
   \   000004   90....       MOV     DPTR,#(_NIB + 14)
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000A   4013         JC      ??CrossCallReturnLabel_28
   2253            {
   2254              if ( type == 1 )
   \   00000C   7401         MOV     A,#0x1
   \   00000E   69           XRL     A,R1
   \   00000F   700E         JNZ     ??CrossCallReturnLabel_28
   2255              {
   2256                // We lost contact with our parent.  Clear the neighbor Table.
   2257                nwkNeighborInitTable();
   \   000011                ; Setup parameters for call to function nwkNeighborInitTable
   \   000011   12....       LCALL   ??nwkNeighborInitTable?relay
   2258                
   2259                // Start the rejoin process.
   2260                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
   \   000014                ; Setup parameters for call to function ZDApp_SendMsg
   \   000014   7C00         MOV     R4,#0x0
   \   000016   7D00         MOV     R5,#0x0
   \   000018   7B02         MOV     R3,#0x2
   \   00001A   7A03         MOV     R2,#0x3
   \   00001C   12....       LCALL   ?Subroutine5 & 0xFFFF
   2261              }
   2262            }
   2263          }
   \                     ??CrossCallReturnLabel_28:
   \   00001F   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2264          
   2265          /*********************************************************************
   2266           * @fn          ZDO_ManytoOneFailureIndicationCB
   2267           *
   2268           * @brief       This function allows the next higher layer of a
   2269           *              concentrator to be notified of a many-to-one route 
   2270           *              failure. 
   2271           *
   2272           * @param       none
   2273           *
   2274           *
   2275           * @return      none
   2276           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2277          void ZDO_ManytoOneFailureIndicationCB()
   \                     ZDO_ManytoOneFailureIndicationCB:
   2278          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2279            // By default, the concentrator automatically redo many-to-one route 
   2280            // discovery to update all many-to-one routes in the network
   2281            // If you want anything processing other than the default,
   2282            // please replace the following code.
   2283            
   2284            if( zgConcentratorRC == true )  // concentrator with route cache
   \   000004   90....       MOV     DPTR,#zgConcentratorRC
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   90....       MOV     DPTR,#zgConcentratorRadius
   \   00000D   7006         JNZ     ??ZDO_ManytoOneFailureIndicationCB_0
   2285            {
   2286              NLME_RouteDiscoveryRequest( 0x00, MTO_ROUTE, zgConcentratorRadius);
   \   00000F                ; Setup parameters for call to function NLME_RouteDiscoveryRequest
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   FC           MOV     R4,A
   \   000011   7901         MOV     R1,#0x1
   \   000013   8004         SJMP    ??ZDO_ManytoOneFailureIndicationCB_1
   2287            }
   2288            else
   2289            { // Concentrator with no route cache
   2290              NLME_RouteDiscoveryRequest( 0x00, MTO_ROUTE | NO_ROUTE_CACHE, zgConcentratorRadius);
   \                     ??ZDO_ManytoOneFailureIndicationCB_0:
   \   000015                ; Setup parameters for call to function NLME_RouteDiscoveryRequest
   \   000015   E0           MOVX    A,@DPTR
   \   000016   FC           MOV     R4,A
   \   000017   7903         MOV     R1,#0x3
   \                     ??ZDO_ManytoOneFailureIndicationCB_1:
   \   000019   7A00         MOV     R2,#0x0
   \   00001B   7B00         MOV     R3,#0x0
   \   00001D   12....       LCALL   ??NLME_RouteDiscoveryRequest?relay
   2291            } 
   2292          }
   \   000020   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2293          
   2294          
   2295          /*********************************************************************
   2296           * @fn          ZDO_PollConfirmCB
   2297           *
   2298           * @brief       This function allows the next higher layer to be
   2299           *              notified of a Poll Confirm.
   2300           *
   2301           * @param       none
   2302           *
   2303           * @return      none
   2304           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2305          void ZDO_PollConfirmCB( uint8 status )
   \                     ZDO_PollConfirmCB:
   2306          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2307            (void)status;  // Remove this line if this parameter is used.
   2308            return;
   \   000000   02....       LJMP    ?BRET
   2309          }
   2310          
   2311          /******************************************************************************
   2312           * @fn          ZDApp_NwkWriteNVRequest (stubs AddrMgrWriteNVRequest)
   2313           *
   2314           * @brief       Stub routine implemented by NHLE. NHLE should call
   2315           *              <AddrMgrWriteNV> when appropriate.
   2316           *
   2317           * @param       none
   2318           *
   2319           * @return      none
   2320           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2321          void ZDApp_NwkWriteNVRequest( void )
   \                     AddrMgrWriteNVRequest:
   2322          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2323          #if defined ( NV_RESTORE )  
   2324            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   2325            {
   2326              // Trigger to save info into NV
   2327              ZDApp_NVUpdate();
   2328            }
   2329          #endif
   2330          }
   \   000000   02....       LJMP    ?BRET
   2331          
   2332          /*********************************************************************
   2333           * Call Back Functions from Security  - API
   2334           */
   2335          
   2336           /*********************************************************************
   2337           * @fn          ZDO_UpdateDeviceIndication
   2338           *
   2339           * @brief       This function notifies the "Trust Center" of a
   2340           *              network when a device joins or leaves the network.
   2341           *
   2342           * @param       extAddr - pointer to 64 bit address of new device
   2343           * @param       status  - 0 if a new device joined securely
   2344           *                      - 1 if a new device joined un-securely
   2345           *                      - 2 if a device left the network
   2346           *
   2347           * @return      true if newly joined device should be allowed to
   2348           *                                              remain on network
   2349           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2350          ZStatus_t ZDO_UpdateDeviceIndication( uint8 *extAddr, uint8 status )
   \                     ZDO_UpdateDeviceIndication:
   2351          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2352            // can implement a network access policy based on the
   2353            // IEEE address of newly joining devices...
   2354            (void)extAddr;
   2355            (void)status;
   2356            
   2357            return ZSuccess;
   \   000000   02....       LJMP    ?Subroutine14 & 0xFFFF
   2358          }
   2359          
   2360          /*********************************************************************
   2361           * @fn          ZDApp_InMsgCB
   2362           *
   2363           * @brief       This function is called to pass up any message that is
   2364           *              not yet supported.  This allows for the developer to
   2365           *              support features themselves..
   2366           *
   2367           * @return      none
   2368           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2369          void ZDApp_InMsgCB( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_InMsgCB:
   2370          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2371            if ( inMsg->clusterID & ZDO_RESPONSE_BIT )
   \   000009   EE           MOV     A,R6
   \   00000A   240C         ADD     A,#0xc
   \   00000C   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   00000F   F9           MOV     R1,A
   \   000010   7480         MOV     A,#-0x80
   \   000012   59           ANL     A,R1
   \   000013   FB           MOV     R3,A
   \   000014   E4           CLR     A
   \   000015   7001         JNZ     ??ZDApp_InMsgCB_0
   \   000017   EB           MOV     A,R3
   \                     ??ZDApp_InMsgCB_0:
   \   000018   7046         JNZ     ??ZDApp_InMsgCB_1
   2372            {
   2373              // Handle the response message
   2374            }
   2375            else
   2376            {
   2377              // Handle the request message by sending a generic "not supported".
   2378              // Device Announce doesn't have a response.
   2379              if ( !(inMsg->wasBroadcast) && inMsg->clusterID != Device_annce )
   \   00001A   EE           MOV     A,R6
   \   00001B   240B         ADD     A,#0xb
   \   00001D   12....       LCALL   ??Subroutine24_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_43:
   \   000020   703E         JNZ     ??ZDApp_InMsgCB_1
   \   000022   7413         MOV     A,#0x13
   \   000024   68           XRL     A,R0
   \   000025   7001         JNZ     ??ZDApp_InMsgCB_2
   \   000027   E9           MOV     A,R1
   \                     ??ZDApp_InMsgCB_2:
   \   000028   6036         JZ      ??ZDApp_InMsgCB_1
   2380              {
   2381                ZDP_GenericRsp( inMsg->TransSeq, &(inMsg->srcAddr), ZDP_NOT_SUPPORTED, 0,
   2382                                (uint16)(inMsg->clusterID | ZDO_RESPONSE_BIT), inMsg->SecurityUse );
   \   00002A                ; Setup parameters for call to function ZDP_GenericRsp
   \   00002A   E8           MOV     A,R0
   \   00002B   F5..         MOV     ?V0 + 0,A
   \   00002D   7480         MOV     A,#-0x80
   \   00002F   49           ORL     A,R1
   \   000030   F5..         MOV     ?V0 + 1,A
   \   000032   78..         MOV     R0,#?V0 + 0
   \   000034   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000037   75..00       MOV     ?V0 + 0,#0x0
   \   00003A   75..00       MOV     ?V0 + 1,#0x0
   \   00003D   78..         MOV     R0,#?V0 + 0
   \   00003F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000042   EE           MOV     A,R6
   \   000043   240E         ADD     A,#0xe
   \   000045   12....       LCALL   ??Subroutine24_0 & 0xFFFF
   2383              }
   2384            }
   \                     ??CrossCallReturnLabel_44:
   \   000048   FD           MOV     R5,A
   \   000049   7C84         MOV     R4,#-0x7c
   \   00004B   EE           MOV     A,R6
   \   00004C   2402         ADD     A,#0x2
   \   00004E   0A           INC     R2
   \   00004F   0A           INC     R2
   \   000050   EF           MOV     A,R7
   \   000051   3400         ADDC    A,#0x0
   \   000053   FB           MOV     R3,A
   \   000054   12....       LCALL   ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_46:
   \   000057   F9           MOV     R1,A
   \   000058   12....       LCALL   ??ZDP_GenericRsp?relay
   \   00005B   7404         MOV     A,#0x4
   \   00005D   12....       LCALL   ?DEALLOC_XSTACK8
   2385          }
   \                     ??ZDApp_InMsgCB_1:
   \   000060   02....       LJMP    ??Subroutine26_0 & 0xFFFF
   2386          
   2387          
   2388          /*********************************************************************
   2389           * @fn      ZDApp_ChangeMatchDescRespPermission()
   2390           *
   2391           * @brief   Changes the Match Descriptor Response permission.
   2392           *
   2393           * @param   endpoint - endpoint to allow responses
   2394           * @param   action - true to allow responses, false to not
   2395           *
   2396           * @return  none
   2397           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2398          void ZDApp_ChangeMatchDescRespPermission( uint8 endpoint, uint8 action )
   \                     ZDApp_ChangeMatchDescRespPermission:
   2399          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2400            // Store the action
   2401            afSetMatch( endpoint, action );
   \   000004                ; Setup parameters for call to function afSetMatch
   \   000004   12....       LCALL   ??afSetMatch?relay
   2402          }
   \   000007   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2403          
   2404          /*********************************************************************
   2405           * @fn      ZDApp_NetworkInit()
   2406           *
   2407           * @brief   Used to start the network joining process
   2408           *
   2409           * @param   delay - mSec delay to wait before starting
   2410           *
   2411           * @return  none
   2412           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2413          void ZDApp_NetworkInit( uint16 delay )
   \                     ZDApp_NetworkInit:
   2414          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2415            if ( delay )
   \   000004   EA           MOV     A,R2
   \   000005   7001         JNZ     ??ZDApp_NetworkInit_0
   \   000007   EB           MOV     A,R3
   \                     ??ZDApp_NetworkInit_0:
   \   000008   600B         JZ      ??ZDApp_NetworkInit_1
   2416            {
   2417              // Wait awhile before starting the device
   2418              osal_start_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT, delay );
   \   00000A                ; Setup parameters for call to function osal_start_timerEx
   \   00000A   EA           MOV     A,R2
   \   00000B   FC           MOV     R4,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FD           MOV     R5,A
   \   00000E   7A01         MOV     R2,#0x1
   \   000010   12....       LCALL   ?Subroutine6 & 0xFFFF
   2419            }
   \                     ??CrossCallReturnLabel_9:
   \   000013   8005         SJMP    ??CrossCallReturnLabel_23
   2420            else
   2421            {
   2422              osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \                     ??ZDApp_NetworkInit_1:
   \   000015                ; Setup parameters for call to function osal_set_event
   \   000015   7A01         MOV     R2,#0x1
   \   000017   12....       LCALL   ?Subroutine17 & 0xFFFF
   2423            }
   2424          }
   \                     ??CrossCallReturnLabel_23:
   \   00001A   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2425          
   2426          /*********************************************************************
   2427           * @fn      ZDApp_NwkStateUpdateCB()
   2428           *
   2429           * @brief   This function notifies that this device's network 
   2430           *          state info has been changed.
   2431           *
   2432           * @param   none
   2433           *
   2434           * @return  none
   2435           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2436          void ZDApp_NwkStateUpdateCB( void )
   \                     ZDApp_NwkStateUpdateCB:
   2437          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2438            // Notify to save info into NV
   2439            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000004                ; Setup parameters for call to function osal_get_timeoutEx
   \   000004   7A00         MOV     R2,#0x0
   \   000006   7B02         MOV     R3,#0x2
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_get_timeoutEx?relay
   2440            {
   2441              // Trigger to save info into NV
   2442              ZDApp_NVUpdate();
   2443            }
   2444          }
   \   000010   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2445          
   2446          /*********************************************************************
   2447           * @fn      ZDApp_NodeProfileSync()
   2448           *
   2449           * @brief   Sync node with stack profile.
   2450           *
   2451           * @param   cfm - ZDO_NetworkDiscoveryCfm_t
   2452           *
   2453           * @return  none
   2454           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2455          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm )
   \                     ZDApp_NodeProfileSync:
   2456          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2457            networkDesc_t* desc;
   2458            uint16         panID;
   2459          
   2460            if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_DEVICETYPE_FFD  )
   \   000005   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000008   E0           MOVX    A,@DPTR
   \   000009   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000B   5058         JNC     ??ZDApp_NodeProfileSync_0
   2461            {
   2462              panID = BUILD_UINT16( cfm->panIdLSB, cfm->panIdMSB );
   2463          
   2464              desc = nwk_getNetworkDesc( cfm->extendedPANID, panID, cfm->logicalChannel );
   \   00000D                ; Setup parameters for call to function nwk_getNetworkDesc
   \   00000D   8A82         MOV     DPL,R2
   \   00000F   8B83         MOV     DPH,R3
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F9           MOV     R1,A
   \   000017   8A82         MOV     DPL,R2
   \   000019   8B83         MOV     DPH,R3
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   FE           MOV     R6,A
   \   00001F   8A82         MOV     DPL,R2
   \   000021   8B83         MOV     DPH,R3
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FD           MOV     R5,A
   \   000028   EE           MOV     A,R6
   \   000029   FC           MOV     R4,A
   \   00002A   EA           MOV     A,R2
   \   00002B   2406         ADD     A,#0x6
   \   00002D   FA           MOV     R2,A
   \   00002E   EB           MOV     A,R3
   \   00002F   3400         ADDC    A,#0x0
   \   000031   FB           MOV     R3,A
   \   000032   12....       LCALL   ??nwk_getNetworkDesc?relay
   \   000035   8A82         MOV     DPL,R2
   \   000037   8B83         MOV     DPH,R3
   2465          
   2466              if (desc != NULL)
   \   000039   E582         MOV     A,DPL
   \   00003B   7002         JNZ     ??ZDApp_NodeProfileSync_1
   \   00003D   E583         MOV     A,DPH
   \                     ??ZDApp_NodeProfileSync_1:
   \   00003F   6024         JZ      ??ZDApp_NodeProfileSync_0
   2467              {
   2468                if ( desc->stackProfile != zgStackProfile )
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   FA           MOV     R2,A
   \   00004B   90....       MOV     DPTR,#zgStackProfile
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6A           XRL     A,R2
   \   000050   6013         JZ      ??ZDApp_NodeProfileSync_0
   2469                {
   2470                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000052   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000055   E0           MOVX    A,@DPTR
   \   000056   54F8         ANL     A,#0xf8
   \   000058   4402         ORL     A,#0x2
   \   00005A   F0           MOVX    @DPTR,A
   2471                  ZDO_Config_Node_Descriptor.CapabilityFlags = CAPINFO_DEVICETYPE_RFD | CAPINFO_POWER_AC | CAPINFO_RCVR_ON_IDLE;
   \   00005B   740C         MOV     A,#0xc
   \   00005D   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000060   F0           MOVX    @DPTR,A
   2472                  NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000061                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000061   F9           MOV     R1,A
   \   000062   12....       LCALL   ??NLME_SetBroadcastFilter?relay
   2473                }
   2474              }
   2475            }
   2476          }
   \                     ??ZDApp_NodeProfileSync_0:
   \   000065   80..         SJMP    ??Subroutine26_0
   2477          
   2478          /*********************************************************************
   2479           * @fn      ZDApp_StartJoiningCycle()
   2480           *
   2481           * @brief   Starts the joining cycle of a device.  This will only 
   2482           *          continue an already started (or stopped) joining cycle.
   2483           *
   2484           * @param   none
   2485           *
   2486           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2487           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2488          uint8 ZDApp_StartJoiningCycle( void )
   \                     ZDApp_StartJoiningCycle:
   2489          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2490            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StartJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7011         JNZ     ??ZDApp_StartJoiningCycle_1
   2491            {
   2492              continueJoining = TRUE;
   \                     ??ZDApp_StartJoiningCycle_0:
   \   000011   7401         MOV     A,#0x1
   \   000013   90....       MOV     DPTR,#continueJoining
   \   000016   F0           MOVX    @DPTR,A
   2493              ZDApp_NetworkInit( 0 );
   \   000017                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   12....       LCALL   ??ZDApp_NetworkInit?relay
   2494          
   2495              return ( TRUE );
   \   00001E   7901         MOV     R1,#0x1
   \   000020   8002         SJMP    ??ZDApp_StartJoiningCycle_2
   2496            }
   2497            else
   2498              return ( FALSE );
   \                     ??ZDApp_StartJoiningCycle_1:
   \   000022   7900         MOV     R1,#0x0
   \                     ??ZDApp_StartJoiningCycle_2:
   \   000024   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2499          }
   2500          
   2501          /*********************************************************************
   2502           * @fn      ZDApp_StopJoiningCycle()
   2503           *
   2504           * @brief   Stops the joining or rejoining process of a device.
   2505           *
   2506           * @param   none
   2507           *
   2508           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2509           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2510          uint8 ZDApp_StopJoiningCycle( void )
   \                     ZDApp_StopJoiningCycle:
   2511          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2512            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StopJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7009         JNZ     ??ZDApp_StopJoiningCycle_1
   2513            {
   2514              continueJoining = FALSE;
   \                     ??ZDApp_StopJoiningCycle_0:
   \   000011   E4           CLR     A
   \   000012   90....       MOV     DPTR,#continueJoining
   \   000015   F0           MOVX    @DPTR,A
   2515              return ( TRUE );
   \   000016   7901         MOV     R1,#0x1
   \   000018   8002         SJMP    ??ZDApp_StopJoiningCycle_2
   2516            }
   2517            else
   2518              return ( FALSE );
   \                     ??ZDApp_StopJoiningCycle_1:
   \   00001A   7900         MOV     R1,#0x0
   \                     ??ZDApp_StopJoiningCycle_2:
   \   00001C   02....       LJMP    ??Subroutine23_0 & 0xFFFF
   2519          }
   2520          
   2521          /*********************************************************************
   2522           * @fn      ZDApp_AnnounceNewAddress()
   2523           *
   2524           * @brief   Send Device Announce and hold all transmissions for 
   2525           *          new address timeout.
   2526           *
   2527           * @param   none
   2528           *
   2529           * @return  none
   2530           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2531          void ZDApp_AnnounceNewAddress( void )
   \                     ZDApp_AnnounceNewAddress:
   2532          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2533          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2534            // Turn off data request hold
   2535            APSME_HoldDataRequests( 0 );
   2536          #endif
   2537            
   2538            ZDP_DeviceAnnce( NLME_GetShortAddr(), NLME_GetExtAddr(),
   2539                               ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   \   000005                ; Setup parameters for call to function NLME_GetExtAddr
   \   000005   12....       LCALL   ??NLME_GetExtAddr?relay
   \   000008   8A..         MOV     ?V0 + 0,R2
   \   00000A   8B..         MOV     ?V0 + 1,R3
   \   00000C   AE..         MOV     R6,?V0 + 0
   \   00000E                ; Setup parameters for call to function NLME_GetShortAddr
   \   00000E   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000011                ; Setup parameters for call to function ZDP_DeviceAnnce
   \   000011   75..00       MOV     ?V0 + 0,#0x0
   \   000014   78..         MOV     R0,#?V0 + 0
   \   000016   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000019   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F9           MOV     R1,A
   \   00001E   EE           MOV     A,R6
   \   00001F   FC           MOV     R4,A
   \   000020   AD..         MOV     R5,?V0 + 1
   \   000022   12....       LCALL   ??ZDP_DeviceAnnce?relay
   \   000025   7401         MOV     A,#0x1
   \   000027   80..         SJMP    ??Subroutine25_0
   2540            
   2541          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2542            // Setup the timeout
   2543            APSME_HoldDataRequests( ZDAPP_HOLD_DATA_REQUESTS_TIMEOUT );
   2544          #endif  
   2545          }
   2546          
   2547          /*********************************************************************
   2548           * @fn          ZDApp_NVUpdate
   2549           *
   2550           * @brief       Set the NV Update Timer.
   2551           *
   2552           * @param       none
   2553           *
   2554           * @return      none
   2555           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2556          void ZDApp_NVUpdate( void )
   \                     ZDApp_NVUpdate:
   2557          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2558          #if defined ( NV_RESTORE )
   2559            osal_start_timerEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
   2560          #endif
   2561          }
   \   000000   02....       LJMP    ?BRET
   2562          
   2563          /*********************************************************************
   2564           * @fn      ZDApp_CoordStartPANIDConflictCB()
   2565           *
   2566           * @brief   Returns a PAN ID for the network layer to use during
   2567           *          a coordinator start and there is another network with 
   2568           *          the intended PANID.
   2569           *
   2570           * @param   panid - the intended PAN ID
   2571           *
   2572           * @return  PANID to try
   2573           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2574          uint16 ZDApp_CoordStartPANIDConflictCB( uint16 panid )
   \                     ZDApp_CoordStartPANIDConflictCB:
   2575          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2576            return ( panid + 1 );
   \   000000   7401         MOV     A,#0x1
   \   000002   2A           ADD     A,R2
   \   000003   0A           INC     R2
   \   000004   E4           CLR     A
   \   000005   3B           ADDC    A,R3
   \   000006   FB           MOV     R3,A
   \   000007   02....       LJMP    ?BRET
   2577          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zdoDiscCounter>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for continueJoining>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for devStartMode>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_epDesc>`:
   \   000000   00           DB 0
   \   000001   ....0000     DW ZDAppTaskID, 0H
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_SavedPollRate>`:
   \   000000   E803         DW 1000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_0:
   \   000000   00000000     DD 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SecInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SecInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDOInitDevice?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDOInitDevice

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ReadNetworkRestoreState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ReadNetworkRestoreState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppDetermineDeviceType?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppDetermineDeviceType

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkStartEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkStartEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceAuthEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceAuthEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNetworkStateEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNetworkStateEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNetworkState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNetworkState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitUserDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitUserDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppCheckForHoldKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppCheckForHoldKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessOSALMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RegisterCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RegisterCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessNetworkJoin?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessNetworkJoin

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerCancel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerCancel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlBypass?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlBypass

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlStartup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlStartup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendEventMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendEventMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkDiscoveryConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkFormationConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkFormationConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_StartRouterConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_StartRouterConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_AddrChangeIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_AddrChangeIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ConcentratorIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ConcentratorIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveCnf?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveCnf

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SyncIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SyncIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ManytoOneFailureIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ManytoOneFailureIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_PollConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_PollConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AddrMgrWriteNVRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AddrMgrWriteNVRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_UpdateDeviceIndication?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_UpdateDeviceIndication

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InMsgCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ChangeMatchDescRespPermission?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ChangeMatchDescRespPermission

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NwkStateUpdateCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NwkStateUpdateCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NodeProfileSync?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NodeProfileSync

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_AnnounceNewAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_AnnounceNewAddress

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NVUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NVUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_CoordStartPANIDConflictCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_CoordStartPANIDConflictCB
   2578          
   2579          /*********************************************************************
   2580          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AddrMgrWriteNVRequest              0      0      0
     ZDAppCheckForHoldKey               2      0      0
       -> HalKeyRead                    4      0      0
     ZDAppDetermineDeviceType           2      0     12
       -> nwk_ExtPANIDValid             4      0      0
     ZDApp_AnnounceNewAddress           0      0     23
       -> NLME_GetExtAddr               0      0     20
       -> NLME_GetShortAddr             0      0     20
       -> ZDP_DeviceAnnce               0      0     22
     ZDApp_ChangeMatchDescRespPermission
                                        2      0      0
       -> afSetMatch                    4      0      0
     ZDApp_CoordStartPANIDConflictCB
                                        0      0      0
     ZDApp_DeviceAuthEvt                2      0      9
       -> ZDApp_ResetTimerCancel        4      0      0
       -> osal_set_event                4      0      0
       -> NLME_StartRouterRequest       4      0      0
       -> ZDApp_SaveNwkKey              4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
       -> NLME_SetPollRate              4      0      0
     ZDApp_InMsgCB                      0      0     14
       -> ZDP_GenericRsp                0      0     28
     ZDApp_Init                         2      0      0
       -> NLME_GetExtAddr               4      0      0
       -> ZDAppCheckForHoldKey          4      0      0
       -> ZDO_Init                      4      0      0
       -> afRegister                    4      0      0
       -> ZDApp_InitUserDesc            4      0      0
       -> ZDOInitDevice                 4      0      0
       -> HalLedBlink                   4      0      0
       -> ZDApp_RegisterCBs             4      0      0
     ZDApp_InitUserDesc                 0      0     31
       -> osal_memset                   0      0     54
       -> osal_nv_item_init             0      0     58
       -> osal_nv_read                  0      0     62
     ZDApp_LeaveCtrlBypass              2      0      0
     ZDApp_LeaveCtrlInit                0      0     26
       -> osal_nv_item_init             0      0     24
       -> osal_nv_read                  0      0     28
     ZDApp_LeaveCtrlSet                 0      0     14
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlStartup             1      0     26
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveReset                   2      0     16
       -> ZDApp_LeaveCtrlSet            4      0      0
       -> ZDApp_ResetTimerStart         4      0      0
     ZDApp_LeaveUpdate                  2      0      0
       -> NLME_RemoveChild              4      0      0
     ZDApp_NVUpdate                     0      0      0
     ZDApp_NetworkInit                  2      0     12
       -> osal_start_timerEx            4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NetworkStartEvt              2      0     10
       -> osal_pwrmgr_device            4      0      0
       -> osal_set_event                4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_SetEnergyThreshold       4      0      0
       -> osal_set_event                4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NodeProfileSync              0      0     10
       -> nwk_getNetworkDesc            0      0     20
       -> NLME_SetBroadcastFilter       0      0     20
     ZDApp_NwkStateUpdateCB             2      0      0
       -> osal_get_timeoutEx            4      0      0
     ZDApp_ProcessMsgCBs                0      0     54
       -> ZDO_ParseAddrRsp              0      0    108
       -> ZDO_UpdateAddrManager         0      0    108
       -> osal_mem_free                 0      0    108
       -> ZDO_ParseBindUnbindReq        0      0    108
       -> ZDO_ProcessBindUnbindReq      0      0    108
       -> ZDMatchSendState              0      0    108
       -> ZDO_ParseEndDeviceBindReq     0      0    108
       -> ZDO_MatchEndDeviceBind        0      0    108
       -> osal_mem_free                 0      0    108
       -> osal_mem_free                 0      0    108
     ZDApp_ProcessNetworkJoin           0      0     12
       -> osal_set_event                0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> NLME_GetShortAddr             0      0     24
       -> ZMacSetReq                    0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> osal_set_event                0      0     24
       -> NLME_SetPollRate              0      0     24
       -> NLME_SetQueuedPollRate        0      0     24
       -> NLME_SetResponseRate          0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
     ZDApp_ProcessOSALMsg               2      0     10
       -> ZDP_IncomingData              4      0      0
       -> ZDApp_ProcessMsgCBs           4      0      0
     ZDApp_ProcessSecEvent              0      0      9
       -> ZDSecMgrNewDeviceEvent        0      0     18
       -> osal_start_timerEx            0      0     18
       -> ZDApp_DeviceAuthEvt           0      0     18
       -> ZDApp_SaveNwkKey              0      0     18
     ZDApp_ProcessSecMsg                2      0      0
       -> ZDSecMgrUpdateDeviceInd       4      0      0
     ZDApp_ReadNetworkRestoreState      0      0      9
       -> zgReadStartupOptions          0      0     18
     ZDApp_RegisterCBs                  2      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     ZDApp_ResetNwkKey                  0      0     35
       -> osal_memset                   0      0     62
       -> osal_nv_write                 0      0     70
     ZDApp_ResetTimerCancel             2      0      0
       -> osal_stop_timerEx             4      0      0
     ZDApp_ResetTimerStart              2      0      0
       -> osal_start_timerEx            4      0      0
     ZDApp_RestoreNetworkState          0      0      9
       -> NLME_InitNV                   0      0     18
       -> NLME_RestoreFromNV            0      0     18
       -> NLME_GetShortAddr             0      0     18
       -> sAddrExtCpy                   0      0     18
     ZDApp_RestoreNwkKey                0      0     37
       -> osal_nv_read                  0      0     74
     ZDApp_SaveNetworkStateEvt          0      0      0
     ZDApp_SaveNwkKey                   0      0     46
       -> SSP_ReadNwkActiveKey          0      0     66
       -> osal_nv_write                 0      0     74
     ZDApp_SecInit                      2      0      0
       -> ZDSecMgrInit                  4      0      0
     ZDApp_SendEventMsg                 2      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDApp_SendMsg                      1      0     52
       -> osal_msg_allocate             0      0     34
       -> osal_memcpy                   0      0     40
       -> osal_msg_send                 0      0     34
     ZDApp_StartJoiningCycle            2      0      0
       -> ZDApp_NetworkInit             4      0      0
     ZDApp_StopJoiningCycle             2      0      0
     ZDApp_event_loop                   0      0     10
       -> ZDO_StartDevice               0      0     20
       -> ZDApp_ProcessOSALMsg          0      0     20
       -> osal_msg_deallocate           0      0     20
       -> osal_msg_receive              0      0     20
       -> ZDApp_NetworkStartEvt         0      0     20
       -> osal_pwrmgr_device            0      0     20
       -> osal_set_event                0      0     20
       -> ZDO_UpdateNwkStatus           0      0     20
     ZDOInitDevice                      0      0     12
       -> zgInitItems                   0      0     24
       -> ZDConfig_InitDescriptors      0      0     24
       -> ZDApp_LeaveCtrlInit           0      0     24
       -> ZDApp_LeaveCtrlStartup        0      0     24
       -> ZDAppDetermineDeviceType      0      0     24
       -> osal_rand                     0      0     24
       -> ZDSecMgrInit                  0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> NLME_SetBroadcastFilter       0      0     24
     ZDO_AddrChangeIndicationCB         2      0      0
       -> osal_set_event                4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
     ZDO_ConcentratorIndicationCB       0      0      0
     ZDO_JoinConfirmCB                  2      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDO_JoinIndicationCB               0      0      1
     ZDO_LeaveCnf                       0      0     10
       -> NLME_GetExtAddr               0      0     20
       -> sAddrExtCmp                   0      0     20
       -> ZDApp_LeaveReset              0      0     20
       -> NLME_RemoveChild              0      0     20
     ZDO_LeaveInd                       1      0     16
       -> NLME_LeaveRsp                 0      0     32
       -> ZDApp_LeaveReset              0      0     32
       -> NLME_GetCoordShortAddr        0      0     32
       -> ZDApp_LeaveReset              0      0     32
       -> NLME_RemoveChild              0      0     32
     ZDO_ManytoOneFailureIndicationCB
                                        2      0      0
       -> NLME_RouteDiscoveryRequest
                                        4      0      0
       -> NLME_RouteDiscoveryRequest
                                        4      0      0
     ZDO_NetworkDiscoveryConfirmCB      1      0     32
       -> nwk_ExtPANIDValid             0      0     64
       -> sAddrExtCmp                   0      0     64
       -> sAddrExtCpy                   0      0     64
       -> ZDApp_SendMsg                 0      0     64
     ZDO_NetworkFormationConfirmCB      2      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> osal_set_event                4      0      0
     ZDO_PollConfirmCB                  0      0      0
     ZDO_StartRouterConfirmCB           2      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> osal_set_event                4      0      0
     ZDO_SyncIndicationCB               2      0      0
       -> nwkNeighborInitTable          4      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDO_UpdateDeviceIndication         0      0      0


   Segment part sizes:

     Function/Label                              Bytes
     --------------                              -----
     _A_IEN0                                        1
     WDCTL                                          1
     MatchRsps                                      1
     zdoDiscCounter                                 1
     ZDAppNwkAddr                                   9
     zdappMgmtNwkDiscRspTransSeq                    1
     zdappMgmtNwkDiscReqInProgress                  1
     zdappMgmtNwkDiscRspAddr                        9
     zdappMgmtNwkDiscStartIndex                     1
     zdappMgmtSavedNwkState                         1
     nwkFrameCounterChanges                         2
     continueJoining                                1
     _tmpRejoinState                                1
     ZDO_UseExtendedPANID                           8
     ZDAppTaskID                                    1
     nwkStatus                                      1
     ZDApp_AutoFindMode_epDesc                      2
     ZDApp_LeaveCtrl                                1
     devState                                       1
     devStartMode                                   1
     retryCnt                                       1
     ZDApp_epDesc                                   6
     ZDApp_SavedPollRate                            2
     ZDApp_Init                                    78
     ??Subroutine23_0                               7
     ZDApp_SecInit                                 10
     ZDApp_event_loop                             203
     ?Subroutine17                                 11
     ?Subroutine2                                   5
     ??Subroutine26_0                               5
     ZDApp_ProcessSecEvent                        108
     ?Subroutine16                                  5
     ?Subroutine6                                  11
     ZDOInitDevice                                137
     ?Subroutine15                                  2
     ??Subroutine25_0                               3
     ZDApp_ReadNetworkRestoreState                 21
     ZDAppDetermineDeviceType                      74
     ZDApp_NetworkStartEvt                         78
     ?Subroutine13                                  3
     ZDApp_DeviceAuthEvt                           60
     ?Subroutine4                                   9
     ?Subroutine0                                   8
     ZDApp_SaveNetworkStateEvt                      3
     ZDApp_RestoreNetworkState                     78
     ZDApp_InitUserDesc                            93
     ?Subroutine10                                 32
     ZDAppCheckForHoldKey                          20
     ZDApp_ProcessOSALMsg                          33
     ZDApp_ProcessMsgCBs                          261
     ?Subroutine9                                   3
     ??Subroutine24_0                               9
     ?Subroutine8                                  12
     ZDApp_RegisterCBs                             48
     ?Subroutine3                                   2
     ??Subroutine21_0                               9
     ZDApp_ProcessSecMsg                           19
     ZDApp_ProcessNetworkJoin                     393
     ?Subroutine7                                  12
     ZDApp_SaveNwkKey                              82
     ?Subroutine18                                 10
     ?Subroutine11                                  6
     ??Subroutine22_0                               8
     ZDApp_ResetNwkKey                             40
     ZDApp_RestoreNwkKey                          110
     ZDApp_ResetTimerStart                         16
     ZDApp_ResetTimerCancel                        19
     ZDApp_LeaveCtrlInit                           65
     ?Subroutine1                                  14
     ZDApp_LeaveCtrlSet                            51
     ZDApp_LeaveCtrlBypass                         16
     ZDApp_LeaveCtrlStartup                        75
     ZDApp_LeaveReset                              16
     ZDApp_LeaveUpdate                             13
     ZDApp_SendEventMsg                             8
     ?Subroutine20                                  6
     ?Subroutine5                                   9
     ZDApp_SendMsg                                123
     ?Subroutine19                                  8
     ZDO_NetworkDiscoveryConfirmCB                396
     ZDO_NetworkFormationConfirmCB                 44
     ?Subroutine12                                  8
     ZDO_StartRouterConfirmCB                      37
     ZDO_JoinConfirmCB                             50
     ZDO_AddrChangeIndicationCB                    13
     ZDO_JoinIndicationCB                           0
     ?Subroutine14                                  5
     ZDO_ConcentratorIndicationCB                   3
     ZDO_LeaveCnf                                  76
     ZDO_LeaveInd                                 154
     ZDO_SyncIndicationCB                          34
     ZDO_ManytoOneFailureIndicationCB
                                                   35
     ZDO_PollConfirmCB                              3
     AddrMgrWriteNVRequest                          3
     ZDO_UpdateDeviceIndication                     3
     ZDApp_InMsgCB                                 99
     ZDApp_ChangeMatchDescRespPermission
                                                   10
     ZDApp_NetworkInit                             29
     ZDApp_NwkStateUpdateCB                        19
     ZDApp_NodeProfileSync                        103
     ZDApp_StartJoiningCycle                       39
     ZDApp_StopJoiningCycle                        31
     ZDApp_AnnounceNewAddress                      41
     ZDApp_NVUpdate                                 3
     ZDApp_CoordStartPANIDConflictCB
                                                   10
     ?<Initializer for zdoDiscCounter>              1
     ?<Initializer for continueJoining>             1
     ?<Initializer for devStartMode>                1
     ?<Initializer for ZDApp_epDesc>                6
     ?<Initializer for ZDApp_SavedPollRate>         2
     __Constant_1                                   4
     __Constant_0                                   4
     __Constant_3e8                                 4
     ??ZDApp_Init?relay                             6
     ??ZDApp_SecInit?relay                          6
     ??ZDApp_event_loop?relay                       6
     ??ZDApp_ProcessSecEvent?relay                  6
     ??ZDOInitDevice?relay                          6
     ??ZDApp_ReadNetworkRestoreState?relay          6
     ??ZDAppDetermineDeviceType?relay               6
     ??ZDApp_NetworkStartEvt?relay                  6
     ??ZDApp_DeviceAuthEvt?relay                    6
     ??ZDApp_SaveNetworkStateEvt?relay              6
     ??ZDApp_RestoreNetworkState?relay              6
     ??ZDApp_InitUserDesc?relay                     6
     ??ZDAppCheckForHoldKey?relay                   6
     ??ZDApp_ProcessOSALMsg?relay                   6
     ??ZDApp_ProcessMsgCBs?relay                    6
     ??ZDApp_RegisterCBs?relay                      6
     ??ZDApp_ProcessSecMsg?relay                    6
     ??ZDApp_ProcessNetworkJoin?relay               6
     ??ZDApp_SaveNwkKey?relay                       6
     ??ZDApp_ResetNwkKey?relay                      6
     ??ZDApp_RestoreNwkKey?relay                    6
     ??ZDApp_ResetTimerStart?relay                  6
     ??ZDApp_ResetTimerCancel?relay                 6
     ??ZDApp_LeaveCtrlInit?relay                    6
     ??ZDApp_LeaveCtrlSet?relay                     6
     ??ZDApp_LeaveCtrlBypass?relay                  6
     ??ZDApp_LeaveCtrlStartup?relay                 6
     ??ZDApp_LeaveReset?relay                       6
     ??ZDApp_LeaveUpdate?relay                      6
     ??ZDApp_SendEventMsg?relay                     6
     ??ZDApp_SendMsg?relay                          6
     ??ZDO_NetworkDiscoveryConfirmCB?relay          6
     ??ZDO_NetworkFormationConfirmCB?relay          6
     ??ZDO_StartRouterConfirmCB?relay               6
     ??ZDO_JoinConfirmCB?relay                      6
     ??ZDO_AddrChangeIndicationCB?relay             6
     ??ZDO_JoinIndicationCB?relay                   6
     ??ZDO_ConcentratorIndicationCB?relay           6
     ??ZDO_LeaveCnf?relay                           6
     ??ZDO_LeaveInd?relay                           6
     ??ZDO_SyncIndicationCB?relay                   6
     ??ZDO_ManytoOneFailureIndicationCB?relay       6
     ??ZDO_PollConfirmCB?relay                      6
     ??AddrMgrWriteNVRequest?relay                  6
     ??ZDO_UpdateDeviceIndication?relay             6
     ??ZDApp_InMsgCB?relay                          6
     ??ZDApp_ChangeMatchDescRespPermission?relay    6
     ??ZDApp_NetworkInit?relay                      6
     ??ZDApp_NwkStateUpdateCB?relay                 6
     ??ZDApp_NodeProfileSync?relay                  6
     ??ZDApp_StartJoiningCycle?relay                6
     ??ZDApp_StopJoiningCycle?relay                 6
     ??ZDApp_AnnounceNewAddress?relay               6
     ??ZDApp_NVUpdate?relay                         6
     ??ZDApp_CoordStartPANIDConflictCB?relay        6

 
 3 808 bytes in segment BANKED_CODE
   330 bytes in segment BANK_RELAYS
     2 bytes in segment SFR_AN
    11 bytes in segment XDATA_I
    11 bytes in segment XDATA_ID
    12 bytes in segment XDATA_ROM_C
    41 bytes in segment XDATA_Z
 
 4 149 bytes of CODE  memory
     0 bytes of CONST memory (+ 12 bytes shared)
     0 bytes of DATA  memory (+  2 bytes shared)
    52 bytes of XDATA memory

Errors: none
Warnings: none
