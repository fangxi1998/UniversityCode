###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         16/Dec/2014  18:18:11 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  E:\Zigbee-timer\Texas Instruments\Projects\zstack\ #
#                          Samples\MyfirstAPP\Source\SHT10.c                  #
#    Command line       =  -f "E:\Zigbee-timer\Texas                          #
#                          Instruments\Projects\zstack\Samples\MyfirstAPP\CC2 #
#                          530DB\..\..\..\Tools\CC2530DB\f8wEndev.cfg"        #
#                          (-DCPU32MHZ -DROOT=__near_func -DBLINK_LEDS) -f    #
#                          "E:\Zigbee-timer\Texas Instruments\Projects\zstack #
#                          \Samples\MyfirstAPP\CC2530DB\..\..\..\Tools\CC2530 #
#                          DB\f8wConfig.cfg" (-DSECURE=0                      #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x02000000                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xA1B2                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "E:\Zigbee-timer\Texas Instruments\Projects\zstack #
#                          \Samples\MyfirstAPP\Source\SHT10.c" -D ZIGBEEPRO   #
#                          -D NWK_AUTO_POLL -D ZTOOL_P1 -D MT_TASK -D         #
#                          MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG  #
#                          -D xPOWER_SAVING -lC "E:\Zigbee-timer\Texas        #
#                          Instruments\Projects\zstack\Samples\MyfirstAPP\CC2 #
#                          530DB\EndDeviceEB-Pro\List\" -lA                   #
#                          "E:\Zigbee-timer\Texas Instruments\Projects\zstack #
#                          \Samples\MyfirstAPP\CC2530DB\EndDeviceEB-Pro\List\ #
#                          " --diag_suppress Pe001,Pa010 -o                   #
#                          "E:\Zigbee-timer\Texas Instruments\Projects\zstack #
#                          \Samples\MyfirstAPP\CC2530DB\EndDeviceEB-Pro\Obj\" #
#                           -e --debug --core=plain --dptr=16,1               #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 8 -I  #
#                          "E:\Zigbee-timer\Texas Instruments\Projects\zstack #
#                          \Samples\MyfirstAPP\CC2530DB\" -I                  #
#                          "E:\Zigbee-timer\Texas Instruments\Projects\zstack #
#                          \Samples\MyfirstAPP\CC2530DB\..\SOURCE\" -I        #
#                          "E:\Zigbee-timer\Texas Instruments\Projects\zstack #
#                          \Samples\MyfirstAPP\CC2530DB\..\..\..\ZMAIN\TI2530 #
#                          DB\" -I "E:\Zigbee-timer\Texas                     #
#                          Instruments\Projects\zstack\Samples\MyfirstAPP\CC2 #
#                          530DB\..\..\..\..\..\COMPONENTS\MT\" -I            #
#                          "E:\Zigbee-timer\Texas Instruments\Projects\zstack #
#                          \Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMPON #
#                          ENTS\HAL\INCLUDE\" -I "E:\Zigbee-timer\Texas       #
#                          Instruments\Projects\zstack\Samples\MyfirstAPP\CC2 #
#                          530DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\CC2530E #
#                          B\" -I "E:\Zigbee-timer\Texas                      #
#                          Instruments\Projects\zstack\Samples\MyfirstAPP\CC2 #
#                          530DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\CCSOC\"   #
#                          -I "E:\Zigbee-timer\Texas                          #
#                          Instruments\Projects\zstack\Samples\MyfirstAPP\CC2 #
#                          530DB\..\..\..\..\..\COMPONENTS\OSAL\INCLUDE\" -I  #
#                          "E:\Zigbee-timer\Texas Instruments\Projects\zstack #
#                          \Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMPON #
#                          ENTS\STACK\AF\" -I "E:\Zigbee-timer\Texas          #
#                          Instruments\Projects\zstack\Samples\MyfirstAPP\CC2 #
#                          530DB\..\..\..\..\..\COMPONENTS\STACK\NWK\" -I     #
#                          "E:\Zigbee-timer\Texas Instruments\Projects\zstack #
#                          \Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMPON #
#                          ENTS\STACK\SEC\" -I "E:\Zigbee-timer\Texas         #
#                          Instruments\Projects\zstack\Samples\MyfirstAPP\CC2 #
#                          530DB\..\..\..\..\..\COMPONENTS\STACK\SAPI\" -I    #
#                          "E:\Zigbee-timer\Texas Instruments\Projects\zstack #
#                          \Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMPON #
#                          ENTS\STACK\SYS\" -I "E:\Zigbee-timer\Texas         #
#                          Instruments\Projects\zstack\Samples\MyfirstAPP\CC2 #
#                          530DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\" -I     #
#                          "E:\Zigbee-timer\Texas Instruments\Projects\zstack #
#                          \Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMPON #
#                          ENTS\ZMAC\F8W\" -I "E:\Zigbee-timer\Texas          #
#                          Instruments\Projects\zstack\Samples\MyfirstAPP\CC2 #
#                          530DB\..\..\..\..\..\COMPONENTS\ZMAC\" -I          #
#                          "E:\Zigbee-timer\Texas Instruments\Projects\zstack #
#                          \Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMPON #
#                          ENTS\SERVICES\SADDR\" -I "E:\Zigbee-timer\Texas    #
#                          Instruments\Projects\zstack\Samples\MyfirstAPP\CC2 #
#                          530DB\..\..\..\..\..\COMPONENTS\SERVICES\SDATA\"   #
#                          -I "E:\Zigbee-timer\Texas                          #
#                          Instruments\Projects\zstack\Samples\MyfirstAPP\CC2 #
#                          530DB\..\..\..\..\..\COMPONENTS\MAC\INCLUDE\" -I   #
#                          "E:\Zigbee-timer\Texas Instruments\Projects\zstack #
#                          \Samples\MyfirstAPP\CC2530DB\..\..\..\..\..\COMPON #
#                          ENTS\MAC\HIGH_LEVEL\" -I "E:\Zigbee-timer\Texas    #
#                          Instruments\Projects\zstack\Samples\MyfirstAPP\CC2 #
#                          530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf0 #
#                          4\" -I "E:\Zigbee-timer\Texas                      #
#                          Instruments\Projects\zstack\Samples\MyfirstAPP\CC2 #
#                          530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf0 #
#                          4\SINGLE_CHIP\" -Ohz --require_prototypes          #
#    List file          =  E:\Zigbee-timer\Texas Instruments\Projects\zstack\ #
#                          Samples\MyfirstAPP\CC2530DB\EndDeviceEB-Pro\List\S #
#                          HT10.lst                                           #
#    Object file        =  E:\Zigbee-timer\Texas Instruments\Projects\zstack\ #
#                          Samples\MyfirstAPP\CC2530DB\EndDeviceEB-Pro\Obj\SH #
#                          T10.r51                                            #
#                                                                             #
#                                                                             #
###############################################################################

E:\Zigbee-timer\Texas Instruments\Projects\zstack\Samples\MyfirstAPP\Source\SHT10.c
      1          /**************************************************************
      2          *   File Name:  SHT10.c
      3          *   Introductions:  Code For SHT10 in Sensor Instrument
      4          *   Last Modify Date: 2013.06.13
      5          *   Modify: 使用 IIC_C:[P0.0] IIC_D:[P0.6]
      6          *   Author: GuoZhenjiang < zhenjiang.guo@sunplusapp.com >
      7          **************************************************************/
      8          
      9          #include "SHT10.h"

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfe
   \   unsigned char volatile __sfr P1DIR
   \                     P1DIR:
   \   000000                DS 1
     10          #include "hal_types.h"
     11          
     12          void SHT10_Transstart(void);
     13          unsigned char SHT10_WriteByte(unsigned char data);
     14          unsigned char SHT10_ReadByte(unsigned char ack);
     15          void SHT10_Connectionreset(void);
     16          unsigned char SHT10_Softreset(void);
     17          unsigned char SHT10_WriteStatusReg(unsigned char RegVlaue);
     18          unsigned char SHT10_ReadStatusReg(void);
     19          
     20          /***********************************************
     21          **Function Name:      SHT10_Transstart
     22          **Description:        发送开始时序
     23          **
     24          **                    generates a transmission start
     25          **                          _____         ________
     26          **                    DATA:      |_______|
     27          **                              ___     ___
     28          **                    SCK : ___|   |___|   |______
     29          **Input Parameters:   	无
     30          **Output Parameters: 	无
     31          ************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     32          void SHT10_Transstart(void)
   \                     SHT10_Transstart:
     33          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
     34              SDIO_DIR_OUT;
   \   000000   12....       LCALL   ?Subroutine4 & 0xFFFF
     35              SCLK_DIR_OUT;
     36              SCLK_LOW;
   \                     ??CrossCallReturnLabel_21:
   \   000003   C290         CLR     0x90.0
     37              SDIO_HIGH;
   \   000005   D291         SETB    0x90.1
     38              DELAY(DURATION1);
   \   000007   78E8         MOV     R0,#-0x18
   \   000009   7903         MOV     R1,#0x3
   \                     ??SHT10_Transstart_0:
   \   00000B   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   00000E   70FB         JNZ     ??SHT10_Transstart_0
     39              DELAY(DURATION1);
   \   000010   78E8         MOV     R0,#-0x18
   \   000012   7903         MOV     R1,#0x3
   \                     ??SHT10_Transstart_1:
   \   000014   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000017   70FB         JNZ     ??SHT10_Transstart_1
     40              SCLK_HIGH;
   \   000019   D290         SETB    0x90.0
     41              DELAY(DURATION1);
   \   00001B   78E8         MOV     R0,#-0x18
   \   00001D   7903         MOV     R1,#0x3
   \                     ??SHT10_Transstart_2:
   \   00001F   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   000022   70FB         JNZ     ??SHT10_Transstart_2
     42              SDIO_LOW;
   \   000024   C291         CLR     0x90.1
     43              DELAY(DURATION1);
   \   000026   78E8         MOV     R0,#-0x18
   \   000028   7903         MOV     R1,#0x3
   \                     ??SHT10_Transstart_3:
   \   00002A   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   00002D   70FB         JNZ     ??SHT10_Transstart_3
     44              SCLK_LOW;
   \   00002F   C290         CLR     0x90.0
     45              DELAY(DURATION1);
   \   000031   78E8         MOV     R0,#-0x18
   \   000033   7903         MOV     R1,#0x3
   \                     ??SHT10_Transstart_4:
   \   000035   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000038   70FB         JNZ     ??SHT10_Transstart_4
     46              SCLK_HIGH;
   \   00003A   D290         SETB    0x90.0
     47              DELAY(DURATION1);
   \   00003C   78E8         MOV     R0,#-0x18
   \   00003E   7903         MOV     R1,#0x3
   \                     ??SHT10_Transstart_5:
   \   000040   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000043   70FB         JNZ     ??SHT10_Transstart_5
     48              SDIO_HIGH;
   \   000045   D291         SETB    0x90.1
     49              DELAY(DURATION1);
   \   000047   78E8         MOV     R0,#-0x18
   \   000049   7903         MOV     R1,#0x3
   \                     ??SHT10_Transstart_6:
   \   00004B   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   00004E   70FB         JNZ     ??SHT10_Transstart_6
     50              SCLK_LOW;	
   \   000050   C290         CLR     0x90.0
     51          }
   \   000052   02....       LJMP    ?BRET
   \   000055                REQUIRE P1DIR
   \   000055                REQUIRE _A_P1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   43FE02       ORL     0xfe,#0x2
   \   000003   43FE01       ORL     0xfe,#0x1
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   E8           MOV     A,R0
   \   000001   FA           MOV     R2,A
   \   000002   E9           MOV     A,R1
   \   000003   FB           MOV     R3,A
   \   000004   EA           MOV     A,R2
   \   000005   24FF         ADD     A,#-0x1
   \   000007   18           DEC     R0
   \   000008   EB           MOV     A,R3
   \   000009   34FF         ADDC    A,#-0x1
   \   00000B   F9           MOV     R1,A
   \   00000C   EA           MOV     A,R2
   \   00000D   4B           ORL     A,R3
   \   00000E   22           RET
     52          
     53          /**********************************************************************************************************
     54          **Function Name:      SHT10_WriteByte
     55          **Description:        写时序
     56          **Input Parameters:   无
     57          **Output Parameters: 无
     58          **************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     59          unsigned char SHT10_WriteByte(unsigned char data)
   \                     SHT10_WriteByte:
     60          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   \   000000   E9           MOV     A,R1
   \   000001   FC           MOV     R4,A
     61            unsigned char i;
     62            SDIO_DIR_OUT;
   \   000002   12....       LCALL   ?Subroutine4 & 0xFFFF
     63            SCLK_DIR_OUT;
     64            for(i=0x80;i>0;i=(i>>1))              //shift bit for masking
   \                     ??CrossCallReturnLabel_22:
   \   000005   7D80         MOV     R5,#-0x80
     65            {
     66              if(i&data)
   \                     ??SHT10_WriteByte_0:
   \   000007   ED           MOV     A,R5
   \   000008   5C           ANL     A,R4
   \   000009   6004         JZ      ??SHT10_WriteByte_1
     67                SDIO_HIGH;                        //masking value with i , write to SENSI-BUS
   \   00000B   D291         SETB    0x90.1
   \   00000D   8002         SJMP    ??SHT10_WriteByte_2
     68              else
     69                SDIO_LOW;
   \                     ??SHT10_WriteByte_1:
   \   00000F   C291         CLR     0x90.1
     70              DELAY(DURATION1);          //pulswith approx. 5 us
   \                     ??SHT10_WriteByte_2:
   \   000011   78E8         MOV     R0,#-0x18
   \   000013   7903         MOV     R1,#0x3
   \                     ??SHT10_WriteByte_3:
   \   000015   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000018   70FB         JNZ     ??SHT10_WriteByte_3
     71              SCLK_HIGH;                          //clk for SENSI-BUS
   \   00001A   D290         SETB    0x90.0
     72              DELAY(DURATION1);          //pulswith approx. 5 us
   \   00001C   78E8         MOV     R0,#-0x18
   \   00001E   7903         MOV     R1,#0x3
   \                     ??SHT10_WriteByte_4:
   \   000020   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000023   70FB         JNZ     ??SHT10_WriteByte_4
     73              SCLK_LOW;
   \   000025   C290         CLR     0x90.0
     74              DELAY(DURATION1);          //pulswith approx. 5 us
   \   000027   78E8         MOV     R0,#-0x18
   \   000029   7903         MOV     R1,#0x3
   \                     ??SHT10_WriteByte_5:
   \   00002B   12....       LCALL   ?Subroutine2 & 0xFFFF
     75            }
   \                     ??CrossCallReturnLabel_9:
   \   00002E   70FB         JNZ     ??SHT10_WriteByte_5
   \   000030   ED           MOV     A,R5
   \   000031   C3           CLR     C
   \   000032   13           RRC     A
   \   000033   FD           MOV     R5,A
   \   000034   70D1         JNZ     ??SHT10_WriteByte_0
     76            SDIO_HIGH;                            //release DATA-line
   \   000036   D291         SETB    0x90.1
     77                      //pulswith approx. 5 us
     78            SDIO_DIR_IN;                     	 //Change SDA to be input
   \   000038   53FEFD       ANL     0xfe,#0xfd
     79            DELAY(DURATION1);
   \   00003B   78E8         MOV     R0,#-0x18
   \   00003D   7903         MOV     R1,#0x3
   \                     ??SHT10_WriteByte_6:
   \   00003F   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000042   70FB         JNZ     ??SHT10_WriteByte_6
     80            SCLK_HIGH;                          //clk for SENSI-BUS
   \   000044   D290         SETB    0x90.0
     81            if(READ_SDIO)
   \   000046   A291         MOV     C,0x90.1
   \   000048   5004         JNC     ??SHT10_WriteByte_7
     82            {
     83                    return 1; 						//error=1 in case of no acknowledge
   \   00004A   7901         MOV     R1,#0x1
   \   00004C   800D         SJMP    ??SHT10_WriteByte_8
     84            }
     85            DELAY(DURATION1);          //pulswith approx. 5 us
   \                     ??SHT10_WriteByte_7:
   \   00004E   78E8         MOV     R0,#-0x18
   \   000050   7903         MOV     R1,#0x3
   \                     ??SHT10_WriteByte_9:
   \   000052   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   000055   70FB         JNZ     ??SHT10_WriteByte_9
     86            SCLK_LOW;
   \   000057   C290         CLR     0x90.0
     87            return 0;
   \   000059   7900         MOV     R1,#0x0
   \                     ??SHT10_WriteByte_8:
   \   00005B   02....       LJMP    ?BRET
   \   00005E                REQUIRE P1DIR
   \   00005E                REQUIRE _A_P1
     88          }
     89          
     90          /**********************************************************************************************************
     91          **Function Name:      SHT10_ReadByte
     92          **Description:        读时序
     93          **Input Parameters:   ack--->reads a byte form the Sensibus and gives an acknowledge in case of "ack=1"
     94          **Output Parameters: 无
     95          **********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     96          unsigned char SHT10_ReadByte(unsigned char ack)
   \                     SHT10_ReadByte:
     97          {
   \   000000   EE           MOV     A,R6
   \   000001   C0E0         PUSH    A
   \   000003                ; Saved register size: 1
   \   000003                ; Auto size: 0
   \   000003   E9           MOV     A,R1
   \   000004   F8           MOV     R0,A
     98            unsigned char i,val=0;
   \   000005   7900         MOV     R1,#0x0
     99            SDIO_DIR_OUT;
   \   000007   43FE02       ORL     0xfe,#0x2
    100            SDIO_HIGH;                            //release DATA-line
   \   00000A   D291         SETB    0x90.1
    101            SDIO_DIR_IN;
   \   00000C   53FEFD       ANL     0xfe,#0xfd
    102            for(i=0x80;i>0;i=(i>>1))             //shift bit for masking
   \   00000F   7E80         MOV     R6,#-0x80
    103            {
    104                SCLK_HIGH;                          //clk for SENSI-BUS
   \                     ??SHT10_ReadByte_0:
   \   000011   D290         SETB    0x90.0
    105                DELAY(DURATION1);
   \   000013   7AE8         MOV     R2,#-0x18
   \   000015   7B03         MOV     R3,#0x3
   \                     ??SHT10_ReadByte_1:
   \   000017   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   00001A   70FB         JNZ     ??SHT10_ReadByte_1
    106                if(READ_SDIO)
   \   00001C   A291         MOV     C,0x90.1
   \   00001E   5004         JNC     ??SHT10_ReadByte_2
    107                  val=(val|i);                  //read bit
   \   000020   EE           MOV     A,R6
   \   000021   C9           XCH     A,R1
   \   000022   49           ORL     A,R1
   \   000023   F9           MOV     R1,A
    108                SCLK_LOW;
   \                     ??SHT10_ReadByte_2:
   \   000024   C290         CLR     0x90.0
    109                DELAY(DURATION1);
   \   000026   7AE8         MOV     R2,#-0x18
   \   000028   7B03         MOV     R3,#0x3
   \                     ??SHT10_ReadByte_3:
   \   00002A   12....       LCALL   ?Subroutine3 & 0xFFFF
    110            }
   \                     ??CrossCallReturnLabel_17:
   \   00002D   70FB         JNZ     ??SHT10_ReadByte_3
   \   00002F   EE           MOV     A,R6
   \   000030   C3           CLR     C
   \   000031   13           RRC     A
   \   000032   FE           MOV     R6,A
   \   000033   70DC         JNZ     ??SHT10_ReadByte_0
    111            SDIO_DIR_OUT;
   \   000035   43FE02       ORL     0xfe,#0x2
    112            if(ack)                           //in case of "ack==1" pull down DATA-Line
   \   000038   E8           MOV     A,R0
   \   000039   6004         JZ      ??SHT10_ReadByte_4
    113                SDIO_LOW;
   \   00003B   C291         CLR     0x90.1
   \   00003D   8002         SJMP    ??SHT10_ReadByte_5
    114            else
    115                SDIO_HIGH;
   \                     ??SHT10_ReadByte_4:
   \   00003F   D291         SETB    0x90.1
    116            SCLK_HIGH;                            //clk #9 for ack
   \                     ??SHT10_ReadByte_5:
   \   000041   D290         SETB    0x90.0
    117            DELAY(DURATION1);              //pulswith approx. 5 us
   \   000043   7AE8         MOV     R2,#-0x18
   \   000045   7B03         MOV     R3,#0x3
   \                     ??SHT10_ReadByte_6:
   \   000047   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_18:
   \   00004A   70FB         JNZ     ??SHT10_ReadByte_6
    118            SCLK_LOW;
   \   00004C   C290         CLR     0x90.0
    119            DELAY(DURATION1);
   \   00004E   7AE8         MOV     R2,#-0x18
   \   000050   7B03         MOV     R3,#0x3
   \                     ??SHT10_ReadByte_7:
   \   000052   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   000055   70FB         JNZ     ??SHT10_ReadByte_7
    120            SDIO_HIGH;                            //release DATA-line
   \   000057   D291         SETB    0x90.1
    121            DELAY(DURATION1);
   \   000059   7AE8         MOV     R2,#-0x18
   \   00005B   7B03         MOV     R3,#0x3
   \                     ??SHT10_ReadByte_8:
   \   00005D   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   000060   70FB         JNZ     ??SHT10_ReadByte_8
    122            SDIO_DIR_IN;
   \   000062   53FEFD       ANL     0xfe,#0xfd
    123            return val;
   \   000065   D0E0         POP     A
   \   000067   FE           MOV     R6,A
   \   000068   02....       LJMP    ?BRET
   \   00006B                REQUIRE P1DIR
   \   00006B                REQUIRE _A_P1
    124          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   EA           MOV     A,R2
   \   000001   FC           MOV     R4,A
   \   000002   EB           MOV     A,R3
   \   000003   FD           MOV     R5,A
   \   000004   EC           MOV     A,R4
   \   000005   24FF         ADD     A,#-0x1
   \   000007   1A           DEC     R2
   \   000008   ED           MOV     A,R5
   \   000009   34FF         ADDC    A,#-0x1
   \   00000B   FB           MOV     R3,A
   \   00000C   EC           MOV     A,R4
   \   00000D   4D           ORL     A,R5
   \   00000E   22           RET
    125          
    126          /**********************************************************************************************************
    127          **Function Name:      SHT10_Connectionreset
    128          **Description:        通讯复位时序
    129          **                   communication reset: DATA-line=1 and at least 9 SCK cycles followed by transstart
    130          **                          _____________________________________________________         ________
    131          **                    DATA:                                                      |_______|
    132          **                             _    _    _    _    _    _    _    _    _        ___     ___
    133          **                    SCK : __| |__| |__| |__| |__| |__| |__| |__| |__| |______|   |___|   |______
    134          **Input Parameters:   无
    135          **Output Parameters: 无
    136          **********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    137          void SHT10_Connectionreset(void)
   \                     SHT10_Connectionreset:
    138          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    139            unsigned char ClkCnt;
    140            SDIO_DIR_OUT;
   \   000004   12....       LCALL   ?Subroutine4 & 0xFFFF
    141            SCLK_DIR_OUT;
    142            SDIO_HIGH;
   \                     ??CrossCallReturnLabel_23:
   \   000007   D291         SETB    0x90.1
    143            SCLK_LOW;                              //Initial state
   \   000009   C290         CLR     0x90.0
    144            DELAY(DURATION1);
   \   00000B   78E8         MOV     R0,#-0x18
   \   00000D   7903         MOV     R1,#0x3
   \                     ??SHT10_Connectionreset_0:
   \   00000F   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   000012   70FB         JNZ     ??SHT10_Connectionreset_0
    145            for(ClkCnt=0;ClkCnt<9;ClkCnt++)           //9 SCK cycles
   \   000014   7C09         MOV     R4,#0x9
    146            {
    147              SCLK_HIGH;
   \                     ??SHT10_Connectionreset_1:
   \   000016   D290         SETB    0x90.0
    148                  DELAY(DURATION1); 	
   \   000018   78E8         MOV     R0,#-0x18
   \   00001A   7903         MOV     R1,#0x3
   \                     ??SHT10_Connectionreset_2:
   \   00001C   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   00001F   70FB         JNZ     ??SHT10_Connectionreset_2
    149              SCLK_LOW;
   \   000021   C290         CLR     0x90.0
    150              DELAY(DURATION1);
   \   000023   78E8         MOV     R0,#-0x18
   \   000025   7903         MOV     R1,#0x3
   \                     ??SHT10_Connectionreset_3:
   \   000027   12....       LCALL   ?Subroutine2 & 0xFFFF
    151            }
   \                     ??CrossCallReturnLabel_14:
   \   00002A   70FB         JNZ     ??SHT10_Connectionreset_3
   \   00002C   1C           DEC     R4
   \   00002D   EC           MOV     A,R4
   \   00002E   70E6         JNZ     ??SHT10_Connectionreset_1
    152            SHT10_Transstart();                           //transmission start
   \   000030                ; Setup parameters for call to function SHT10_Transstart
   \   000030   12....       LCALL   ??SHT10_Transstart?relay
    153          }
   \   000033                REQUIRE ?Subroutine0
   \   000033                REQUIRE P1DIR
   \   000033                REQUIRE _A_P1
   \   000033                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    154          
    155          /**********************************************************************************************************
    156          **Function Name:      SHT10_Softreset
    157          **Description:        软件复位时序resets the sensor by a softreset
    158          **Input Parameters:   无
    159          **Output Parameters: 无
    160          **********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    161          unsigned char SHT10_Softreset(void)
   \                     SHT10_Softreset:
    162          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    163            unsigned char error=0;
    164            SHT10_Connectionreset();              //reset communication
   \   000004                ; Setup parameters for call to function SHT10_Connectionreset
   \   000004   12....       LCALL   ??SHT10_Connectionreset?relay
    165            error+=SHT10_WriteByte(CMD_Soft_Reset);        //send RESET-command to sensor
    166            return error;                     //error=1 in case of no response form the sensor
   \   000007                ; Setup parameters for call to function SHT10_WriteByte
   \   000007   791E         MOV     R1,#0x1e
   \   000009   12....       LCALL   ??SHT10_WriteByte?relay
   \   00000C   80..         SJMP    ?Subroutine0
    167          }
    168          
    169          /**********************************************************************************************************
    170          **Function Name:      SHT10_WriteStatusReg
    171          **Description:        写状态寄存器
    172          **Input Parameters:   *p_value
    173          **Output Parameters: 无
    174          **********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    175          unsigned char SHT10_WriteStatusReg(unsigned char RegVlaue)
   \                     SHT10_WriteStatusReg:
    176          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    177            unsigned char error=0;
    178            SHT10_Transstart();                           //transmission start
   \   000007                ; Setup parameters for call to function SHT10_Transstart
   \   000007   12....       LCALL   ??SHT10_Transstart?relay
    179            error+=SHT10_WriteByte(CMD_Write_STATUS_REG); //send command to sensor
   \   00000A                ; Setup parameters for call to function SHT10_WriteByte
   \   00000A   7906         MOV     R1,#0x6
   \   00000C   12....       LCALL   ??SHT10_WriteByte?relay
   \   00000F   E9           MOV     A,R1
   \   000010   FF           MOV     R7,A
    180            error+=SHT10_WriteByte(RegVlaue);             //send value of status register
    181            return error;                             //error>=1 in case of no response form the sensor
   \   000011                ; Setup parameters for call to function SHT10_WriteByte
   \   000011   EE           MOV     A,R6
   \   000012   F9           MOV     R1,A
   \   000013   12....       LCALL   ??SHT10_WriteByte?relay
   \   000016   E9           MOV     A,R1
   \   000017   2F           ADD     A,R7
   \   000018   F9           MOV     R1,A
   \   000019                REQUIRE ?Subroutine1
   \   000019                ; // Fall through to label ?Subroutine1
    182          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    183          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    184          unsigned char SHT10_ReadStatusReg(void)
   \                     SHT10_ReadStatusReg:
    185          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    186            unsigned char tmp=0;
    187            SHT10_Transstart();                           //transmission start
   \   000004                ; Setup parameters for call to function SHT10_Transstart
   \   000004   12....       LCALL   ??SHT10_Transstart?relay
    188            SHT10_WriteByte(CMD_Read_STATUS_REG);         //send command to sensor
   \   000007                ; Setup parameters for call to function SHT10_WriteByte
   \   000007   7907         MOV     R1,#0x7
   \   000009   12....       LCALL   ??SHT10_WriteByte?relay
    189            tmp = SHT10_ReadByte(ACK);             				//send value of status register
    190            return tmp;                             			//error>=1 in case of no response form the sensor
   \   00000C                ; Setup parameters for call to function SHT10_ReadByte
   \   00000C   7901         MOV     R1,#0x1
   \   00000E   12....       LCALL   ??SHT10_ReadByte?relay
   \   000011   80..         SJMP    ?Subroutine0
    191          }
    192          /**********************************************************************************************************
    193          **Function Name:      SHT10_Mearsure
    194          **Description:        读时序      makes a measurement (humidity/temperature) with checksum
    195          **Input Parameters:   *p_value       ,*p_checknum       ,mode
    196          **Output Parameters: 无
    197          **********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    198          uint8 SHT10_Measure(uint16 *p_value, uint8 *p_checksum, uint8 mode)
   \                     SHT10_Measure:
    199          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   8C..         MOV     ?V0 + 2,R4
   \   00000B   8D..         MOV     ?V0 + 3,R5
   \   00000D   89..         MOV     ?V0 + 6,R1
    200            unsigned error=0;
   \   00000F   75..00       MOV     ?V0 + 0,#0x0
    201            unsigned int i;
    202            SHT10_Transstart();                   //transmission start
   \   000012                ; Setup parameters for call to function SHT10_Transstart
   \   000012   12....       LCALL   ??SHT10_Transstart?relay
    203            switch(mode)
   \   000015   E5..         MOV     A,?V0 + 6
   \   000017   14           DEC     A
   \   000018   6005         JZ      ??SHT10_Measure_0
   \   00001A   14           DEC     A
   \   00001B   6006         JZ      ??SHT10_Measure_1
   \   00001D   800C         SJMP    ??SHT10_Measure_2
    204            {                                 //send command to sensor
    205              case TEMPERATURE:
    206                  error+=SHT10_WriteByte(CMD_TEM_MES);
   \                     ??SHT10_Measure_0:
   \   00001F                ; Setup parameters for call to function SHT10_WriteByte
   \   00001F   7903         MOV     R1,#0x3
   \   000021   8002         SJMP    ??SHT10_Measure_3
    207                  break;
    208              case HUMIDITY:
    209                  error+=SHT10_WriteByte(CMD_HUMI_MES);
   \                     ??SHT10_Measure_1:
   \   000023                ; Setup parameters for call to function SHT10_WriteByte
   \   000023   7905         MOV     R1,#0x5
   \                     ??SHT10_Measure_3:
   \   000025   12....       LCALL   ??SHT10_WriteByte?relay
   \   000028   E9           MOV     A,R1
   \   000029   F5..         MOV     ?V0 + 0,A
    210                  break;
    211            }
    212            SDIO_DIR_IN;
   \                     ??SHT10_Measure_2:
   \   00002B   53FEFD       ANL     0xfe,#0xfd
    213            for(i=0;i<1500;i++)              //wait until sensor has finished the measurement
   \   00002E   7CDC         MOV     R4,#-0x24
   \   000030   7D05         MOV     R5,#0x5
    214            {
    215                if(READ_SDIO == 0)
   \                     ??SHT10_Measure_4:
   \   000032   A291         MOV     C,0x90.1
   \   000034   5015         JNC     ??SHT10_Measure_5
    216                  break;
    217                else
    218                  DELAY(100);
   \   000036   7864         MOV     R0,#0x64
   \   000038   7900         MOV     R1,#0x0
   \                     ??SHT10_Measure_6:
   \   00003A   12....       LCALL   ?Subroutine2 & 0xFFFF
    219            }
   \                     ??CrossCallReturnLabel_15:
   \   00003D   70FB         JNZ     ??SHT10_Measure_6
   \   00003F   EC           MOV     A,R4
   \   000040   24FF         ADD     A,#-0x1
   \   000042   1C           DEC     R4
   \   000043   ED           MOV     A,R5
   \   000044   34FF         ADDC    A,#-0x1
   \   000046   FD           MOV     R5,A
   \   000047   EC           MOV     A,R4
   \   000048   4D           ORL     A,R5
   \   000049   70E7         JNZ     ??SHT10_Measure_4
    220            if(READ_SDIO)
   \                     ??SHT10_Measure_5:
   \   00004B   A291         MOV     C,0x90.1
   \   00004D   5005         JNC     ??SHT10_Measure_7
    221                error+=1;                       			//or timeout (~2 sec.) is reached
   \   00004F   E5..         MOV     A,?V0 + 0
   \   000051   04           INC     A
   \   000052   F5..         MOV     ?V0 + 0,A
    222            *(p_value)=SHT10_ReadByte(ACK);      		 		//read the first byte (MSB)
   \                     ??SHT10_Measure_7:
   \   000054                ; Setup parameters for call to function SHT10_ReadByte
   \   000054   7901         MOV     R1,#0x1
   \   000056   12....       LCALL   ??SHT10_ReadByte?relay
   \   000059   E9           MOV     A,R1
   \   00005A   8E82         MOV     DPL,R6
   \   00005C   8F83         MOV     DPH,R7
   \   00005E   F0           MOVX    @DPTR,A
   \   00005F   A3           INC     DPTR
   \   000060   E4           CLR     A
   \   000061   F0           MOVX    @DPTR,A
    223            *(p_value)=SHT10_ReadByte(ACK)+(*(p_value)<<8);     //read the second byte (LSB)
   \   000062                ; Setup parameters for call to function SHT10_ReadByte
   \   000062   7901         MOV     R1,#0x1
   \   000064   12....       LCALL   ??SHT10_ReadByte?relay
   \   000067   E9           MOV     A,R1
   \   000068   F5..         MOV     ?V0 + 4,A
   \   00006A   8E82         MOV     DPL,R6
   \   00006C   8F83         MOV     DPH,R7
   \   00006E   E0           MOVX    A,@DPTR
   \   00006F   F9           MOV     R1,A
   \   000070   E5..         MOV     A,?V0 + 4
   \   000072   F0           MOVX    @DPTR,A
   \   000073   A3           INC     DPTR
   \   000074   E9           MOV     A,R1
   \   000075   F0           MOVX    @DPTR,A
    224            *p_checksum=SHT10_ReadByte(noACK);    				//read checksum
   \   000076                ; Setup parameters for call to function SHT10_ReadByte
   \   000076   7900         MOV     R1,#0x0
   \   000078   12....       LCALL   ??SHT10_ReadByte?relay
   \   00007B   E9           MOV     A,R1
   \   00007C   85..82       MOV     DPL,?V0 + 2
   \   00007F   85..83       MOV     DPH,?V0 + 3
   \   000082   F0           MOVX    @DPTR,A
    225            return(error);
   \   000083   A9..         MOV     R1,?V0 + 0
   \   000085   7F07         MOV     R7,#0x7
   \   000087   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   00008A                REQUIRE P1DIR
   \   00008A                REQUIRE _A_P1
    226          }
    227          
    228          /**********************************************************************************************************
    229          **Function Name:      SHT10_Calculate
    230          **Description:        计算
    231          **Input Parameters:   humi [Ticks] (12 bit)
    232          **                    temp [Ticks] (14 bit)
    233          **Output Parameters: humi [%RH]
    234          **                    temp []
    235          **********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    236          float SHT10_Calculate(uint16 data,uint8 mode)
   \                     SHT10_Calculate:
    237          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 4
   \   000005   74FC         MOV     A,#-0x4
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    238            const float C1=-4.0;              // for 8 Bit
    239            const float C2=+0.648;            // for 8 Bit
    240            const float C3=-0.00072;        // for 8 Bit
    241            const float D1=-39.6;             // for 12 Bit @ 3V
    242            const float D2=+0.04;             // for 12 Bit @ 3V
    243            const float T1=0.01;              // for 8 bit
    244            const float T2=0.00128;           // for 8 bit
    245            float rh_lin;                     // rh_lin: Humidity linear
    246            float rh_true;                    // rh_true: Temperature compensated humidity
    247            float t_C;                        // t_C   : Temperature []
    248            if (mode == 1)
   \   00000C   8A..         MOV     ?V0 + 4,R2
   \   00000E   8B..         MOV     ?V0 + 5,R3
   \   000010   E4           CLR     A
   \   000011   F5..         MOV     ?V0 + 6,A
   \   000013   F5..         MOV     ?V0 + 7,A
   \   000015   78..         MOV     R0,#?V0 + 4
   \   000017   12....       LCALL   ?UL_TO_FLT
   \   00001A   85..82       MOV     DPL,?XSP + 0
   \   00001D   85..83       MOV     DPH,?XSP + 1
   \   000020   78..         MOV     R0,#?V0 + 4
   \   000022   12....       LCALL   ?L_MOV_TO_X
   \   000025   7401         MOV     A,#0x1
   \   000027   6E           XRL     A,R6
   \   000028   7034         JNZ     ??SHT10_Calculate_0
    249            {
    250              t_C=data*D2+D1;                      //calc. temperature from ticks to []
    251              return (t_C);
   \   00002A   85..82       MOV     DPL,?XSP + 0
   \   00002D   85..83       MOV     DPH,?XSP + 1
   \   000030   78..         MOV     R0,#?V0 + 0
   \   000032   12....       LCALL   ?L_MOV_X
   \   000035   90....       MOV     DPTR,#__Constant_3d23d70a
   \   000038   78..         MOV     R0,#?V0 + 4
   \   00003A   12....       LCALL   ?L_MOV_X
   \   00003D   78..         MOV     R0,#?V0 + 0
   \   00003F   79..         MOV     R1,#?V0 + 4
   \   000041   12....       LCALL   ?FLT_MUL
   \   000044   90....       MOV     DPTR,#__Constant_c21e6666
   \   000047   78..         MOV     R0,#?V0 + 4
   \   000049   12....       LCALL   ?L_MOV_X
   \   00004C   78..         MOV     R0,#?V0 + 0
   \   00004E   79..         MOV     R1,#?V0 + 4
   \   000050   12....       LCALL   ?FLT_ADD
   \   000053   AA..         MOV     R2,?V0 + 0
   \   000055   AB..         MOV     R3,?V0 + 1
   \   000057   AC..         MOV     R4,?V0 + 2
   \   000059   AD..         MOV     R5,?V0 + 3
   \   00005B   02....       LJMP    ??SHT10_Calculate_1 & 0xFFFF
    252            }
    253            else if(mode == 2)
   \                     ??SHT10_Calculate_0:
   \   00005E   7402         MOV     A,#0x2
   \   000060   6E           XRL     A,R6
   \   000061   6003         JZ      $+5
   \   000063   02....       LJMP    ??SHT10_Calculate_2 & 0xFFFF
    254            {
    255              rh_lin=C3*data*data + C2*data + C1;     //calc. humidity from ticks to [%RH]
    256              rh_true=(t_C-25)*(T1+T2*data)+rh_lin;   //calc. temperature compensated humidity [%RH]
   \   000066   90....       MOV     DPTR,#__Constant_c1c80000
   \   000069   78..         MOV     R0,#?V0 + 4
   \   00006B   12....       LCALL   ?L_MOV_X
   \   00006E   78..         MOV     R0,#?V0 + 0
   \   000070   79..         MOV     R1,#?V0 + 4
   \   000072   12....       LCALL   ?FLT_ADD
   \   000075   C0..         PUSH    ?V0 + 0
   \   000077   C0..         PUSH    ?V0 + 1
   \   000079   C0..         PUSH    ?V0 + 2
   \   00007B   C0..         PUSH    ?V0 + 3
   \   00007D   85..82       MOV     DPL,?XSP + 0
   \   000080   85..83       MOV     DPH,?XSP + 1
   \   000083   78..         MOV     R0,#?V0 + 0
   \   000085   12....       LCALL   ?L_MOV_X
   \   000088   90....       MOV     DPTR,#__Constant_3aa7c5ac
   \   00008B   78..         MOV     R0,#?V0 + 4
   \   00008D   12....       LCALL   ?L_MOV_X
   \   000090   78..         MOV     R0,#?V0 + 0
   \   000092   79..         MOV     R1,#?V0 + 4
   \   000094   12....       LCALL   ?FLT_MUL
   \   000097   90....       MOV     DPTR,#__Constant_3c23d70a
   \   00009A   78..         MOV     R0,#?V0 + 4
   \   00009C   12....       LCALL   ?L_MOV_X
   \   00009F   78..         MOV     R0,#?V0 + 0
   \   0000A1   79..         MOV     R1,#?V0 + 4
   \   0000A3   12....       LCALL   ?FLT_ADD
   \   0000A6   D0..         POP     ?V0 + 7
   \   0000A8   D0..         POP     ?V0 + 6
   \   0000AA   D0..         POP     ?V0 + 5
   \   0000AC   D0..         POP     ?V0 + 4
   \   0000AE   78..         MOV     R0,#?V0 + 4
   \   0000B0   79..         MOV     R1,#?V0 + 0
   \   0000B2   12....       LCALL   ?FLT_MUL
   \   0000B5   C0..         PUSH    ?V0 + 4
   \   0000B7   C0..         PUSH    ?V0 + 5
   \   0000B9   C0..         PUSH    ?V0 + 6
   \   0000BB   C0..         PUSH    ?V0 + 7
   \   0000BD   85..82       MOV     DPL,?XSP + 0
   \   0000C0   85..83       MOV     DPH,?XSP + 1
   \   0000C3   78..         MOV     R0,#?V0 + 0
   \   0000C5   12....       LCALL   ?L_MOV_X
   \   0000C8   90....       MOV     DPTR,#__Constant_ba3cbe62
   \   0000CB   78..         MOV     R0,#?V0 + 4
   \   0000CD   12....       LCALL   ?L_MOV_X
   \   0000D0   78..         MOV     R0,#?V0 + 0
   \   0000D2   79..         MOV     R1,#?V0 + 4
   \   0000D4   12....       LCALL   ?FLT_MUL
   \   0000D7   85..82       MOV     DPL,?XSP + 0
   \   0000DA   85..83       MOV     DPH,?XSP + 1
   \   0000DD   78..         MOV     R0,#?V0 + 4
   \   0000DF   12....       LCALL   ?L_MOV_X
   \   0000E2   78..         MOV     R0,#?V0 + 0
   \   0000E4   79..         MOV     R1,#?V0 + 4
   \   0000E6   12....       LCALL   ?FLT_MUL
   \   0000E9   C0..         PUSH    ?V0 + 0
   \   0000EB   C0..         PUSH    ?V0 + 1
   \   0000ED   C0..         PUSH    ?V0 + 2
   \   0000EF   C0..         PUSH    ?V0 + 3
   \   0000F1   85..82       MOV     DPL,?XSP + 0
   \   0000F4   85..83       MOV     DPH,?XSP + 1
   \   0000F7   78..         MOV     R0,#?V0 + 4
   \   0000F9   12....       LCALL   ?L_MOV_X
   \   0000FC   90....       MOV     DPTR,#__Constant_3f25e354
   \   0000FF   78..         MOV     R0,#?V0 + 0
   \   000101   12....       LCALL   ?L_MOV_X
   \   000104   78..         MOV     R0,#?V0 + 4
   \   000106   79..         MOV     R1,#?V0 + 0
   \   000108   12....       LCALL   ?FLT_MUL
   \   00010B   D0..         POP     ?V0 + 3
   \   00010D   D0..         POP     ?V0 + 2
   \   00010F   D0..         POP     ?V0 + 1
   \   000111   D0..         POP     ?V0 + 0
   \   000113   78..         MOV     R0,#?V0 + 0
   \   000115   79..         MOV     R1,#?V0 + 4
   \   000117   12....       LCALL   ?FLT_ADD
   \   00011A   90....       MOV     DPTR,#__Constant_c0800000
   \   00011D   78..         MOV     R0,#?V0 + 4
   \   00011F   12....       LCALL   ?L_MOV_X
   \   000122   78..         MOV     R0,#?V0 + 0
   \   000124   79..         MOV     R1,#?V0 + 4
   \   000126   12....       LCALL   ?FLT_ADD
   \   000129   D0..         POP     ?V0 + 7
   \   00012B   D0..         POP     ?V0 + 6
   \   00012D   D0..         POP     ?V0 + 5
   \   00012F   D0..         POP     ?V0 + 4
   \   000131   78..         MOV     R0,#?V0 + 4
   \   000133   79..         MOV     R1,#?V0 + 0
   \   000135   12....       LCALL   ?FLT_ADD
    257              if(rh_true>100)rh_true=100;       //cut if the value is outside of
   \   000138   90....       MOV     DPTR,#__Constant_42c80001
   \   00013B   78..         MOV     R0,#?V0 + 0
   \   00013D   12....       LCALL   ?L_MOV_X
   \   000140   78..         MOV     R0,#?V0 + 4
   \   000142   79..         MOV     R1,#?V0 + 0
   \   000144   12....       LCALL   ?FLT_GE
   \   000147   5005         JNC     ??SHT10_Calculate_3
   \   000149   90....       MOV     DPTR,#__Constant_42c80000
   \   00014C   8014         SJMP    ??SHT10_Calculate_4
    258              if(rh_true<0.1)rh_true=0.1;       //the physical possible range
   \                     ??SHT10_Calculate_3:
   \   00014E   90....       MOV     DPTR,#__Constant_3dcccccd
   \   000151   78..         MOV     R0,#?V0 + 0
   \   000153   12....       LCALL   ?L_MOV_X
   \   000156   78..         MOV     R0,#?V0 + 4
   \   000158   79..         MOV     R1,#?V0 + 0
   \   00015A   12....       LCALL   ?FLT_LT
   \   00015D   5008         JNC     ??SHT10_Calculate_5
   \   00015F   90....       MOV     DPTR,#__Constant_3dcccccd
   \                     ??SHT10_Calculate_4:
   \   000162   78..         MOV     R0,#?V0 + 4
   \   000164   12....       LCALL   ?L_MOV_X
    259              return (rh_true);
   \                     ??SHT10_Calculate_5:
   \   000167   AA..         MOV     R2,?V0 + 4
   \   000169   AB..         MOV     R3,?V0 + 5
   \   00016B   AC..         MOV     R4,?V0 + 6
   \   00016D   AD..         MOV     R5,?V0 + 7
   \   00016F   8008         SJMP    ??SHT10_Calculate_1
    260            }
    261            else
    262              return 0;
   \                     ??SHT10_Calculate_2:
   \   000171   7A00         MOV     R2,#0x0
   \   000173   7B00         MOV     R3,#0x0
   \   000175   7C00         MOV     R4,#0x0
   \   000177   7D00         MOV     R5,#0x0
   \                     ??SHT10_Calculate_1:
   \   000179   7404         MOV     A,#0x4
   \   00017B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00017E   7F08         MOV     R7,#0x8
   \   000180   02....       LJMP    ?BANKED_LEAVE_XDATA
    263          }
    264          /**********************************************************************************************************
    265          **Function Name:      SHT10_init
    266          **Description:        初始化SHT10
    267          **********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    268          void SHT10_init(uint16 Initial_Reg)
   \                     SHT10_init:
    269          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
    270            SHT10_Connectionreset();
   \   000007                ; Setup parameters for call to function SHT10_Connectionreset
   \   000007   12....       LCALL   ??SHT10_Connectionreset?relay
    271            SHT10_WriteStatusReg(Initial_Reg);
   \   00000A                ; Setup parameters for call to function SHT10_WriteStatusReg
   \   00000A   EE           MOV     A,R6
   \   00000B   F9           MOV     R1,A
   \   00000C   12....       LCALL   ??SHT10_WriteStatusReg?relay
    272          }
   \   00000F   02....       LJMP    ?Subroutine1 & 0xFFFF

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3d23d70a:
   \   000000   0AD7233D     DD 3D23D70AH

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_c21e6666:
   \   000000   66661EC2     DD 0C21E6666H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_c1c80000:
   \   000000   0000C8C1     DD 0C1C80000H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3aa7c5ac:
   \   000000   ACC5A73A     DD 3AA7C5ACH

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3c23d70a:
   \   000000   0AD7233C     DD 3C23D70AH

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_ba3cbe62:
   \   000000   62BE3CBA     DD 0BA3CBE62H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3f25e354:
   \   000000   54E3253F     DD 3F25E354H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_c0800000:
   \   000000   000080C0     DD 0C0800000H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_42c80001:
   \   000000   0100C842     DD 42C80001H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_42c80000:
   \   000000   0000C842     DD 42C80000H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3dcccccd:
   \   000000   CDCCCC3D     DD 3DCCCCCDH

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SHT10_Transstart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SHT10_Transstart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SHT10_WriteByte?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SHT10_WriteByte

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SHT10_ReadByte?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SHT10_ReadByte

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SHT10_Connectionreset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SHT10_Connectionreset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SHT10_Softreset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SHT10_Softreset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SHT10_WriteStatusReg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SHT10_WriteStatusReg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SHT10_ReadStatusReg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SHT10_ReadStatusReg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SHT10_Measure?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SHT10_Measure

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SHT10_Calculate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SHT10_Calculate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SHT10_init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SHT10_init

   Maximum stack usage in bytes:

     Function                   ISTACK PSTACK XSTACK
     --------                   ------ ------ ------
     SHT10_Calculate                8      0     20
     SHT10_Connectionreset          2      0      9
       -> SHT10_Transstart          4      0      0
     SHT10_Measure                  1      0     15
       -> SHT10_Transstart          0      0     30
       -> SHT10_WriteByte           0      0     30
       -> SHT10_WriteByte           0      0     30
       -> SHT10_ReadByte            0      0     30
       -> SHT10_ReadByte            0      0     30
       -> SHT10_ReadByte            0      0     30
     SHT10_ReadByte                 1      0     15
     SHT10_ReadStatusReg            2      0      0
       -> SHT10_Transstart          4      0      0
       -> SHT10_WriteByte           4      0      0
       -> SHT10_ReadByte            4      0      0
     SHT10_Softreset                2      0      0
       -> SHT10_Connectionreset     4      0      0
       -> SHT10_WriteByte           4      0      0
     SHT10_Transstart               0      0     15
     SHT10_WriteByte                0      0     15
     SHT10_WriteStatusReg           0      0     18
       -> SHT10_Transstart          0      0     18
       -> SHT10_WriteByte           0      0     18
       -> SHT10_WriteByte           0      0     18
     SHT10_init                     0      0      9
       -> SHT10_Connectionreset     0      0     18
       -> SHT10_WriteStatusReg      0      0     18


   Segment part sizes:

     Function/Label                Bytes
     --------------                -----
     _A_P1                            1
     P1DIR                            1
     SHT10_Transstart                85
     ?Subroutine4                     7
     ?Subroutine2                    15
     SHT10_WriteByte                 94
     SHT10_ReadByte                 107
     ?Subroutine3                    15
     SHT10_Connectionreset           51
     ?Subroutine0                     7
     SHT10_Softreset                 14
     SHT10_WriteStatusReg            25
     ?Subroutine1                     5
     SHT10_ReadStatusReg             19
     SHT10_Measure                  138
     SHT10_Calculate                387
     SHT10_init                      18
     __Constant_3d23d70a              4
     __Constant_c21e6666              4
     __Constant_c1c80000              4
     __Constant_3aa7c5ac              4
     __Constant_3c23d70a              4
     __Constant_ba3cbe62              4
     __Constant_3f25e354              4
     __Constant_c0800000              4
     __Constant_42c80001              4
     __Constant_42c80000              4
     __Constant_3dcccccd              4
     ??SHT10_Transstart?relay         6
     ??SHT10_WriteByte?relay          6
     ??SHT10_ReadByte?relay           6
     ??SHT10_Connectionreset?relay    6
     ??SHT10_Softreset?relay          6
     ??SHT10_WriteStatusReg?relay     6
     ??SHT10_ReadStatusReg?relay      6
     ??SHT10_Measure?relay            6
     ??SHT10_Calculate?relay          6
     ??SHT10_init?relay               6

 
 987 bytes in segment BANKED_CODE
  60 bytes in segment BANK_RELAYS
   2 bytes in segment SFR_AN
  44 bytes in segment XDATA_ROM_C
 
 1 047 bytes of CODE  memory
     0 bytes of CONST memory (+ 44 bytes shared)
     0 bytes of DATA  memory (+  2 bytes shared)

Errors: none
Warnings: none
